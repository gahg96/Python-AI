# 模型预测与评估快速指南

## 🚀 快速开始

### 1. 预测单个客户信用评分

```bash
# 使用示例客户数据
python3 scripts/predict_customer.py \
    --model models/model_20241209_143022.pkl \
    --customer data/sample_customer.json \
    --explain \
    --output prediction_result.json
```

**输出示例**:
```
信用评分: 720 分
违约概率: 8.00%
风险等级: 中低风险
审批建议: 建议通过
```

### 2. 评估模型性能

```bash
# 使用测试集评估
python3 scripts/evaluate_model.py \
    --model models/model_20241209_143022.pkl \
    --test data/test_features.parquet \
    --output evaluation_report.json \
    --plot
```

**关键指标**:
- AUC Score: > 0.8 (良好)
- 精确率: > 0.75
- 召回率: > 0.70

---

## 📊 信用评分说明

| 评分 | 风险等级 | 审批建议 |
|-----|---------|---------|
| 800-1000 | 低风险 | 建议通过 |
| 650-799 | 中低风险 | 建议通过 |
| 500-649 | 中风险 | 条件通过 |
| 350-499 | 中高风险 | 谨慎审批 |
| 0-349 | 高风险 | 建议拒绝 |

---

## ✅ 评判标准

### 模型准确性标准

| 指标 | 优秀 | 良好 | 可接受 |
|-----|------|------|--------|
| AUC | > 0.9 | 0.8-0.9 | 0.7-0.8 |
| 精确率 | > 0.85 | 0.75-0.85 | 0.65-0.75 |
| 召回率 | > 0.80 | 0.70-0.80 | 0.60-0.70 |

### 业务标准

- **误拒率**: < 5% (避免过多好客户被拒绝)
- **漏检率**: < 10% (避免过多坏客户被通过)
- **整体准确率**: > 85%

---

## 📝 客户数据格式

创建 `customer_data.json`:

```json
{
  "age": 35,
  "gender": "M",
  "education": "bachelor",
  "industry": "it",
  "city_tier": "tier_1",
  "customer_type": "salaried",
  "monthly_income": 15000.0,
  "total_assets": 500000.0,
  "total_liabilities": 200000.0,
  "total_deposit_balance": 100000.0,
  "total_loans": 2,
  "default_count": 0,
  "max_overdue_days": 0,
  "months_as_customer": 36
}
```

---

## 💡 使用示例

### 示例1：预测新客户

```bash
# 1. 准备客户数据
cat > new_customer.json << EOF
{
  "age": 28,
  "gender": "F",
  "education": "master",
  "industry": "finance",
  "city_tier": "tier_1",
  "customer_type": "salaried",
  "monthly_income": 20000.0,
  "total_assets": 600000.0,
  "total_liabilities": 150000.0,
  "total_deposit_balance": 150000.0,
  "total_loans": 1,
  "default_count": 0,
  "max_overdue_days": 0,
  "months_as_customer": 24
}
EOF

# 2. 进行预测
python3 scripts/predict_customer.py \
    --model models/model_20241209_143022.pkl \
    --customer new_customer.json \
    --explain
```

### 示例2：批量预测

```python
import pandas as pd
import json
from scripts.predict_customer import CustomerPredictor

# 加载模型
predictor = CustomerPredictor('models/model_20241209_143022.pkl')

# 加载客户数据
customers = pd.read_parquet('data/new_applications.parquet')

# 批量预测
results = []
for idx, customer in customers.iterrows():
    customer_dict = customer.to_dict()
    result = predictor.predict(customer_dict)
    results.append({
        'customer_id': customer['customer_id'],
        **result
    })

# 保存结果
pd.DataFrame(results).to_parquet('batch_predictions.parquet', index=False)
```

---

## 🔍 评估依据

### 1. 数据质量
- ✅ 训练数据量 > 10,000 条
- ✅ 正负样本比例合理 (1:10 到 1:20)
- ✅ 数据时效性 (最近3-5年)
- ✅ 缺失值 < 5%

### 2. 模型性能
- ✅ AUC > 0.8
- ✅ 交叉验证各折差异 < 0.05
- ✅ 时间验证稳定

### 3. 业务验证
- ✅ 预测结果符合业务逻辑
- ✅ 专家评审通过
- ✅ A/B测试效果良好

---

## 📚 相关文档

- **详细指南**: `docs/模型预测与评估指南.md`
- **特征格式**: `docs/特征文件格式与训练指南.md`
- **训练指南**: `docs/特征文件与训练快速指南.md`

---

## ⚠️ 注意事项

1. **模型版本**: 确保使用最新训练的模型
2. **特征完整性**: 客户数据应包含所有必要特征
3. **数据格式**: 确保数据类型与训练时一致
4. **定期评估**: 定期评估模型性能，及时更新
5. **业务规则**: 结合业务规则和模型预测做最终决策

