# 风险因子确定方法详解

## 📋 目录
1. [风险因子概述](#风险因子概述)
2. [各风险因子详解](#各风险因子详解)
3. [风险因子计算逻辑](#风险因子计算逻辑)
4. [风险等级判定标准](#风险等级判定标准)
5. [风险因子权重](#风险因子权重)
6. [实际应用示例](#实际应用示例)

---

## 🎯 风险因子概述

### 什么是风险因子？

风险因子是影响客户违约概率的关键特征变量。通过分析这些因子，可以：
- **识别高风险客户**：提前预警可能违约的客户
- **优化审批决策**：基于多维度风险因子做出更准确的判断
- **解释模型决策**：让AI决策过程可解释、可追溯

### 核心风险因子

系统主要分析以下5个核心风险因子：

1. **客户类型** - 反映客户职业稳定性
2. **负债率** - 反映客户财务健康度
3. **收入波动** - 反映客户收入稳定性
4. **存款稳定** - 反映客户资金管理能力
5. **历史逾期** - 反映客户历史信用表现

---

## 📊 各风险因子详解

### 1. 客户类型 (Customer Type)

#### 定义
客户类型是根据客户的职业和收入来源特征进行分类，反映客户的收入稳定性和还款能力。

#### 分类标准

| 客户类型 | 风险等级 | 风险系数 | 说明 |
|---------|---------|---------|------|
| **工薪阶层** | 低风险 | 0% | 收入稳定，有固定工资，风险最低 |
| **农户** | 中低风险 | 2% | 收入受季节影响，但相对稳定 |
| **自由职业** | 中风险 | 3% | 收入不稳定，波动较大 |
| **小微企业主** | 中高风险 | 5% | 收入受经营状况影响，风险较高 |

#### 计算逻辑

```python
type_risk_map = {
    '工薪阶层': 0.00,      # 无额外风险
    '农户': 0.02,          # 增加2%风险
    '自由职业': 0.03,      # 增加3%风险
    '小微企业主': 0.05     # 增加5%风险
}

# 风险贡献度计算
type_contribution = type_risk_map.get(customer_type, 0.03)
```

#### 业务含义
- **工薪阶层**：有固定工作，收入稳定，违约风险最低
- **农户**：收入受季节和天气影响，但总体稳定
- **自由职业**：收入波动大，缺乏稳定保障
- **小微企业主**：经营风险高，受市场环境影响大

#### 界面显示
- **低风险（绿色）**：工薪阶层，风险系数 0%
- **中风险（橙色）**：农户，风险系数 2%
- **高风险（红色）**：自由职业/小微企业主，风险系数 3-5%

---

### 2. 负债率 (Debt Ratio)

#### 定义
负债率 = 总负债 / 总资产，反映客户的财务杠杆水平和偿债压力。

#### 计算公式

```
负债率 = 总负债 / 总资产

例如：
总资产 = 500,000元
总负债 = 200,000元
负债率 = 200,000 / 500,000 = 0.4 = 40%
```

#### 评判标准

| 负债率范围 | 风险等级 | 风险系数 | 说明 |
|-----------|---------|---------|------|
| **< 40%** | 低风险 | 0% | 财务健康，偿债压力小 |
| **40% - 60%** | 中风险 | 0.3 × (负债率 - 0.4) | 超过警戒线，需要关注 |
| **60% - 80%** | 高风险 | 0.3 × (负债率 - 0.4) | 财务压力大，风险较高 |
| **> 80%** | 极高风险 | 0.3 × (负债率 - 0.4) | 接近资不抵债，风险极高 |

#### 计算逻辑

```python
# 基础风险阈值
DEBT_RATIO_THRESHOLD = 0.4  # 40%

if debt_ratio > DEBT_RATIO_THRESHOLD:
    # 超过40%的部分，每增加1%增加0.3%的风险
    debt_contribution = (debt_ratio - DEBT_RATIO_THRESHOLD) * 0.3
    
    # 示例：负债率62.4%
    # debt_contribution = (0.624 - 0.4) * 0.3 = 0.0672 = 6.72%
else:
    debt_contribution = 0  # 无额外风险
```

#### 业务含义
- **< 40%**：财务健康，有足够的资产缓冲
- **40-60%**：财务压力适中，需要关注
- **60-80%**：财务压力大，违约风险增加
- **> 80%**：接近资不抵债，违约风险极高

#### 界面显示
- **绿色**：负债率 < 40%
- **橙色**：负债率 40-60%
- **红色**：负债率 > 60%

---

### 3. 收入波动 (Income Volatility)

#### 定义
收入波动率反映客户月收入的稳定性，通过计算历史收入的变异系数得出。

#### 计算公式

```
收入波动率 = 收入标准差 / 平均收入

例如：
近12个月收入：[8000, 8500, 9000, 7500, 8200, 8800, 9200, 7800, 8600, 8900, 9100, 8700]
平均收入 = 8,525元
标准差 = 400元
收入波动率 = 400 / 8,525 = 0.047 = 4.7%
```

#### 评判标准

| 收入波动率 | 风险等级 | 风险系数 | 说明 |
|-----------|---------|---------|------|
| **< 20%** | 低风险 | 0% | 收入稳定，还款能力强 |
| **20% - 40%** | 中风险 | 波动率 × 0.1 | 收入波动较大，需要关注 |
| **> 40%** | 高风险 | 波动率 × 0.1 | 收入极不稳定，风险高 |

#### 计算逻辑

```python
INCOME_VOLATILITY_THRESHOLD = 0.2  # 20%

if income_volatility > INCOME_VOLATILITY_THRESHOLD:
    # 超过20%的部分，每增加1%增加0.1%的风险
    vol_contribution = income_volatility * 0.1
    
    # 示例：收入波动率4.7%
    # vol_contribution = 0.047 * 0.1 = 0.0047 = 0.47%（低于阈值，无风险）
    
    # 示例：收入波动率25%
    # vol_contribution = 0.25 * 0.1 = 0.025 = 2.5%
else:
    vol_contribution = 0  # 无额外风险
```

#### 业务含义
- **< 20%**：收入稳定，还款来源可靠
- **20-40%**：收入波动较大，可能影响还款能力
- **> 40%**：收入极不稳定，违约风险高

#### 界面显示
- **绿色**：收入波动 < 20%
- **橙色**：收入波动 20-40%
- **红色**：收入波动 > 40%

---

### 4. 存款稳定 (Deposit Stability)

#### 定义
存款稳定性反映客户在银行的存款行为稳定性，通过分析账户余额的波动情况计算。

#### 计算公式

```
存款稳定性 = 1 - (存款余额标准差 / 平均存款余额)

例如：
近6个月存款余额：[30000, 32000, 31000, 33000, 31500, 32500]
平均余额 = 31,667元
标准差 = 1,000元
存款稳定性 = 1 - (1000 / 31667) = 1 - 0.032 = 0.968 = 96.8%
```

#### 评判标准

| 存款稳定性 | 风险等级 | 风险系数 | 说明 |
|-----------|---------|---------|------|
| **> 70%** | 正面因子 | -稳定性×2% | 存款行为稳定，降低风险 |
| **50% - 70%** | 中性 | 0% | 存款行为一般 |
| **< 50%** | 负面因子 | (1-稳定性)×1% | 存款波动大，增加风险 |

#### 计算逻辑

```python
DEPOSIT_STABILITY_THRESHOLD = 0.7  # 70%

if deposit_stability > DEPOSIT_STABILITY_THRESHOLD:
    # 存款稳定性高，作为正面因子降低风险
    positive_contribution = deposit_stability * 0.02
    
    # 示例：存款稳定性96.8%
    # positive_contribution = 0.968 * 0.02 = 0.0194 = 1.94%（降低风险）
    
elif deposit_stability < 0.5:
    # 存款稳定性低，增加风险
    negative_contribution = (1 - deposit_stability) * 0.01
else:
    # 中性，不影响风险
    contribution = 0
```

#### 业务含义
- **> 70%**：存款行为稳定，资金管理能力强，降低违约风险
- **50-70%**：存款行为一般，对风险影响中性
- **< 50%**：存款波动大，可能资金紧张，增加违约风险

#### 界面显示
- **绿色**：存款稳定 > 70%（正面因子）
- **橙色**：存款稳定 50-70%（中性）
- **红色**：存款稳定 < 50%（负面因子）

---

### 5. 历史逾期 (Historical Overdue Days)

#### 定义
历史最大逾期天数（Max Days Past Due, DPD）反映客户在过去贷款中的还款表现。

#### 数据来源
从客户的贷款历史记录中提取：
- 查看所有历史贷款
- 找出每笔贷款的最大逾期天数
- 取所有贷款中的最大值

#### 评判标准

| 历史逾期天数 | 风险等级 | 风险系数 | 说明 |
|------------|---------|---------|------|
| **0天** | 低风险 | 0% | 从未逾期，信用良好 |
| **1-30天** | 中风险 | 逾期天数/30 × 2% | 轻微逾期，需要关注 |
| **31-90天** | 高风险 | 2% + (逾期天数-30)/60 × 3% | 严重逾期，风险较高 |
| **> 90天** | 极高风险 | 5% + (逾期天数-90)/90 × 5% | 长期逾期，风险极高 |

#### 计算逻辑

```python
if max_historical_dpd == 0:
    dpd_contribution = 0  # 无逾期，无风险
elif max_historical_dpd <= 30:
    # 轻微逾期：每10天增加约0.67%风险
    dpd_contribution = (max_historical_dpd / 30) * 0.02
elif max_historical_dpd <= 90:
    # 严重逾期：基础2% + 额外风险
    dpd_contribution = 0.02 + ((max_historical_dpd - 30) / 60) * 0.03
else:
    # 长期逾期：基础5% + 额外风险
    dpd_contribution = 0.05 + ((max_historical_dpd - 90) / 90) * 0.05
```

#### 业务含义
- **0天**：信用记录良好，从未逾期
- **1-30天**：可能因临时资金紧张导致轻微逾期
- **31-90天**：还款能力有问题，风险较高
- **> 90天**：严重信用问题，违约风险极高

#### 界面显示
- **绿色**：历史逾期 = 0天
- **橙色**：历史逾期 1-30天
- **红色**：历史逾期 > 30天

---

## 🔢 风险因子计算逻辑

### 综合风险计算

系统将所有风险因子综合计算，得出最终的违约概率：

```python
# 基础风险
base_risk = 0.05  # 5%基础风险

# 风险因子贡献度
total_risk_contribution = (
    type_contribution +      # 客户类型风险
    debt_contribution +      # 负债率风险
    vol_contribution +       # 收入波动风险
    dpd_contribution         # 历史逾期风险
)

# 正面因子（降低风险）
total_positive_contribution = (
    deposit_stability_contribution +  # 存款稳定性
    customer_relationship_contribution  # 客户关系时长
)

# 最终违约概率
default_probability = base_risk + total_risk_contribution - total_positive_contribution

# 限制在合理范围内
default_probability = max(0.01, min(0.95, default_probability))
```

### 计算示例

假设一个客户：
- **客户类型**：小微企业主（风险系数 5%）
- **负债率**：62.4%（风险系数 6.72%）
- **收入波动**：4.7%（低于阈值，无风险）
- **存款稳定**：29%（低于50%，风险系数 0.71%）
- **历史逾期**：0天（无风险）

```python
base_risk = 0.05

# 风险贡献
type_contribution = 0.05
debt_contribution = (0.624 - 0.4) * 0.3 = 0.0672
vol_contribution = 0  # 低于阈值
deposit_negative = (1 - 0.29) * 0.01 = 0.0071
dpd_contribution = 0

total_risk = 0.05 + 0.05 + 0.0672 + 0.0071 = 0.1743

# 最终违约概率
default_probability = 0.1743 = 17.43%
```

---

## 📊 风险等级判定标准

### 风险等级划分

| 违约概率范围 | 风险等级 | 颜色标识 | 审批建议 |
|------------|---------|---------|---------|
| **< 5%** | 低风险 | 🟢 绿色 | 建议通过 |
| **5% - 15%** | 中低风险 | 🟡 黄色 | 建议通过 |
| **15% - 25%** | 中风险 | 🟠 橙色 | 条件通过（需审核） |
| **25% - 40%** | 中高风险 | 🔴 红色 | 谨慎审批 |
| **> 40%** | 高风险 | ⚫ 深红 | 建议拒绝 |

### 风险因子权重

不同风险因子的权重不同，反映其对违约概率的影响程度：

| 风险因子 | 权重 | 说明 |
|---------|------|------|
| **负债率** | 30% | 最重要的财务指标 |
| **客户类型** | 25% | 反映收入稳定性 |
| **历史逾期** | 20% | 反映信用历史 |
| **收入波动** | 15% | 反映收入稳定性 |
| **存款稳定** | 10% | 反映资金管理能力 |

---

## 💡 实际应用示例

### 示例1：低风险客户

**客户特征**：
- 客户类型：工薪阶层
- 负债率：35%
- 收入波动：8%
- 存款稳定：85%
- 历史逾期：0天

**风险计算**：
```
基础风险：5%
客户类型：0%（工薪阶层）
负债率：0%（低于40%阈值）
收入波动：0%（低于20%阈值）
存款稳定：-1.7%（正面因子，降低风险）
历史逾期：0%

最终违约概率：5% - 1.7% = 3.3%（低风险）
```

### 示例2：高风险客户

**客户特征**：
- 客户类型：小微企业主
- 负债率：62.4%
- 收入波动：25%
- 存款稳定：29%
- 历史逾期：45天

**风险计算**：
```
基础风险：5%
客户类型：5%（小微企业主）
负债率：6.72%（(62.4%-40%)×0.3）
收入波动：2.5%（25%×0.1）
存款稳定：0.71%（(1-29%)×0.01，负面因子）
历史逾期：2.75%（2% + (45-30)/60×3%）

最终违约概率：5% + 5% + 6.72% + 2.5% + 0.71% + 2.75% = 22.68%（中高风险）
```

---

## 🔍 风险因子数据来源

### 数据提取流程

1. **客户类型**
   - 来源：CRM系统客户档案
   - 字段：`customer_type` 或 `occupation`

2. **负债率**
   - 来源：核心银行系统
   - 计算：`总负债 / 总资产`
   - 数据：`total_liabilities`, `total_assets`

3. **收入波动**
   - 来源：核心银行系统交易流水
   - 计算：近12个月收入的变异系数
   - 数据：`monthly_income` 历史记录

4. **存款稳定**
   - 来源：核心银行系统账户余额
   - 计算：近6个月账户余额的稳定性
   - 数据：`account_balance` 历史记录

5. **历史逾期**
   - 来源：信贷系统还款记录
   - 计算：所有历史贷款的最大逾期天数
   - 数据：`repayment_history` 中的 `overdue_days`

---

## 📚 总结

### 风险因子确定原则

1. **数据驱动**：基于历史数据统计分析
2. **业务逻辑**：符合金融业务常识
3. **可解释性**：每个因子都有明确的业务含义
4. **动态调整**：根据实际效果持续优化

### 关键要点

- **负债率**是最重要的风险因子（权重30%）
- **客户类型**反映收入稳定性（权重25%）
- **历史逾期**反映信用表现（权重20%）
- **收入波动**和**存款稳定**反映资金管理能力（权重15%和10%）

### 使用建议

1. **综合评估**：不要只看单一因子，要综合所有因子
2. **动态监控**：定期更新风险因子数据
3. **阈值调整**：根据业务实际情况调整风险阈值
4. **持续优化**：基于实际违约数据优化权重

---

## 🔗 相关文档

- **模型预测与评估**: `docs/模型预测与评估指南.md`
- **特征工程**: `docs/银行数据提取与特征工程指南.md`
- **术语解释**: `docs/模型评估术语详解.md`

