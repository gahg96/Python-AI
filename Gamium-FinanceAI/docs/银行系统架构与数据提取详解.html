<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é“¶è¡Œç³»ç»Ÿæ¶æ„ä¸æ•°æ®æå–è¯¦è§£</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        
        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
            border-bottom: 4px solid #667eea;
            padding-bottom: 20px;
        }
        
        h2 {
            color: #34495e;
            font-size: 1.8em;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-left: 15px;
            border-left: 5px solid #667eea;
        }
        
        h3 {
            color: #555;
            font-size: 1.4em;
            margin-top: 30px;
            margin-bottom: 15px;
        }
        
        .system-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        
        .system-card h3 {
            color: white;
            margin-top: 0;
            font-size: 1.6em;
        }
        
        .system-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .system-info ul {
            list-style: none;
            padding-left: 0;
        }
        
        .system-info li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .system-info li:before {
            content: "âœ“ ";
            font-weight: bold;
            margin-right: 10px;
        }
        
        .diagram-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            border: 2px solid #e9ecef;
        }
        
        .data-flow {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .flow-step {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
        }
        
        .flow-step:not(:last-child):after {
            content: "â†’";
            position: absolute;
            right: -30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 2em;
            color: #667eea;
        }
        
        .flow-step .step-number {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 10px;
            overflow-x: auto;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .code-block pre {
            margin: 0;
        }
        
        .highlight {
            background: #fff3cd;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .tip-box {
            background: #d1ecf1;
            border-left: 4px solid #0c5460;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #856404;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .mermaid {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¦ é“¶è¡Œç³»ç»Ÿæ¶æ„ä¸æ•°æ®æå–è¯¦è§£</h1>
        
        <div style="text-align: center; color: #666; margin-bottom: 40px;">
            <p style="font-size: 1.1em;">å…¨é¢è§£æé“¶è¡Œæ ¸å¿ƒç³»ç»Ÿæ¶æ„ã€æ•°æ®å…³è”å…³ç³»åŠæå–æµç¨‹</p>
        </div>

        <!-- ç›®å½• -->
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 40px;">
            <h3 style="margin-top: 0;">ğŸ“‹ ç›®å½•</h3>
            <ul style="columns: 2; list-style: none;">
                <li>1. é“¶è¡Œç³»ç»Ÿæ•´ä½“æ¶æ„</li>
                <li>2. æ ¸å¿ƒç³»ç»Ÿè¯¦è§£</li>
                <li>3. ç³»ç»Ÿå…³è”å…³ç³»</li>
                <li>4. æ•°æ®æµå‘åˆ†æ</li>
                <li>5. æ•°æ®æå–æ–¹æ¡ˆ</li>
                <li>6. å…¸å‹åœºæ™¯æ¡ˆä¾‹</li>
            </ul>
        </div>

        <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šé“¶è¡Œç³»ç»Ÿæ•´ä½“æ¶æ„ -->
        <h2>1. é“¶è¡Œç³»ç»Ÿæ•´ä½“æ¶æ„</h2>
        
        <div class="diagram-container">
            <div class="mermaid">
graph TB
    subgraph "å‰ç«¯æ¸ é“å±‚"
        A1[ç½‘é“¶ç³»ç»Ÿ] 
        A2[æ‰‹æœºé“¶è¡Œ]
        A3[æŸœé¢ç³»ç»Ÿ]
        A4[ATM/è‡ªåŠ©è®¾å¤‡]
    end
    
    subgraph "ä¸šåŠ¡åº”ç”¨å±‚"
        B1[å®¢æˆ·å…³ç³»ç®¡ç†<br/>CRMç³»ç»Ÿ]
        B2[ä¿¡è´·ç®¡ç†ç³»ç»Ÿ<br/>Loan System]
        B3[æ ¸å¿ƒé“¶è¡Œç³»ç»Ÿ<br/>Core Banking]
        B4[é£æ§ç³»ç»Ÿ<br/>Risk System]
        B5[å¾ä¿¡ç³»ç»Ÿ<br/>Credit System]
    end
    
    subgraph "æ•°æ®å­˜å‚¨å±‚"
        C1[(å®¢æˆ·æ•°æ®åº“)]
        C2[(äº¤æ˜“æ•°æ®åº“)]
        C3[(ä¿¡è´·æ•°æ®åº“)]
        C4[(æ•°æ®ä»“åº“<br/>Data Warehouse)]
    end
    
    subgraph "æ•°æ®æå–å±‚"
        D1[ETLå·¥å…·]
        D2[APIç½‘å…³]
        D3[æ•°æ®æå–è„šæœ¬]
    end
    
    A1 --> B1
    A2 --> B1
    A3 --> B3
    A4 --> B3
    
    B1 --> C1
    B2 --> C3
    B3 --> C2
    B4 --> C1
    B4 --> C3
    B5 --> C3
    
    C1 --> C4
    C2 --> C4
    C3 --> C4
    
    C4 --> D1
    C4 --> D2
    C4 --> D3
    
    style B1 fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
    style B2 fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
    style B3 fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
    style C4 fill:#764ba2,stroke:#333,stroke-width:2px,color:#fff
            </div>
        </div>

        <p style="margin-top: 20px;">
            é“¶è¡Œç³»ç»Ÿé€šå¸¸é‡‡ç”¨<strong>åˆ†å±‚æ¶æ„</strong>ï¼Œä»ä¸Šåˆ°ä¸‹åˆ†ä¸ºï¼š
        </p>
        <ul style="margin-left: 30px; margin-top: 10px;">
            <li><strong>å‰ç«¯æ¸ é“å±‚</strong>ï¼šç”¨æˆ·äº¤äº’ç•Œé¢ï¼ŒåŒ…æ‹¬ç½‘é“¶ã€æ‰‹æœºé“¶è¡Œã€æŸœé¢ç³»ç»Ÿç­‰</li>
            <li><strong>ä¸šåŠ¡åº”ç”¨å±‚</strong>ï¼šæ ¸å¿ƒä¸šåŠ¡ç³»ç»Ÿï¼Œå¤„ç†å„ç§é“¶è¡Œä¸šåŠ¡é€»è¾‘</li>
            <li><strong>æ•°æ®å­˜å‚¨å±‚</strong>ï¼šå­˜å‚¨ä¸šåŠ¡æ•°æ®ï¼ŒåŒ…æ‹¬æ“ä½œå‹æ•°æ®åº“å’Œæ•°æ®ä»“åº“</li>
            <li><strong>æ•°æ®æå–å±‚</strong>ï¼šä»å„ç³»ç»Ÿæå–æ•°æ®ï¼Œç”¨äºåˆ†æå’Œå»ºæ¨¡</li>
        </ul>

        <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒç³»ç»Ÿè¯¦è§£ -->
        <h2>2. æ ¸å¿ƒç³»ç»Ÿè¯¦è§£</h2>

        <!-- CRMç³»ç»Ÿ -->
        <div class="system-card">
            <h3>ğŸ“Š å®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿ (CRM)</h3>
            <div class="system-info">
                <p><strong>ç³»ç»Ÿå®šä½</strong>ï¼šé“¶è¡Œå®¢æˆ·ä¿¡æ¯çš„æ ¸å¿ƒç®¡ç†å¹³å°</p>
                <p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p>
                <ul>
                    <li>å®¢æˆ·åŸºç¡€ä¿¡æ¯ç®¡ç†ï¼ˆå¹´é¾„ã€æ€§åˆ«ã€èŒä¸šã€æ•™è‚²èƒŒæ™¯ï¼‰</li>
                    <li>å®¢æˆ·åˆ†ç±»å’Œæ ‡ç­¾ç®¡ç†</li>
                    <li>å®¢æˆ·å…³ç³»ç»´æŠ¤ï¼ˆVIPç­‰çº§ã€å®¢æˆ·ç»ç†åˆ†é…ï¼‰</li>
                    <li>å®¢æˆ·ç”»åƒæ„å»º</li>
                    <li>è¥é”€æ´»åŠ¨ç®¡ç†</li>
                </ul>
                <p style="margin-top: 15px;"><strong>æ ¸å¿ƒæ•°æ®è¡¨</strong>ï¼š</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>è¡¨å</th>
                            <th>ä¸»è¦å­—æ®µ</th>
                            <th>æ•°æ®é‡çº§</th>
                        </tr>
                        <tr>
                            <td>customer_profile</td>
                            <td>customer_id, age, gender, education, occupation, industry, city_tier</td>
                            <td>ç™¾ä¸‡çº§</td>
                        </tr>
                        <tr>
                            <td>customer_tags</td>
                            <td>customer_id, tag_name, tag_value, create_date</td>
                            <td>åƒä¸‡çº§</td>
                        </tr>
                        <tr>
                            <td>customer_relationship</td>
                            <td>customer_id, manager_id, vip_level, relationship_start_date</td>
                            <td>ç™¾ä¸‡çº§</td>
                        </tr>
                    </table>
                </div>
                <p style="margin-top: 15px;"><strong>æ•°æ®æå–SQLç¤ºä¾‹</strong>ï¼š</p>
                <div class="code-block">
                    <pre>SELECT 
    customer_id,
    age,
    gender,
    education_level,
    occupation,
    industry,
    city_tier,
    registration_date,
    customer_type,
    vip_level,
    total_assets,
    monthly_income
FROM crm.customer_profile
WHERE registration_date >= '2015-01-01'
  AND status = 'active';</pre>
                </div>
            </div>
        </div>

        <!-- æ ¸å¿ƒé“¶è¡Œç³»ç»Ÿ -->
        <div class="system-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <h3>ğŸ’° æ ¸å¿ƒé“¶è¡Œç³»ç»Ÿ (Core Banking)</h3>
            <div class="system-info">
                <p><strong>ç³»ç»Ÿå®šä½</strong>ï¼šé“¶è¡Œæœ€æ ¸å¿ƒçš„ä¸šåŠ¡ç³»ç»Ÿï¼Œå¤„ç†æ‰€æœ‰è´¦æˆ·å’Œäº¤æ˜“</p>
                <p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p>
                <ul>
                    <li>è´¦æˆ·ç®¡ç†ï¼ˆå¼€æˆ·ã€é”€æˆ·ã€è´¦æˆ·ä¿¡æ¯ç»´æŠ¤ï¼‰</li>
                    <li>å­˜æ¬¾ä¸šåŠ¡ï¼ˆæ´»æœŸã€å®šæœŸã€é€šçŸ¥å­˜æ¬¾ï¼‰</li>
                    <li>äº¤æ˜“å¤„ç†ï¼ˆè½¬è´¦ã€æ”¯ä»˜ã€ç»“ç®—ï¼‰</li>
                    <li>è´¦æˆ·ä½™é¢ç®¡ç†</li>
                    <li>äº¤æ˜“æµæ°´è®°å½•</li>
                </ul>
                <p style="margin-top: 15px;"><strong>æ ¸å¿ƒæ•°æ®è¡¨</strong>ï¼š</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>è¡¨å</th>
                            <th>ä¸»è¦å­—æ®µ</th>
                            <th>æ•°æ®é‡çº§</th>
                        </tr>
                        <tr>
                            <td>accounts</td>
                            <td>account_id, customer_id, account_type, balance, open_date</td>
                            <td>åƒä¸‡çº§</td>
                        </tr>
                        <tr>
                            <td>transactions</td>
                            <td>transaction_id, account_id, transaction_type, amount, transaction_date</td>
                            <td>äº¿çº§</td>
                        </tr>
                        <tr>
                            <td>account_balance_history</td>
                            <td>account_id, balance_date, balance, avg_balance</td>
                            <td>åäº¿çº§</td>
                        </tr>
                    </table>
                </div>
                <p style="margin-top: 15px;"><strong>æ•°æ®æå–SQLç¤ºä¾‹</strong>ï¼š</p>
                <div class="code-block">
                    <pre>-- æå–è´¦æˆ·æ±‡æ€»ä¿¡æ¯
SELECT 
    a.customer_id,
    COUNT(DISTINCT a.account_id) as account_count,
    SUM(a.balance) as total_deposit_balance,
    AVG(a.balance) as avg_account_balance,
    MIN(a.open_date) as first_account_date
FROM core.accounts a
WHERE a.customer_id IN (SELECT customer_id FROM target_customers)
GROUP BY a.customer_id;

-- æå–äº¤æ˜“ç»Ÿè®¡
SELECT 
    t.customer_id,
    COUNT(*) as transaction_count,
    SUM(CASE WHEN t.type = 'income' THEN t.amount ELSE 0 END) as total_income,
    SUM(CASE WHEN t.type = 'expense' THEN t.amount ELSE 0 END) as total_expense,
    AVG(t.amount) as avg_transaction_amount
FROM core.transactions t
WHERE t.transaction_date >= DATE_SUB(NOW(), INTERVAL 12 MONTH)
GROUP BY t.customer_id;</pre>
                </div>
            </div>
        </div>

        <!-- ä¿¡è´·ç®¡ç†ç³»ç»Ÿ -->
        <div class="system-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <h3>ğŸ“‹ ä¿¡è´·ç®¡ç†ç³»ç»Ÿ (Loan Management System)</h3>
            <div class="system-info">
                <p><strong>ç³»ç»Ÿå®šä½</strong>ï¼šç®¡ç†é“¶è¡Œæ‰€æœ‰ä¿¡è´·ä¸šåŠ¡ï¼Œä»ç”³è¯·åˆ°è¿˜æ¬¾å…¨æµç¨‹</p>
                <p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p>
                <ul>
                    <li>è´·æ¬¾ç”³è¯·ç®¡ç†ï¼ˆç”³è¯·å½•å…¥ã€èµ„æ–™å®¡æ ¸ï¼‰</li>
                    <li>å®¡æ‰¹æµç¨‹ç®¡ç†ï¼ˆå®¡æ‰¹æµç¨‹ã€å®¡æ‰¹æ„è§ï¼‰</li>
                    <li>åˆåŒç®¡ç†ï¼ˆåˆåŒç”Ÿæˆã€åˆåŒç­¾ç½²ï¼‰</li>
                    <li>æ”¾æ¬¾ç®¡ç†ï¼ˆæ”¾æ¬¾å®¡æ ¸ã€æ”¾æ¬¾æ‰§è¡Œï¼‰</li>
                    <li>è¿˜æ¬¾ç®¡ç†ï¼ˆè¿˜æ¬¾è®¡åˆ’ã€è¿˜æ¬¾è®°å½•ã€é€¾æœŸç®¡ç†ï¼‰</li>
                    <li>è´·åç®¡ç†ï¼ˆè´·åæ£€æŸ¥ã€é£é™©é¢„è­¦ï¼‰</li>
                </ul>
                <p style="margin-top: 15px;"><strong>æ ¸å¿ƒæ•°æ®è¡¨</strong>ï¼š</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>è¡¨å</th>
                            <th>ä¸»è¦å­—æ®µ</th>
                            <th>æ•°æ®é‡çº§</th>
                        </tr>
                        <tr>
                            <td>loan_applications</td>
                            <td>loan_id, customer_id, apply_date, loan_amount, purpose, term, interest_rate</td>
                            <td>åƒä¸‡çº§</td>
                        </tr>
                        <tr>
                            <td>loan_approvals</td>
                            <td>loan_id, approval_status, approver, approval_date, approval_comment</td>
                            <td>åƒä¸‡çº§</td>
                        </tr>
                        <tr>
                            <td>repayment_history</td>
                            <td>loan_id, repayment_date, repayment_amount, overdue_days, loan_status</td>
                            <td>äº¿çº§</td>
                        </tr>
                    </table>
                </div>
                <p style="margin-top: 15px;"><strong>æ•°æ®æå–SQLç¤ºä¾‹</strong>ï¼š</p>
                <div class="code-block">
                    <pre>-- æå–è´·æ¬¾ç”³è¯·å’Œå®¡æ‰¹ä¿¡æ¯
SELECT 
    la.loan_id,
    la.customer_id,
    la.apply_date,
    la.loan_amount,
    la.loan_purpose,
    la.term_months,
    la.interest_rate,
    lap.approval_status,
    lap.approval_date,
    la.loan_status
FROM loan.loan_applications la
LEFT JOIN loan.loan_approvals lap ON la.loan_id = lap.loan_id
WHERE la.apply_date >= '2015-01-01';

-- æå–è¿˜æ¬¾å†å²
SELECT 
    rh.loan_id,
    rh.repayment_date,
    rh.repayment_amount,
    rh.overdue_days,
    rh.loan_status,
    la.customer_id
FROM loan.repayment_history rh
JOIN loan.loan_applications la ON rh.loan_id = la.loan_id
WHERE rh.repayment_date >= '2015-01-01';</pre>
                </div>
            </div>
        </div>

        <!-- é£æ§ç³»ç»Ÿ -->
        <div class="system-card" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
            <h3>ğŸ›¡ï¸ é£æ§ç³»ç»Ÿ (Risk Management System)</h3>
            <div class="system-info">
                <p><strong>ç³»ç»Ÿå®šä½</strong>ï¼šé“¶è¡Œé£é™©ç®¡ç†çš„æ ¸å¿ƒå¹³å°</p>
                <p><strong>ä¸»è¦åŠŸèƒ½</strong>ï¼š</p>
                <ul>
                    <li>ä¿¡ç”¨è¯„åˆ†è®¡ç®—</li>
                    <li>é£é™©æ¨¡å‹ç®¡ç†</li>
                    <li>é£é™©é¢„è­¦</li>
                    <li>é»‘åå•ç®¡ç†</li>
                    <li>åæ¬ºè¯ˆæ£€æµ‹</li>
                </ul>
                <p style="margin-top: 15px;"><strong>æ ¸å¿ƒæ•°æ®è¡¨</strong>ï¼š</p>
                <div class="table-container">
                    <table>
                        <tr>
                            <th>è¡¨å</th>
                            <th>ä¸»è¦å­—æ®µ</th>
                            <th>æ•°æ®é‡çº§</th>
                        </tr>
                        <tr>
                            <td>credit_scores</td>
                            <td>customer_id, score_date, credit_score, risk_level</td>
                            <td>ç™¾ä¸‡çº§</td>
                        </tr>
                        <tr>
                            <td>risk_alerts</td>
                            <td>customer_id, alert_type, alert_level, alert_date, description</td>
                            <td>ç™¾ä¸‡çº§</td>
                        </tr>
                        <tr>
                            <td>blacklist</td>
                            <td>customer_id, blacklist_type, add_date, reason</td>
                            <td>ä¸‡çº§</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šç³»ç»Ÿå…³è”å…³ç³» -->
        <h2>3. ç³»ç»Ÿå…³è”å…³ç³»</h2>

        <div class="diagram-container">
            <div class="mermaid">
erDiagram
    CUSTOMER_PROFILE ||--o{ ACCOUNTS : "æ‹¥æœ‰"
    CUSTOMER_PROFILE ||--o{ LOAN_APPLICATIONS : "ç”³è¯·"
    CUSTOMER_PROFILE ||--o{ CREDIT_SCORES : "è¯„åˆ†"
    
    ACCOUNTS ||--o{ TRANSACTIONS : "äº§ç”Ÿ"
    
    LOAN_APPLICATIONS ||--|| LOAN_APPROVALS : "å®¡æ‰¹"
    LOAN_APPLICATIONS ||--o{ REPAYMENT_HISTORY : "è¿˜æ¬¾"
    
    CUSTOMER_PROFILE {
        string customer_id PK
        int age
        string gender
        string education
        string industry
        decimal monthly_income
        decimal total_assets
    }
    
    ACCOUNTS {
        string account_id PK
        string customer_id FK
        string account_type
        decimal balance
        date open_date
    }
    
    TRANSACTIONS {
        string transaction_id PK
        string account_id FK
        string transaction_type
        decimal amount
        date transaction_date
    }
    
    LOAN_APPLICATIONS {
        string loan_id PK
        string customer_id FK
        date apply_date
        decimal loan_amount
        int term_months
        decimal interest_rate
    }
    
    REPAYMENT_HISTORY {
        string repayment_id PK
        string loan_id FK
        date repayment_date
        decimal repayment_amount
        int overdue_days
    }
            </div>
        </div>

        <div class="tip-box">
            <strong>ğŸ’¡ å…³é”®å…³è”å…³ç³»ï¼š</strong>
            <ul style="margin-top: 10px; margin-left: 20px;">
                <li><strong>customer_id</strong> æ˜¯æ ¸å¿ƒå…³è”å­—æ®µï¼Œè¿æ¥æ‰€æœ‰ç³»ç»Ÿæ•°æ®</li>
                <li>ä¸€ä¸ªå®¢æˆ·å¯ä»¥æœ‰å¤šä¸ªè´¦æˆ·ï¼ˆaccount_idï¼‰</li>
                <li>ä¸€ä¸ªå®¢æˆ·å¯ä»¥æœ‰å¤šç¬”è´·æ¬¾ï¼ˆloan_idï¼‰</li>
                <li>æ¯ç¬”è´·æ¬¾æœ‰å¤šæ¡è¿˜æ¬¾è®°å½•ï¼ˆrepayment_idï¼‰</li>
                <li>æ¯ä¸ªè´¦æˆ·æœ‰å¤šç¬”äº¤æ˜“è®°å½•ï¼ˆtransaction_idï¼‰</li>
            </ul>
        </div>

        <!-- ç¬¬å››éƒ¨åˆ†ï¼šæ•°æ®æµå‘åˆ†æ -->
        <h2>4. æ•°æ®æµå‘åˆ†æ</h2>

        <div class="diagram-container">
            <div class="mermaid">
flowchart LR
    subgraph "æ•°æ®äº§ç”Ÿ"
        A1[CRMç³»ç»Ÿ<br/>å®¢æˆ·æ³¨å†Œ]
        A2[æ ¸å¿ƒç³»ç»Ÿ<br/>è´¦æˆ·å¼€æˆ·]
        A3[æ ¸å¿ƒç³»ç»Ÿ<br/>äº¤æ˜“å‘ç”Ÿ]
        A4[ä¿¡è´·ç³»ç»Ÿ<br/>è´·æ¬¾ç”³è¯·]
        A5[ä¿¡è´·ç³»ç»Ÿ<br/>è¿˜æ¬¾è®°å½•]
    end
    
    subgraph "æ•°æ®å­˜å‚¨"
        B1[(CRMæ•°æ®åº“)]
        B2[(æ ¸å¿ƒæ•°æ®åº“)]
        B3[(ä¿¡è´·æ•°æ®åº“)]
    end
    
    subgraph "æ•°æ®æ•´åˆ"
        C1[æ•°æ®ä»“åº“<br/>ETLå¤„ç†]
        C2[æ•°æ®æ¹–<br/>åŸå§‹æ•°æ®]
    end
    
    subgraph "æ•°æ®æå–"
        D1[ç‰¹å¾å·¥ç¨‹]
        D2[æ¨¡å‹è®­ç»ƒ]
        D3[ä¸šåŠ¡åˆ†æ]
    end
    
    A1 --> B1
    A2 --> B2
    A3 --> B2
    A4 --> B3
    A5 --> B3
    
    B1 --> C1
    B2 --> C1
    B3 --> C1
    
    B1 --> C2
    B2 --> C2
    B3 --> C2
    
    C1 --> D1
    C2 --> D1
    
    D1 --> D2
    D1 --> D3
    
    style C1 fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
    style D1 fill:#764ba2,stroke:#333,stroke-width:2px,color:#fff
            </div>
        </div>

        <h3>æ•°æ®æµå‘è¯´æ˜</h3>
        <div class="data-flow">
            <div class="flow-step">
                <div class="step-number">1</div>
                <h4>æ•°æ®äº§ç”Ÿ</h4>
                <p>å„ä¸šåŠ¡ç³»ç»Ÿåœ¨æ—¥å¸¸è¿è¥ä¸­äº§ç”Ÿä¸šåŠ¡æ•°æ®</p>
            </div>
            <div class="flow-step">
                <div class="step-number">2</div>
                <h4>æ•°æ®å­˜å‚¨</h4>
                <p>æ•°æ®å®æ—¶å†™å…¥å„ç³»ç»Ÿçš„æ“ä½œå‹æ•°æ®åº“</p>
            </div>
            <div class="flow-step">
                <div class="step-number">3</div>
                <h4>æ•°æ®æ•´åˆ</h4>
                <p>é€šè¿‡ETLå·¥å…·å°†æ•°æ®æ•´åˆåˆ°æ•°æ®ä»“åº“æˆ–æ•°æ®æ¹–</p>
            </div>
            <div class="flow-step">
                <div class="step-number">4</div>
                <h4>æ•°æ®æå–</h4>
                <p>ä»æ•°æ®ä»“åº“æå–æ•°æ®ï¼Œè¿›è¡Œç‰¹å¾å·¥ç¨‹å’Œå»ºæ¨¡</p>
            </div>
        </div>

        <!-- ç¬¬äº”éƒ¨åˆ†ï¼šæ•°æ®æå–æ–¹æ¡ˆ -->
        <h2>5. æ•°æ®æå–æ–¹æ¡ˆ</h2>

        <h3>5.1 å®Œæ•´æ•°æ®æå–æµç¨‹</h3>
        <div class="diagram-container">
            <div class="mermaid">
flowchart TD
    Start([å¼€å§‹æ•°æ®æå–]) --> Step1[1. æå–å®¢æˆ·åŸºç¡€æ•°æ®<br/>ä»CRMç³»ç»Ÿ]
    Step1 --> Step2[2. æå–è´¦æˆ·æ•°æ®<br/>ä»æ ¸å¿ƒç³»ç»Ÿ]
    Step2 --> Step3[3. æå–äº¤æ˜“æ•°æ®<br/>ä»æ ¸å¿ƒç³»ç»Ÿ]
    Step3 --> Step4[4. æå–è´·æ¬¾æ•°æ®<br/>ä»ä¿¡è´·ç³»ç»Ÿ]
    Step4 --> Step5[5. æå–è¿˜æ¬¾æ•°æ®<br/>ä»ä¿¡è´·ç³»ç»Ÿ]
    Step5 --> Step6[6. æ•°æ®æ¸…æ´—<br/>å¤„ç†ç¼ºå¤±å€¼å’Œå¼‚å¸¸å€¼]
    Step6 --> Step7[7. æ•°æ®åˆå¹¶<br/>ä»¥customer_idä¸ºé”®]
    Step7 --> Step8[8. ç‰¹å¾å·¥ç¨‹<br/>è®¡ç®—è¡ç”Ÿç‰¹å¾]
    Step8 --> Step9[9. æ•°æ®éªŒè¯<br/>æ£€æŸ¥æ•°æ®è´¨é‡]
    Step9 --> Step10[10. æ•°æ®å­˜å‚¨<br/>ä¿å­˜ä¸ºParquetæ ¼å¼]
    Step10 --> End([å®Œæˆ])
    
    style Step1 fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
    style Step2 fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
    style Step3 fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
    style Step4 fill:#4facfe,stroke:#333,stroke-width:2px,color:#fff
    style Step5 fill:#4facfe,stroke:#333,stroke-width:2px,color:#fff
    style Step8 fill:#764ba2,stroke:#333,stroke-width:2px,color:#fff
            </div>
        </div>

        <h3>5.2 æ•°æ®æå–SQLç¤ºä¾‹ï¼ˆå®Œæ•´ç‰ˆï¼‰</h3>
        <div class="code-block">
            <pre>-- ============================================
-- æ­¥éª¤1: æå–å®¢æˆ·åŸºç¡€æ•°æ®
-- ============================================
SELECT 
    c.customer_id,
    c.age,
    c.gender,
    c.education_level,
    c.occupation,
    c.industry,
    c.city_tier,
    c.registration_date,
    c.customer_type,
    c.vip_level,
    c.total_assets,
    c.total_liabilities,
    c.monthly_income
FROM crm.customer_profile c
WHERE c.registration_date >= '2015-01-01'
  AND c.status = 'active';

-- ============================================
-- æ­¥éª¤2: æå–è´¦æˆ·æ±‡æ€»æ•°æ®
-- ============================================
SELECT 
    a.customer_id,
    COUNT(DISTINCT a.account_id) as account_count,
    SUM(a.balance) as total_deposit_balance,
    AVG(a.balance) as avg_account_balance,
    MIN(a.open_date) as first_account_date,
    MAX(a.balance) as max_account_balance
FROM core.accounts a
WHERE a.customer_id IN (SELECT customer_id FROM target_customers)
GROUP BY a.customer_id;

-- ============================================
-- æ­¥éª¤3: æå–äº¤æ˜“ç»Ÿè®¡æ•°æ®ï¼ˆè¿‘12ä¸ªæœˆï¼‰
-- ============================================
SELECT 
    t.customer_id,
    COUNT(*) as transaction_count,
    SUM(CASE WHEN t.transaction_type = 'income' THEN t.transaction_amount ELSE 0 END) as total_income,
    SUM(CASE WHEN t.transaction_type = 'expense' THEN t.transaction_amount ELSE 0 END) as total_expense,
    AVG(t.transaction_amount) as avg_transaction_amount,
    STDDEV(t.transaction_amount) as transaction_std
FROM core.transactions t
WHERE t.customer_id IN (SELECT customer_id FROM target_customers)
  AND t.transaction_date >= DATE_SUB(NOW(), INTERVAL 12 MONTH)
GROUP BY t.customer_id;

-- ============================================
-- æ­¥éª¤4: æå–è´·æ¬¾ç”³è¯·æ•°æ®
-- ============================================
SELECT 
    la.loan_id,
    la.customer_id,
    la.apply_date,
    la.loan_amount,
    la.loan_purpose,
    la.term_months,
    la.interest_rate,
    lap.approval_status,
    lap.approval_date,
    la.loan_status
FROM loan.loan_applications la
LEFT JOIN loan.loan_approvals lap ON la.loan_id = lap.loan_id
WHERE la.customer_id IN (SELECT customer_id FROM target_customers)
  AND la.apply_date >= '2015-01-01';

-- ============================================
-- æ­¥éª¤5: æå–è¿˜æ¬¾å†å²æ•°æ®
-- ============================================
SELECT 
    rh.loan_id,
    rh.repayment_date,
    rh.repayment_amount,
    rh.overdue_days,
    rh.loan_status,
    la.customer_id
FROM loan.repayment_history rh
JOIN loan.loan_applications la ON rh.loan_id = la.loan_id
WHERE la.customer_id IN (SELECT customer_id FROM target_customers)
  AND rh.repayment_date >= '2015-01-01';

-- ============================================
-- æ­¥éª¤6: åˆå¹¶æ‰€æœ‰æ•°æ®ï¼ˆåœ¨Pythonä¸­æ‰§è¡Œï¼‰
-- ============================================
-- ä½¿ç”¨ customer_id ä½œä¸ºä¸»é”®è¿›è¡Œ LEFT JOIN
-- è®¡ç®—è¡ç”Ÿç‰¹å¾
-- å¤„ç†ç¼ºå¤±å€¼
-- ä¿å­˜ä¸º Parquet æ ¼å¼</pre>
        </div>

        <!-- ç¬¬å…­éƒ¨åˆ†ï¼šå…¸å‹åœºæ™¯æ¡ˆä¾‹ -->
        <h2>6. å…¸å‹åœºæ™¯æ¡ˆä¾‹</h2>

        <h3>åœºæ™¯1ï¼šå®¢æˆ·ä¿¡ç”¨è¯„åˆ†ç‰¹å¾æå–</h3>
        <div class="diagram-container">
            <div class="mermaid">
flowchart LR
    A[CRMç³»ç»Ÿ<br/>å®¢æˆ·åŸºç¡€ä¿¡æ¯] --> E[ç‰¹å¾å·¥ç¨‹]
    B[æ ¸å¿ƒç³»ç»Ÿ<br/>è´¦æˆ·å’Œäº¤æ˜“] --> E
    C[ä¿¡è´·ç³»ç»Ÿ<br/>è´·æ¬¾å†å²] --> E
    D[é£æ§ç³»ç»Ÿ<br/>ä¿¡ç”¨è¯„åˆ†] --> E
    
    E --> F[å®¢æˆ·ä¿¡ç”¨ç‰¹å¾è¡¨]
    
    F --> G[æ¨¡å‹è®­ç»ƒ]
    
    style E fill:#764ba2,stroke:#333,stroke-width:2px,color:#fff
    style F fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
            </div>
        </div>

        <div class="code-block">
            <pre>-- å®¢æˆ·ä¿¡ç”¨è¯„åˆ†ç‰¹å¾æå–SQL
WITH customer_base AS (
    SELECT customer_id, age, gender, education, industry, monthly_income
    FROM crm.customer_profile
),
account_summary AS (
    SELECT 
        customer_id,
        SUM(balance) as total_deposit,
        AVG(balance) as avg_balance
    FROM core.accounts
    GROUP BY customer_id
),
loan_summary AS (
    SELECT 
        customer_id,
        COUNT(*) as loan_count,
        SUM(CASE WHEN loan_status = 'defaulted' THEN 1 ELSE 0 END) as default_count,
        MAX(overdue_days) as max_overdue_days
    FROM loan.loan_applications
    GROUP BY customer_id
)
SELECT 
    cb.customer_id,
    cb.age,
    cb.monthly_income,
    COALESCE(ac.total_deposit, 0) as total_deposit,
    COALESCE(ls.loan_count, 0) as loan_count,
    COALESCE(ls.default_count, 0) as default_count,
    COALESCE(ls.max_overdue_days, 0) as max_overdue_days,
    -- è®¡ç®—è¡ç”Ÿç‰¹å¾
    CASE 
        WHEN cb.monthly_income > 0 THEN COALESCE(ac.total_deposit, 0) / (cb.monthly_income * 12)
        ELSE 0 
    END as savings_ratio
FROM customer_base cb
LEFT JOIN account_summary ac ON cb.customer_id = ac.customer_id
LEFT JOIN loan_summary ls ON cb.customer_id = ls.customer_id;</pre>
        </div>

        <h3>åœºæ™¯2ï¼šè´·æ¬¾å®¡æ‰¹å†³ç­–ç‰¹å¾æå–</h3>
        <div class="diagram-container">
            <div class="mermaid">
flowchart TD
    A[æ–°è´·æ¬¾ç”³è¯·] --> B{æå–å®¢æˆ·å†å²æ•°æ®}
    B --> C[å®¢æˆ·åŸºç¡€ä¿¡æ¯]
    B --> D[è´¦æˆ·äº¤æ˜“æ•°æ®]
    B --> E[å†å²è´·æ¬¾è®°å½•]
    B --> F[ä¿¡ç”¨è¯„åˆ†]
    
    C --> G[ç‰¹å¾è®¡ç®—]
    D --> G
    E --> G
    F --> G
    
    G --> H[å®¡æ‰¹å†³ç­–ç‰¹å¾]
    H --> I[æ¨¡å‹é¢„æµ‹]
    
    style G fill:#764ba2,stroke:#333,stroke-width:2px,color:#fff
    style H fill:#667eea,stroke:#333,stroke-width:2px,color:#fff
            </div>
        </div>

        <div class="code-block">
            <pre>-- è´·æ¬¾å®¡æ‰¹å†³ç­–ç‰¹å¾æå–
SELECT 
    la.loan_id,
    la.customer_id,
    la.loan_amount,
    la.term_months,
    la.interest_rate,
    -- å®¢æˆ·åŸºç¡€ç‰¹å¾
    cp.age,
    cp.monthly_income,
    cp.total_assets,
    cp.total_liabilities,
    -- è´¦æˆ·ç‰¹å¾
    ac.total_deposit_balance,
    ac.avg_account_balance,
    -- äº¤æ˜“ç‰¹å¾
    tx.total_income,
    tx.total_expense,
    tx.income_volatility,
    -- å†å²è´·æ¬¾ç‰¹å¾
    lh.total_loans,
    lh.default_count,
    lh.max_overdue_days,
    lh.months_since_last_loan,
    -- ä¿¡ç”¨è¯„åˆ†
    cs.credit_score,
    -- è®¡ç®—è¡ç”Ÿç‰¹å¾
    la.loan_amount / NULLIF(cp.monthly_income * 12, 0) as loan_to_income_ratio,
    cp.total_liabilities / NULLIF(cp.total_assets, 0) as debt_ratio,
    (tx.total_income - tx.total_expense) / NULLIF(tx.total_income, 0) as savings_rate
FROM loan.loan_applications la
JOIN crm.customer_profile cp ON la.customer_id = cp.customer_id
LEFT JOIN (
    SELECT customer_id, SUM(balance) as total_deposit_balance, AVG(balance) as avg_account_balance
    FROM core.accounts GROUP BY customer_id
) ac ON la.customer_id = ac.customer_id
LEFT JOIN (
    SELECT 
        customer_id,
        SUM(CASE WHEN type = 'income' THEN amount ELSE 0 END) as total_income,
        SUM(CASE WHEN type = 'expense' THEN amount ELSE 0 END) as total_expense,
        STDDEV(amount) / AVG(amount) as income_volatility
    FROM core.transactions
    WHERE transaction_date >= DATE_SUB(NOW(), INTERVAL 12 MONTH)
    GROUP BY customer_id
) tx ON la.customer_id = tx.customer_id
LEFT JOIN (
    SELECT 
        customer_id,
        COUNT(*) as total_loans,
        SUM(CASE WHEN loan_status = 'defaulted' THEN 1 ELSE 0 END) as default_count,
        MAX(overdue_days) as max_overdue_days,
        DATEDIFF(NOW(), MAX(apply_date)) / 30 as months_since_last_loan
    FROM loan.loan_applications
    WHERE apply_date < (SELECT apply_date FROM loan.loan_applications WHERE loan_id = la.loan_id)
    GROUP BY customer_id
) lh ON la.customer_id = lh.customer_id
LEFT JOIN risk.credit_scores cs ON la.customer_id = cs.customer_id
WHERE la.apply_date >= '2024-01-01';</pre>
        </div>

        <div class="warning-box">
            <strong>âš ï¸ æ³¨æ„äº‹é¡¹ï¼š</strong>
            <ul style="margin-top: 10px; margin-left: 20px;">
                <li>å¤§æ•°æ®é‡æŸ¥è¯¢æ—¶ï¼Œå»ºè®®ä½¿ç”¨å¢é‡æå–ï¼Œé¿å…å…¨è¡¨æ‰«æ</li>
                <li>JOINæ“ä½œå¯èƒ½å¾ˆæ…¢ï¼Œå»ºè®®å…ˆåœ¨æ•°æ®ä»“åº“ä¸­é¢„èšåˆ</li>
                <li>æ•æ„Ÿæ•°æ®æå–å‰å¿…é¡»è¿›è¡Œè„±æ•å¤„ç†</li>
                <li>æå–çš„æ•°æ®éœ€è¦ç¬¦åˆç›‘ç®¡åˆè§„è¦æ±‚</li>
            </ul>
        </div>

        <!-- æ€»ç»“ -->
        <h2>7. æ€»ç»“</h2>
        <div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px;">
            <h3>å…³é”®è¦ç‚¹</h3>
            <ul style="margin-left: 30px; margin-top: 15px;">
                <li><strong>ç³»ç»Ÿå…³è”</strong>ï¼šæ‰€æœ‰ç³»ç»Ÿé€šè¿‡ <code class="highlight">customer_id</code> å…³è”</li>
                <li><strong>æ•°æ®æå–</strong>ï¼šä¼˜å…ˆä»æ•°æ®ä»“åº“æå–ï¼Œé¿å…ç›´æ¥æŸ¥è¯¢ç”Ÿäº§åº“</li>
                <li><strong>ç‰¹å¾å·¥ç¨‹</strong>ï¼šç»“åˆå¤šç³»ç»Ÿæ•°æ®è®¡ç®—ç»¼åˆç‰¹å¾</li>
                <li><strong>æ•°æ®å®‰å…¨</strong>ï¼šæå–å‰å¿…é¡»è¿›è¡Œæ•°æ®è„±æ•</li>
                <li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šä½¿ç”¨ç´¢å¼•ã€åˆ†æ‰¹å¤„ç†ã€å¢é‡æå–</li>
            </ul>
            
            <h3 style="margin-top: 30px;">æ¨èå·¥å…·</h3>
            <ul style="margin-left: 30px; margin-top: 15px;">
                <li><strong>æ•°æ®æå–</strong>ï¼šä½¿ç”¨æˆ‘ä»¬æä¾›çš„ <code>extract_banking_data.py</code> è„šæœ¬</li>
                <li><strong>ETLå·¥å…·</strong>ï¼šApache Airflowã€Talendã€Informatica</li>
                <li><strong>æ•°æ®å­˜å‚¨</strong>ï¼šParquetæ ¼å¼ï¼ˆé«˜æ•ˆå‹ç¼©ã€åˆ—å¼å­˜å‚¨ï¼‰</li>
                <li><strong>æ•°æ®åˆ†æ</strong>ï¼šPandasã€PySparkã€DuckDB</li>
            </ul>
        </div>

        <div style="text-align: center; margin-top: 40px; padding-top: 20px; border-top: 2px solid #e9ecef; color: #666;">
            <p>ğŸ“š æ›´å¤šè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒï¼š</p>
            <p><code>docs/é“¶è¡Œæ•°æ®æå–ä¸ç‰¹å¾å·¥ç¨‹æŒ‡å—.md</code></p>
            <p><code>docs/æ•°æ®æå–å¿«é€ŸæŒ‡å—.md</code></p>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
    </script>
</body>
</html>

