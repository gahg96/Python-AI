<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamium Finance AI - é‡‘èå†³ç­–æ™ºèƒ½å¹³å°</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #131a2b;
            --bg-card: #1a2332;
            --bg-hover: #243044;
            --accent-primary: #00d4aa;
            --accent-secondary: #7c3aed;
            --accent-warning: #f59e0b;
            --accent-danger: #ef4444;
            --accent-blue: #3b82f6;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #2d3a4f;
            --gradient-primary: linear-gradient(135deg, #00d4aa 0%, #7c3aed 100%);
            --gradient-card: linear-gradient(180deg, rgba(26, 35, 50, 0.9) 0%, rgba(19, 26, 43, 0.95) 100%);
            --shadow-glow: 0 0 40px rgba(0, 212, 170, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* èƒŒæ™¯æ•ˆæœ */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(0, 212, 170, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(124, 58, 237, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(59, 130, 246, 0.05) 0%, transparent 40%);
            pointer-events: none;
            z-index: 0;
        }

        /* å¯¼èˆªæ  */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: rgba(10, 14, 23, 0.85);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            padding: 0 24px;
            z-index: 1000;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            font-size: 28px;
        }

        .nav-tabs {
            display: flex;
            gap: 8px;
            margin-left: 48px;
        }

        .nav-tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .nav-tab:hover {
            color: var(--text-primary);
            background: var(--bg-hover);
        }

        .nav-tab.active {
            color: var(--accent-primary);
            background: rgba(0, 212, 170, 0.1);
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            position: relative;
            margin-top: 64px;
            padding: 24px;
            z-index: 1;
        }

        .page {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* å¡ç‰‡ */
        .card {
            background: var(--gradient-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-glow);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            font-size: 24px;
        }

        /* ç½‘æ ¼å¸ƒå±€ */
        .grid {
            display: grid;
            gap: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(2, 1fr);
        }

        .grid-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .grid-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        @media (max-width: 1200px) {
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
            .grid-3 { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 768px) {
            .grid-4, .grid-3, .grid-2 { grid-template-columns: 1fr; }
            .nav-tabs { display: none; }
        }

        /* ç»Ÿè®¡å¡ç‰‡ */
        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px rgba(0, 212, 170, 0.1);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-value.positive { color: var(--accent-primary); }
        .stat-value.negative { color: var(--accent-danger); }
        .stat-value.warning { color: var(--accent-warning); }

        .stat-change {
            font-size: 12px;
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* æŒ‰é’® */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 20px rgba(0, 212, 170, 0.3);
        }

        .btn-secondary {
            background: var(--bg-hover);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
            border-color: var(--accent-primary);
        }
        
        /* å¼¹çª—æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            width: 90%;
            max-width: 900px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--accent-primary);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        
        .modal-close:hover {
            color: var(--accent-danger);
        }
        
        .modal-body {
            padding: 24px;
            overflow-y: auto;
            max-height: calc(85vh - 80px);
        }
        
        .detail-section {
            margin-bottom: 24px;
        }
        
        .detail-section-title {
            font-size: 14px;
            color: var(--accent-primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }
        
        .detail-item {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
        }
        
        .detail-label {
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .detail-value {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-top: 4px;
        }
        
        .detail-value.positive { color: var(--accent-success); }
        .detail-value.warning { color: var(--accent-warning); }
        .detail-value.negative { color: var(--accent-danger); }
        
        .risk-meter {
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .risk-meter-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .analysis-card {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .analysis-title {
            font-size: 13px;
            color: var(--accent-primary);
            margin-bottom: 12px;
        }
        
        .factor-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .factor-name {
            width: 100px;
            font-size: 12px;
            color: var(--text-muted);
        }
        
        .factor-bar-bg {
            flex: 1;
            height: 8px;
            background: var(--bg-card);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .factor-bar-fill {
            height: 100%;
            border-radius: 4px;
        }
        
        .factor-value {
            width: 50px;
            text-align: right;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* æ­¥éª¤è¯¦æƒ…æ ·å¼ */
        .step-link {
            font-size: 12px;
            color: var(--accent-primary);
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
        }
        
        .timeline-item:hover .step-link {
            opacity: 1;
        }
        
        .step-detail {
            display: none;
            margin-top: 12px;
            padding: 12px;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 13px;
        }
        
        .step-detail.show {
            display: block;
        }
        
        .action-item {
            display: flex;
            align-items: flex-start;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .action-item:last-child {
            border-bottom: none;
        }
        
        .action-icon {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 12px;
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-primary);
        }
        
        .action-content {
            flex: 1;
        }
        
        .action-name {
            font-weight: 500;
            color: var(--text-primary);
        }
        
        .action-desc {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
        }
        
        .action-time {
            font-size: 11px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* å®¡è®¡æ—¥å¿—æ ·å¼ */
        .audit-entry {
            display: flex;
            padding: 12px;
            border-bottom: 1px solid var(--border-color);
            font-size: 13px;
        }
        
        .audit-entry:hover {
            background: var(--bg-secondary);
        }
        
        .audit-time {
            width: 100px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .audit-action {
            width: 150px;
            font-weight: 500;
            color: var(--accent-primary);
        }
        
        .audit-detail {
            flex: 1;
            color: var(--text-secondary);
        }
        
        .data-sample-table {
            width: 100%;
            font-size: 12px;
            border-collapse: collapse;
            margin-top: 8px;
        }
        
        .data-sample-table th,
        .data-sample-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .data-sample-table th {
            color: var(--accent-primary);
            font-weight: 500;
        }
        
        .feature-chip {
            display: inline-block;
            padding: 2px 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            margin: 2px;
            font-size: 11px;
            color: var(--text-secondary);
        }
        
        .rule-card {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
        }
        
        .rule-name {
            font-weight: 500;
            color: var(--accent-primary);
            margin-bottom: 8px;
        }
        
        .rule-params {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .rule-param {
            font-size: 12px;
            padding: 4px 8px;
            background: var(--bg-card);
            border-radius: 4px;
        }
        
        .rule-param span {
            color: var(--text-muted);
        }
        
        /* æ•°æ®æµè§ˆå™¨æ ·å¼ */
        .data-source-item {
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .data-source-item:hover {
            background: var(--bg-secondary);
            border-color: var(--accent-primary);
        }
        
        .data-source-item.active {
            background: rgba(59, 130, 246, 0.1);
            border-color: var(--accent-primary);
        }
        
        .data-file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 4px 0;
            background: var(--bg-secondary);
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }
        
        .data-file-item:hover {
            background: rgba(59, 130, 246, 0.15);
        }
        
        .data-file-item.active {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-primary);
        }
        
        .schema-table {
            width: 100%;
            font-size: 12px;
            border-collapse: collapse;
        }
        
        .schema-table th,
        .schema-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .schema-table th {
            background: var(--bg-secondary);
            color: var(--accent-primary);
            font-weight: 500;
        }
        
        .dtype-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .dtype-int { background: rgba(59, 130, 246, 0.2); color: #60a5fa; }
        .dtype-float { background: rgba(16, 185, 129, 0.2); color: #34d399; }
        .dtype-object { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .dtype-bool { background: rgba(139, 92, 246, 0.2); color: #a78bfa; }
        .dtype-datetime { background: rgba(236, 72, 153, 0.2); color: #f472b6; }
        
        .data-grid {
            width: 100%;
            overflow-x: auto;
        }
        
        .data-grid table {
            width: 100%;
            min-width: 800px;
            font-size: 12px;
            border-collapse: collapse;
        }
        
        .data-grid th,
        .data-grid td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .data-grid th {
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-weight: 500;
            position: sticky;
            top: 0;
        }
        
        .data-grid tr:hover {
            background: rgba(59, 130, 246, 0.05);
        }
        
        .data-grid tr {
            cursor: pointer;
        }
        
        .record-field {
            display: flex;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .record-field:last-child {
            border-bottom: none;
        }
        
        .field-name {
            width: 180px;
            font-weight: 500;
            color: var(--accent-primary);
            flex-shrink: 0;
        }
        
        .field-value {
            flex: 1;
            word-break: break-all;
        }
        
        .field-meta {
            width: 100px;
            text-align: right;
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .stat-bar {
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }
        
        .stat-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 4px;
        }

        .btn-danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-danger);
            border: 1px solid var(--accent-danger);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* è¡¨å• */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(0, 212, 170, 0.1);
        }

        .form-range {
            width: 100%;
            margin-top: 8px;
        }

        /* è¡¨æ ¼ */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 14px 16px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: var(--bg-hover);
        }

        /* è¿›åº¦æ¡ */
        .progress-bar {
            height: 8px;
            background: var(--bg-secondary);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.5s ease;
        }

        /* æ ‡ç­¾ */
        .badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-success {
            background: rgba(0, 212, 170, 0.15);
            color: var(--accent-primary);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent-warning);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--accent-danger);
        }

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 16px;
        }

        /* å®¢æˆ·ç”»åƒå¡ç‰‡ */
        .customer-profile {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .profile-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .profile-label {
            color: var(--text-muted);
            font-size: 13px;
        }

        .profile-value {
            font-weight: 500;
            font-family: 'JetBrains Mono', monospace;
        }

        /* é£é™©ä»ªè¡¨ç›˜ */
        .risk-meter {
            position: relative;
            width: 200px;
            height: 100px;
            margin: 20px auto;
        }

        /* æ¨¡æ‹Ÿæ§åˆ¶é¢æ¿ */
        .control-panel {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .control-group {
            flex: 1;
            min-width: 150px;
        }

        /* æ—¥å¿—é¢æ¿ */
        .log-panel {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 16px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
        }

        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-secondary);
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        /* æ—¶é—´çº¿ */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--border-color);
        }

        .timeline-item {
            position: relative;
            padding: 16px 0;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -24px;
            top: 20px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--accent-primary);
        }

        .timeline-item.pending::before {
            background: var(--text-muted);
        }

        .timeline-item.active::before {
            box-shadow: 0 0 0 4px rgba(0, 212, 170, 0.3);
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border-color);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ç»æµå‘¨æœŸæŒ‡ç¤ºå™¨ */
        .cycle-indicator {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .cycle-phase {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            font-size: 13px;
            font-weight: 500;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .cycle-phase.active {
            opacity: 1;
            transform: scale(1.05);
        }

        .cycle-boom { background: rgba(0, 212, 170, 0.2); color: var(--accent-primary); }
        .cycle-recession { background: rgba(245, 158, 11, 0.2); color: var(--accent-warning); }
        .cycle-depression { background: rgba(239, 68, 68, 0.2); color: var(--accent-danger); }
        .cycle-recovery { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }

        /* æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>

    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="logo">
            <span class="logo-icon">ğŸ®</span>
            <span>Gamium Finance AI</span>
        </div>
        <a href="/" class="nav-tab" style="text-decoration: none; margin-right: 10px; background: linear-gradient(135deg, rgba(0, 245, 255, 0.2), rgba(168, 85, 247, 0.2)); border: 1px solid rgba(0, 245, 255, 0.5);">
            ğŸ“º å¤§å±ç›‘æ§
        </a>
        <a href="/story" class="nav-tab" style="text-decoration: none; margin-right: 10px; background: linear-gradient(135deg, rgba(255, 184, 0, 0.2), rgba(255, 107, 53, 0.2)); border: 1px solid rgba(255, 184, 0, 0.5);">
            ğŸ“– é¡¹ç›®ä»‹ç»
        </a>
        <a href="/banking-architecture" class="nav-tab" style="text-decoration: none; margin-right: 20px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)); border: 1px solid rgba(102, 126, 234, 0.5);">
            ğŸ¦ ç³»ç»Ÿæ¶æ„
        </a>
        <div class="nav-tabs">
            <button class="nav-tab active" data-page="dashboard">ğŸ“Š ä»ªè¡¨ç›˜</button>
            <button class="nav-tab" data-page="customer">ğŸ‘¤ å®¢æˆ·é¢„æµ‹</button>
            <button class="nav-tab" data-page="analysis">ğŸ“ˆ å‘¨æœŸåˆ†æ</button>
            <button class="nav-tab" data-page="simulation">ğŸ¦ é“¶è¡Œæ¨¡æ‹Ÿ</button>
            <button class="nav-tab" data-page="comparison">âš”ï¸ ç­–ç•¥å¯¹æ¯”</button>
            <button class="nav-tab" data-page="distillation">ğŸ”¬ æ•°æ®è’¸é¦</button>
            <button class="nav-tab" data-page="databrowser">ğŸ“‚ æ•°æ®æµè§ˆ</button>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹ -->
    <main class="main-content">
        <!-- ä»ªè¡¨ç›˜é¡µé¢ -->
        <div id="page-dashboard" class="page active">
            <h1 style="margin-bottom: 24px; font-size: 28px;">æ¬¢è¿ä½¿ç”¨ Gamium Finance AI</h1>
            
            <div class="grid grid-4">
                <div class="stat-card">
                    <div class="stat-label">æ¨¡å‹çŠ¶æ€</div>
                    <div class="stat-value positive">å·²å°±ç»ª</div>
                    <div class="stat-change">âœ… ä¸–ç•Œæ¨¡å‹å·²åŠ è½½</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">æ”¯æŒå®¢æˆ·ç±»å‹</div>
                    <div class="stat-value">4</div>
                    <div class="stat-change">å·¥è–ª/å°å¾®/è‡ªç”±èŒä¸š/å†œæˆ·</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ç»æµå‘¨æœŸé˜¶æ®µ</div>
                    <div class="stat-value">4</div>
                    <div class="stat-change">ç¹è£/è¡°é€€/è§æ¡/å¤è‹</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ç­–ç•¥æ•°é‡</div>
                    <div class="stat-value">5</div>
                    <div class="stat-change">å« AlphaZero</div>
                </div>
            </div>

            <div class="grid grid-2" style="margin-top: 24px;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="card-icon">ğŸ¯</span> å¿«é€Ÿå¼€å§‹</div>
                    </div>
                    <div style="display: grid; gap: 12px;">
                        <button class="btn btn-secondary" onclick="switchPage('customer')">
                            ğŸ‘¤ ç”Ÿæˆå®¢æˆ·å¹¶é¢„æµ‹è¿çº¦é£é™©
                        </button>
                        <button class="btn btn-secondary" onclick="switchPage('analysis')">
                            ğŸ“ˆ åˆ†æç»æµå‘¨æœŸå¯¹è¿çº¦ç‡çš„å½±å“
                        </button>
                        <button class="btn btn-secondary" onclick="switchPage('simulation')">
                            ğŸ¦ æ¨¡æ‹Ÿé“¶è¡Œ10å¹´ç»è¥
                        </button>
                        <button class="btn btn-secondary" onclick="switchPage('comparison')">
                            âš”ï¸ å¯¹æ¯”ä¸åŒç­–ç•¥è¡¨ç°
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="card-icon">ğŸ“š</span> æ ¸å¿ƒèƒ½åŠ›</div>
                    </div>
                    <div class="timeline">
                        <div class="timeline-item">
                            <strong>æ•°æ®è’¸é¦</strong>
                            <p style="color: var(--text-muted); font-size: 13px; margin-top: 4px;">
                                ä»å†å²æ•°æ®ä¸­å­¦ä¹ "å•†ä¸šç‰©ç†å®šå¾‹"
                            </p>
                        </div>
                        <div class="timeline-item">
                            <strong>å®¢æˆ·é¢„æµ‹</strong>
                            <p style="color: var(--text-muted); font-size: 13px; margin-top: 4px;">
                                é¢„æµ‹è¿çº¦æ¦‚ç‡ã€LTVã€æµå¤±é£é™©
                            </p>
                        </div>
                        <div class="timeline-item">
                            <strong>ç»æµå‘¨æœŸæ¨¡æ‹Ÿ</strong>
                            <p style="color: var(--text-muted); font-size: 13px; margin-top: 4px;">
                                ç¹è£â†’è¡°é€€â†’è§æ¡â†’å¤è‹å®Œæ•´å‘¨æœŸ
                            </p>
                        </div>
                        <div class="timeline-item">
                            <strong>AlphaZero å†³ç­–</strong>
                            <p style="color: var(--text-muted); font-size: 13px; margin-top: 4px;">
                                è‡ªæˆ‘åšå¼ˆå­¦ä¹ æœ€ä¼˜ç»è¥ç­–ç•¥
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å®¢æˆ·é¢„æµ‹é¡µé¢ -->
        <div id="page-customer" class="page">
            <h1 style="margin-bottom: 24px;">ğŸ‘¤ å®¢æˆ·é¢„æµ‹</h1>
            
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="card-icon">âš™ï¸</span> é…ç½®å‚æ•°</div>
                    </div>
                    
                    <h4 style="margin: 0 0 16px; color: var(--accent-primary); font-size: 14px;">ğŸ‘¤ å®¢æˆ·å±æ€§</h4>
                    <div class="grid grid-3">
                        <div class="form-group">
                            <label class="form-label">å®¢æˆ·ç±»å‹</label>
                            <select id="customer-type" class="form-select" onchange="toggleEnterpriseFields()">
                                <option value="">éšæœº</option>
                                <optgroup label="ä¸ªäººå®¢æˆ·">
                                    <option value="salaried">å·¥è–ªé˜¶å±‚</option>
                                    <option value="small_business">å°å¾®ä¼ä¸šä¸»</option>
                                    <option value="freelancer">è‡ªç”±èŒä¸š</option>
                                    <option value="farmer">å†œæˆ·</option>
                                </optgroup>
                                <optgroup label="ä¼ä¸šå®¢æˆ·">
                                    <option value="micro_enterprise">å¾®å‹ä¼ä¸š (å¹´è¥æ”¶ < 1000ä¸‡)</option>
                                    <option value="small_enterprise">å°å‹ä¼ä¸š (å¹´è¥æ”¶ 1000-5000ä¸‡)</option>
                                    <option value="medium_enterprise">ä¸­å‹ä¼ä¸š (å¹´è¥æ”¶ 5000ä¸‡-2äº¿)</option>
                                    <option value="large_enterprise">å¤§å‹ä¼ä¸š (å¹´è¥æ”¶ > 2äº¿)</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">é£é™©ç”»åƒ</label>
                            <select id="risk-profile" class="form-select">
                                <option value="low">ä½é£é™©</option>
                                <option value="medium" selected>ä¸­ç­‰é£é™©</option>
                                <option value="high">é«˜é£é™©</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ‰€å±è¡Œä¸š</label>
                            <select id="customer-industry" class="form-select">
                                <option value="">éšæœº</option>
                                <option value="manufacturing">åˆ¶é€ ä¸š</option>
                                <option value="service">æœåŠ¡ä¸š</option>
                                <option value="retail">é›¶å”®ä¸š</option>
                                <option value="catering">é¤é¥®ä¸š</option>
                                <option value="it">IT/äº’è”ç½‘</option>
                                <option value="construction">å»ºç­‘ä¸š</option>
                                <option value="agriculture">å†œä¸š</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-3" style="margin-top: 12px;">
                        <div class="form-group">
                            <label class="form-label">åŸå¸‚ç­‰çº§</label>
                            <select id="customer-city" class="form-select">
                                <option value="">éšæœº</option>
                                <option value="tier_1">ä¸€çº¿åŸå¸‚</option>
                                <option value="tier_2">äºŒçº¿åŸå¸‚</option>
                                <option value="tier_3">ä¸‰çº¿åŸå¸‚</option>
                                <option value="tier_4">å››çº¿åŠä»¥ä¸‹</option>
                            </select>
                        </div>
                        <div class="form-group" id="age-field">
                            <label class="form-label">å¹´é¾„èŒƒå›´</label>
                            <select id="customer-age" class="form-select">
                                <option value="">éšæœº</option>
                                <option value="young">é’å¹´ (22-35)</option>
                                <option value="middle">ä¸­å¹´ (35-50)</option>
                                <option value="senior">ä¸­è€å¹´ (50+)</option>
                            </select>
                        </div>
                        <div class="form-group" id="years-field" style="display: none;">
                            <label class="form-label">æˆç«‹å¹´é™</label>
                            <select id="customer-years" class="form-select">
                                <option value="">éšæœº</option>
                                <option value="new">æ–°ä¼ä¸š (0-3å¹´)</option>
                                <option value="established">æˆç†Ÿä¼ä¸š (3-10å¹´)</option>
                                <option value="old">è€ä¼ä¸š (10å¹´ä»¥ä¸Š)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">å®¢æˆ·å…³ç³»</label>
                            <select id="customer-relation" class="form-select">
                                <option value="new">æ–°å®¢æˆ·</option>
                                <option value="normal" selected>æ™®é€šå®¢æˆ·</option>
                                <option value="vip">VIPå®¢æˆ·</option>
                            </select>
                        </div>
                    </div>
                    
                    <h4 style="margin: 20px 0 16px; color: var(--accent-primary); font-size: 14px;">ğŸ’° è´·æ¬¾æ¡ä»¶</h4>
                    <div class="grid grid-3">
                        <div class="form-group">
                            <label class="form-label">è´·æ¬¾é‡‘é¢ (å…ƒ)</label>
                            <input type="number" id="loan-amount" class="form-input" value="100000">
                        </div>
                        <div class="form-group">
                            <label class="form-label">å¹´åˆ©ç‡</label>
                            <input type="number" id="loan-rate" class="form-input" value="0.08" step="0.01">
                        </div>
                        <div class="form-group">
                            <label class="form-label">æœŸé™ (æœˆ)</label>
                            <input type="number" id="loan-term" class="form-input" value="24">
                        </div>
                    </div>
                    <div class="grid grid-2" style="margin-top: 12px;">
                        <div class="form-group">
                            <label class="form-label">è´·æ¬¾ç”¨é€”</label>
                            <select id="loan-purpose" class="form-select">
                                <option value="consumption">æ¶ˆè´¹</option>
                                <option value="business" selected>ç»è¥å‘¨è½¬</option>
                                <option value="house">è´­æˆ¿</option>
                                <option value="car">è´­è½¦</option>
                                <option value="education">æ•™è‚²</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ‹…ä¿æ–¹å¼</label>
                            <select id="loan-guarantee" class="form-select">
                                <option value="credit" selected>ä¿¡ç”¨</option>
                                <option value="mortgage">æŠµæŠ¼</option>
                                <option value="guarantee">æ‹…ä¿</option>
                            </select>
                        </div>
                    </div>
                    
                    <h4 style="margin: 20px 0 16px; color: var(--accent-primary); font-size: 14px;">ğŸŒ å®è§‚ç¯å¢ƒ</h4>
                    <div class="grid grid-2">
                        <div class="form-group">
                            <label class="form-label">ç»æµå‘¨æœŸ</label>
                            <select id="market-scenario" class="form-select">
                                <option value="boom">ç¹è£æœŸ (GDP +6%)</option>
                                <option value="normal" selected>æ­£å¸¸æœŸ (GDP +3%)</option>
                                <option value="recession">è¡°é€€æœŸ (GDP +1%)</option>
                                <option value="depression">è§æ¡æœŸ (GDP -2%)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">è´§å¸æ”¿ç­–</label>
                            <select id="market-policy" class="form-select">
                                <option value="loose">å®½æ¾ (ä½åˆ©ç‡)</option>
                                <option value="normal" selected>ä¸­æ€§</option>
                                <option value="tight">ç´§ç¼© (é«˜åˆ©ç‡)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- ä¼ä¸šå®¢æˆ·ä¸“ç”¨å­—æ®µï¼ˆé»˜è®¤éšè—ï¼‰ -->
                    <div id="enterprise-fields" style="display: none; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                        <h4 style="margin-bottom: 16px; color: var(--accent-primary); font-size: 14px;">ğŸ¢ ä¼ä¸šä¿¡æ¯ï¼ˆå¯é€‰ï¼Œç•™ç©ºå°†è‡ªåŠ¨ç”Ÿæˆï¼‰</h4>
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label class="form-label">å¹´è¥ä¸šæ”¶å…¥ (å…ƒ)</label>
                                <input type="number" id="enterprise-revenue" class="form-input" placeholder="ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">å‡€åˆ©æ¶¦ç‡ (%)</label>
                                <input type="number" id="enterprise-profit-margin" class="form-input" step="0.1" placeholder="ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">æµåŠ¨æ¯”ç‡</label>
                                <input type="number" id="enterprise-current-ratio" class="form-input" step="0.1" placeholder="ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">èµ„äº§è´Ÿå€ºç‡ (%)</label>
                                <input type="number" id="enterprise-debt-ratio" class="form-input" step="0.1" placeholder="ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ç ”å‘è´¹ç”¨ç‡ (%)</label>
                                <input type="number" id="enterprise-rnd-ratio" class="form-input" step="0.1" placeholder="ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ä¸“åˆ©æ€»æ•°</label>
                                <input type="number" id="enterprise-patents" class="form-input" placeholder="ç•™ç©ºè‡ªåŠ¨ç”Ÿæˆ">
                            </div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="generateAndPredict()" style="width: 100%; margin-top: 20px;">
                        ğŸ² ç”Ÿæˆå®¢æˆ·å¹¶é¢„æµ‹
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="card-icon">ğŸ“‹</span> é¢„æµ‹ç»“æœ</div>
                        <button class="btn btn-secondary" id="btn-customer-detail" onclick="showCustomerDetail()" style="display: none;">
                            ğŸ“„ æŸ¥çœ‹å®Œæ•´ç”»åƒ
                        </button>
                    </div>
                    <div id="prediction-result">
                        <div class="loading">
                            <p style="color: var(--text-muted);">ç‚¹å‡»"ç”Ÿæˆå®¢æˆ·å¹¶é¢„æµ‹"å¼€å§‹</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å®¢æˆ·è¯¦æƒ…å¼¹çª— -->
        <div id="customer-detail-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ğŸ“‹ å®¢æˆ·å®Œæ•´ç”»åƒ</h3>
                    <button class="modal-close" onclick="closeCustomerDetail()">Ã—</button>
                </div>
                <div class="modal-body" id="customer-detail-content">
                </div>
            </div>
        </div>
        
        <!-- LTVè¯´æ˜æ¨¡æ€æ¡† -->
        <div id="ltv-explanation-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3>ğŸ’° LTV (ç”Ÿå‘½å‘¨æœŸä»·å€¼) è¯´æ˜</h3>
                    <button class="modal-close" onclick="closeLTVExplanation()">Ã—</button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <div style="padding: 20px;">
                        <h4 style="color: var(--accent-primary); margin-bottom: 15px;">ä»€ä¹ˆæ˜¯LTVï¼Ÿ</h4>
                        <p style="margin-bottom: 15px; line-height: 1.8;">
                            <strong>LTV (Lifetime Value)</strong> = <strong>å®¢æˆ·ç”Ÿå‘½å‘¨æœŸä»·å€¼</strong><br>
                            LTVè¡¨ç¤ºé“¶è¡Œä»æŸä¸ªå®¢æˆ·èº«ä¸Šé¢„æœŸèƒ½è·å¾—çš„<strong>å‡€æ”¶ç›Š</strong>ï¼Œå³åœ¨æ•´ä¸ªå®¢æˆ·å…³ç³»å‘¨æœŸå†…ï¼Œé“¶è¡Œä»è¿™ä¸ªå®¢æˆ·èº«ä¸Šèµšåˆ°çš„é’±å‡å»å¯èƒ½æŸå¤±çš„é’±ã€‚
                        </p>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <h5 style="margin-bottom: 10px;">ğŸ“Š è®¡ç®—å…¬å¼ï¼š</h5>
                            <div style="font-family: monospace; background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; margin: 10px 0;">
                                LTV = åˆ©æ¯æ”¶å…¥ - é¢„æœŸæŸå¤± - è¿è¥æˆæœ¬
                            </div>
                            <ul style="margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                                <li><strong>åˆ©æ¯æ”¶å…¥</strong>ï¼šé“¶è¡Œä»å®¢æˆ·æ”¶å–çš„è´·æ¬¾åˆ©æ¯</li>
                                <li><strong>é¢„æœŸæŸå¤±</strong>ï¼šå®¢æˆ·è¿çº¦åå¯èƒ½æ— æ³•æ”¶å›çš„æœ¬é‡‘ï¼ˆ= è´·æ¬¾æœ¬é‡‘ Ã— è¿çº¦æ¦‚ç‡ Ã— 60%ï¼‰</li>
                                <li><strong>è¿è¥æˆæœ¬</strong>ï¼šå®¡æ‰¹ã€ç®¡ç†ã€å‚¬æ”¶ç­‰æˆæœ¬ï¼ˆé€šå¸¸ä¸ºè´·æ¬¾æœ¬é‡‘çš„2%ï¼‰</li>
                            </ul>
                        </div>
                        
                        <h4 style="color: var(--accent-primary); margin: 25px 0 15px;">å¦‚ä½•è§£è¯»LTVï¼Ÿ</h4>
                        <div class="grid grid-2" style="gap: 15px; margin: 15px 0;">
                            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1)); padding: 15px; border-radius: 8px; border-left: 4px solid #10b981;">
                                <div style="font-weight: bold; color: #10b981; margin-bottom: 8px;">LTV > 0ï¼ˆæ­£å€¼ï¼‰</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">
                                    è¿™ä¸ªå®¢æˆ·èƒ½ä¸ºé“¶è¡Œå¸¦æ¥åˆ©æ¶¦ï¼Œå€¼å¾—æ”¾è´·ã€‚æ•°å€¼è¶Šå¤§ï¼Œåˆ©æ¶¦è¶Šå¤šã€‚
                                </div>
                            </div>
                            <div style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1)); padding: 15px; border-radius: 8px; border-left: 4px solid #ef4444;">
                                <div style="font-weight: bold; color: #ef4444; margin-bottom: 8px;">LTV < 0ï¼ˆè´Ÿå€¼ï¼‰</div>
                                <div style="font-size: 13px; color: var(--text-secondary);">
                                    è¿™ä¸ªå®¢æˆ·å¯èƒ½è®©é“¶è¡ŒäºæŸï¼Œéœ€è¦è°¨æ…è€ƒè™‘ã€‚å¯èƒ½éœ€è¦æé«˜åˆ©ç‡æˆ–æ‹’ç»æ”¾è´·ã€‚
                                </div>
                            </div>
                        </div>
                        
                        <h4 style="color: var(--accent-primary); margin: 25px 0 15px;">å®é™…ç¤ºä¾‹</h4>
                        <div style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #f59e0b; margin: 15px 0;">
                            <strong>ç¤ºä¾‹ï¼šè´·æ¬¾100,000å…ƒï¼Œå¹´åˆ©ç‡6%ï¼ŒæœŸé™12ä¸ªæœˆï¼Œè¿çº¦æ¦‚ç‡10%</strong>
                            <div style="margin-top: 10px; font-size: 13px; line-height: 1.8;">
                                1. åˆ©æ¯æ”¶å…¥ = 3,320å…ƒ<br>
                                2. é¢„æœŸæŸå¤± = 100,000 Ã— 10% Ã— 60% = 6,000å…ƒ<br>
                                3. è¿è¥æˆæœ¬ = 100,000 Ã— 2% = 2,000å…ƒ<br>
                                <strong>LTV = 3,320 Ã— 90% - 6,000 - 2,000 = -5,012å…ƒ</strong><br>
                                <span style="color: #ef4444;">ç»“æœï¼šè´Ÿå€¼ï¼Œè¡¨ç¤ºå¯èƒ½äºæŸ</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                            <a href="/model-terms" target="_blank" style="color: var(--accent-primary); text-decoration: none; font-size: 13px;">
                                ğŸ“– æŸ¥çœ‹æ›´è¯¦ç»†çš„LTVè¯´æ˜æ–‡æ¡£ â†’
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- å‘¨æœŸåˆ†æé¡µé¢ -->
        <div id="page-analysis" class="page">
            <h1 style="margin-bottom: 24px;">ğŸ“ˆ ç»æµå‘¨æœŸå½±å“åˆ†æ</h1>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="card-icon">âš™ï¸</span> åˆ†æé…ç½®</div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary" id="btn-cycle-trace" onclick="showCycleTrace()" style="display: none;">
                            ğŸ“‹ åˆ†ææ—¥å¿—
                        </button>
                        <button class="btn btn-primary" onclick="runCycleAnalysis()">
                            ğŸ” è¿è¡Œåˆ†æ
                        </button>
                    </div>
                </div>
                <div class="form-group" style="max-width: 300px;">
                    <label class="form-label">æ ·æœ¬å®¢æˆ·æ•°é‡</label>
                    <input type="number" id="analysis-count" class="form-input" value="100" min="50" max="200">
                </div>
                <div id="cycle-run-id" style="font-size: 12px; color: var(--text-muted); margin-top: 8px;"></div>
            </div>
            
            <div id="analysis-result" style="display: none;">
                <!-- æ‘˜è¦ç»Ÿè®¡ -->
                <div class="grid grid-4" id="cycle-stats"></div>
                
                <!-- é¢„è­¦ä¿¡å· -->
                <div class="card" style="margin-top: 20px; display: none;" id="warnings-card">
                    <div class="card-header">
                        <div class="card-title">âš ï¸ é£é™©é¢„è­¦ä¿¡å·</div>
                    </div>
                    <div id="warnings-content"></div>
                </div>
                
                <!-- ä¸»è¦å›¾è¡¨ -->
                <div class="grid grid-2" style="margin-top: 20px;">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">ğŸ“Š å„å‘¨æœŸè¿çº¦ç‡å¯¹æ¯”</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="cycle-chart"></canvas>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">ğŸ‘¥ è§æ¡æœŸå„å®¢æˆ·ç±»å‹é£é™©</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="type-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- ç»æµæŒ‡æ ‡è¯¦ç»†å±•ç¤º -->
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <div class="card-title">ğŸ“ˆ å®è§‚ç»æµæŒ‡æ ‡è¯¦æƒ…</div>
                    </div>
                    <div class="grid grid-2" id="economic-indicators-grid"></div>
                </div>
                
                <!-- è¡Œä¸šé£é™©åˆ†æ -->
                <div class="card" style="margin-top: 20px; display: none;" id="industry-analysis-card">
                    <div class="card-header">
                        <div class="card-title">ğŸ­ è¡Œä¸šé£é™©åˆ†æ</div>
                    </div>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="industry-chart"></canvas>
                    </div>
                </div>
                
                <!-- é£é™©åˆ†å¸ƒ -->
                <div class="card" style="margin-top: 20px; display: none;" id="risk-distribution-card">
                    <div class="card-header">
                        <div class="card-title">ğŸ“Š é£é™©åˆ†å¸ƒåˆ†æ</div>
                    </div>
                    <div class="grid grid-2">
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="risk-distribution-chart"></canvas>
                        </div>
                        <div id="risk-distribution-stats"></div>
                    </div>
                </div>
                
                <!-- æŒ‡æ ‡ç›¸å…³æ€§åˆ†æ -->
                <div class="card" style="margin-top: 20px; display: none;" id="correlation-card">
                    <div class="card-header">
                        <div class="card-title">ğŸ”— æŒ‡æ ‡ç›¸å…³æ€§åˆ†æ</div>
                    </div>
                    <div id="correlation-content"></div>
                </div>
            </div>
        </div>

        <!-- é“¶è¡Œæ¨¡æ‹Ÿé¡µé¢ -->
        <div id="page-simulation" class="page">
            <h1 style="margin-bottom: 24px;">ğŸ¦ é“¶è¡Œç»è¥æ¨¡æ‹Ÿ</h1>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="card-icon">ğŸ®</span> æ¨¡æ‹Ÿæ§åˆ¶</div>
                    <button class="btn btn-secondary" id="btn-sim-trace" onclick="showSimulationTrace()" style="display: none;">
                        ğŸ“‹ æ¨¡æ‹Ÿæ—¥å¿—
                    </button>
                </div>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label class="form-label">é€‰æ‹©ç­–ç•¥</label>
                        <select id="sim-strategy" class="form-select">
                            <option value="rule_based">è§„åˆ™ç­–ç•¥ (æ¨¡æ‹Ÿä¼ ç»Ÿé“¶è¡Œ)</option>
                            <option value="conservative">ä¿å®ˆç­–ç•¥</option>
                            <option value="aggressive">æ¿€è¿›ç­–ç•¥</option>
                            <option value="random">éšæœºç­–ç•¥</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: flex-end; gap: 8px;">
                        <button class="btn btn-primary" onclick="runSimulation()" style="flex: 1;">
                            â–¶ï¸ è¿è¡Œ10å¹´æ¨¡æ‹Ÿ
                        </button>
                    </div>
                </div>
                <div id="sim-run-id" style="font-size: 12px; color: var(--text-muted); margin-top: 8px;"></div>
            </div>
            
            <div id="sim-result" style="display: none;">
                <div class="grid grid-4" id="sim-stats"></div>
                
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <div class="card-title">ğŸ“ˆ ç»è¥æ›²çº¿</div>
                    </div>
                    <div class="cycle-indicator" id="current-phase">
                        <div class="cycle-phase cycle-boom">ç¹è£</div>
                        <div class="cycle-phase cycle-recession">è¡°é€€</div>
                        <div class="cycle-phase cycle-depression">è§æ¡</div>
                        <div class="cycle-phase cycle-recovery">å¤è‹</div>
                    </div>
                    <div class="chart-container" style="height: 400px;">
                        <canvas id="sim-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç­–ç•¥å¯¹æ¯”é¡µé¢ -->
        <div id="page-comparison" class="page">
            <h1 style="margin-bottom: 24px;">âš”ï¸ ç­–ç•¥å¯¹æ¯”</h1>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title"><span class="card-icon">âš™ï¸</span> å¯¹æ¯”é…ç½®</div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-secondary" id="btn-comparison-trace" onclick="showComparisonTrace()" style="display: none;">
                            ğŸ“‹ å¯¹æ¯”æ—¥å¿—
                        </button>
                        <button class="btn btn-primary" onclick="runComparison()">
                            ğŸ å¼€å§‹å¯¹æ¯”
                        </button>
                    </div>
                </div>
                <div class="form-group" style="max-width: 300px;">
                    <label class="form-label">æ¯ç­–ç•¥è¯„ä¼°å›åˆæ•°</label>
                    <input type="number" id="comparison-episodes" class="form-input" value="3" min="1" max="5">
                </div>
                <div id="comparison-run-id" style="font-size: 12px; color: var(--text-muted); margin-top: 8px;"></div>
            </div>
            
            <div id="comparison-result" style="display: none;">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">ğŸ† ç­–ç•¥æ’å</div>
                    </div>
                    <div class="table-container">
                        <table id="comparison-table">
                            <thead>
                                <tr>
                                    <th>æ’å</th>
                                    <th>ç­–ç•¥</th>
                                    <th>å¹³å‡å¥–åŠ±</th>
                                    <th>ç´¯è®¡åˆ©æ¶¦</th>
                                    <th>å¹³å‡NPL</th>
                                    <th>ç ´äº§ç‡</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card" style="margin-top: 20px;">
                    <div class="card-header">
                        <div class="card-title">ğŸ“Š å¯è§†åŒ–å¯¹æ¯”</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="comparison-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ•°æ®è’¸é¦é¡µé¢ -->
        <div id="page-distillation" class="page">
            <h1 style="margin-bottom: 24px;">ğŸ”¬ æ•°æ®è’¸é¦</h1>
            
            <div class="grid grid-2">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="card-icon">âš™ï¸</span> è’¸é¦é…ç½®</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">æ•°æ®æ¥æº</label>
                        <select id="distill-source" class="form-input" onchange="updateDistillOptions()">
                            <option value="synthetic">ğŸ”§ åˆæˆæ•°æ® (æ¼”ç¤ºç”¨)</option>
                            <option value="test_data">ğŸ“Š æµ‹è¯•æ•°æ®é›† (10Kå®¢æˆ·)</option>
                            <option value="historical">ğŸ­ å®Œæ•´å†å²æ•°æ® (5Må®¢æˆ·)</option>
                        </select>
                    </div>
                    
                    <div id="synthetic-options">
                        <div class="form-group">
                            <label class="form-label">åˆæˆæ•°æ®é‡</label>
                            <input type="number" id="distill-size" class="form-input" value="1000" min="500" max="3000">
                        </div>
                    </div>
                    
                    <div id="real-data-options" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">é‡‡æ ·å¤§å° (ç•™ç©ºä½¿ç”¨å…¨éƒ¨)</label>
                            <input type="number" id="distill-sample" class="form-input" value="" placeholder="å¦‚: 50000">
                        </div>
                        <div id="data-source-info" class="stat-card" style="padding: 12px; margin-bottom: 12px;">
                            <div style="font-size: 12px; color: var(--text-muted);">æ­£åœ¨æ£€æŸ¥æ•°æ®æº...</div>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="runDistillation()" id="btn-distill" style="width: 100%; margin-top: 16px;">
                        ğŸ”¥ å¼€å§‹è’¸é¦
                    </button>
                    
                    <div id="distill-progress" style="margin-top: 24px; display: none;">
                        <div class="form-label">è¿›åº¦</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="distill-progress-bar" style="width: 0%"></div>
                        </div>
                        <div id="distill-percent" style="text-align: center; margin-top: 8px; font-family: 'JetBrains Mono';">0%</div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="card-icon">ğŸ“</span> è’¸é¦æ—¥å¿—</div>
                        <button class="btn btn-secondary" id="btn-audit-log" onclick="showAuditLog()" style="display: none;">
                            ğŸ“‹ å®¡è®¡æ—¥å¿—
                        </button>
                    </div>
                    <div class="log-panel" id="distill-logs">
                        <div class="log-entry" style="color: var(--text-muted);">ç­‰å¾…å¼€å§‹...</div>
                    </div>
                </div>
            </div>
            
            <!-- æ­¥éª¤è¯¦æƒ…å¡ç‰‡ -->
            <div class="card" style="margin-top: 20px;" id="distill-result">
                <div class="card-header">
                    <div class="card-title"><span class="card-icon">ğŸ“Š</span> è’¸é¦è¿‡ç¨‹è¿½è¸ª</div>
                    <span id="distill-run-id" style="font-size: 12px; color: var(--text-muted);"></span>
                </div>
                <div class="timeline" id="distill-steps">
                    <div class="timeline-item pending" data-step="1" onclick="showStepDetail(1)">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>ğŸ“¦ ç¬¬ä¸€æ­¥: æ•°æ®å‡†å¤‡</strong>
                                <p style="color: var(--text-muted); font-size: 13px;">æ”¶é›†å¹¶æ¸…æ´—å†å²è´·æ¬¾è®°å½•</p>
                            </div>
                            <span class="step-link">æŸ¥çœ‹è¯¦æƒ… â†’</span>
                        </div>
                        <div class="step-detail" id="step-detail-1"></div>
                    </div>
                    <div class="timeline-item pending" data-step="2" onclick="showStepDetail(2)">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>âš™ï¸ ç¬¬äºŒæ­¥: ç‰¹å¾å·¥ç¨‹</strong>
                                <p style="color: var(--text-muted); font-size: 13px;">æå–é™æ€/è¡Œä¸º/ä¿¡è´·/ç¯å¢ƒç‰¹å¾</p>
                            </div>
                            <span class="step-link">æŸ¥çœ‹è¯¦æƒ… â†’</span>
                        </div>
                        <div class="step-detail" id="step-detail-2"></div>
                    </div>
                    <div class="timeline-item pending" data-step="3" onclick="showStepDetail(3)">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>ğŸ§  ç¬¬ä¸‰æ­¥: è§„å¾‹å»ºæ¨¡</strong>
                                <p style="color: var(--text-muted); font-size: 13px;">è®­ç»ƒæ¨¡å‹å­¦ä¹ éšè—è§„å¾‹</p>
                            </div>
                            <span class="step-link">æŸ¥çœ‹è¯¦æƒ… â†’</span>
                        </div>
                        <div class="step-detail" id="step-detail-3"></div>
                    </div>
                    <div class="timeline-item pending" data-step="4" onclick="showStepDetail(4)">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>ğŸ“¦ ç¬¬å››æ­¥: å‡½æ•°å°è£…</strong>
                                <p style="color: var(--text-muted); font-size: 13px;">å°è£…ä¸º predict_customer_future() API</p>
                            </div>
                            <span class="step-link">æŸ¥çœ‹è¯¦æƒ… â†’</span>
                        </div>
                        <div class="step-detail" id="step-detail-4"></div>
                    </div>
                    <div class="timeline-item pending" data-step="5" onclick="showStepDetail(5)">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <p style="color: var(--text-muted); font-size: 13px;">ä½¿ç”¨ä¿ç•™æ•°æ®å›æµ‹éªŒè¯</p>
                            </div>
                            <span class="step-link">æŸ¥çœ‹è¯¦æƒ… â†’</span>
                        </div>
                        <div class="step-detail" id="step-detail-5"></div>
                    </div>
                </div>
            </div>
            
            <!-- éªŒè¯ç»“æœå¡ç‰‡ -->
            <div class="card" style="margin-top: 20px; display: none;" id="validation-card">
                <div class="card-header">
                    <div class="card-title"><span class="card-icon">ğŸ“ˆ</span> éªŒè¯ç»“æœè¯¦æƒ…</div>
                </div>
                <div id="validation-content"></div>
            </div>
        </div>
        
        <!-- æ•°æ®æµè§ˆå™¨é¡µé¢ -->
        <div id="page-databrowser" class="page">
            <h1 style="margin-bottom: 24px;">ğŸ“‚ æ•°æ®æµè§ˆå™¨</h1>
            
            <div class="grid grid-2">
                <!-- æ•°æ®æºé€‰æ‹© -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="card-icon">ğŸ“</span> æ•°æ®æº</div>
                        <button class="btn btn-secondary" onclick="refreshDataSources()">ğŸ”„ åˆ·æ–°</button>
                    </div>
                    <div id="data-sources-list">
                        <div style="text-align: center; color: var(--text-muted); padding: 20px;">åŠ è½½ä¸­...</div>
                    </div>
                </div>
                
                <!-- è¡¨ç»“æ„ -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><span class="card-icon">ğŸ“‹</span> è¡¨ç»“æ„</div>
                        <button class="btn btn-secondary" onclick="showTableStats()" id="btn-stats" style="display: none;">ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</button>
                    </div>
                    <div id="table-schema">
                        <div style="text-align: center; color: var(--text-muted); padding: 20px;">é€‰æ‹©æ•°æ®è¡¨æŸ¥çœ‹ç»“æ„</div>
                    </div>
                </div>
            </div>
            
            <!-- æ•°æ®è¡¨æ ¼ -->
            <div class="card" style="margin-top: 20px;">
                <div class="card-header">
                    <div class="card-title"><span class="card-icon">ğŸ“Š</span> æ•°æ®è®°å½•</div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="text" id="data-search" class="form-input" placeholder="æœç´¢..." 
                               style="width: 200px;" onkeypress="if(event.key==='Enter')searchData()">
                        <button class="btn btn-secondary" onclick="searchData()">ğŸ” æœç´¢</button>
                    </div>
                </div>
                <div id="data-table-container">
                    <div style="text-align: center; color: var(--text-muted); padding: 40px;">é€‰æ‹©æ•°æ®è¡¨æŸ¥çœ‹è®°å½•</div>
                </div>
                <div id="data-pagination" style="display: none; padding: 16px; border-top: 1px solid var(--border-color);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div id="pagination-info" style="color: var(--text-muted); font-size: 13px;"></div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary" onclick="prevPage()" id="btn-prev">â† ä¸Šä¸€é¡µ</button>
                            <button class="btn btn-secondary" onclick="nextPage()" id="btn-next">ä¸‹ä¸€é¡µ â†’</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- è®°å½•è¯¦æƒ…å¼¹çª— -->
        <div id="record-detail-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 id="record-modal-title">ğŸ“‹ è®°å½•è¯¦æƒ…</h3>
                    <button class="modal-close" onclick="closeRecordModal()">Ã—</button>
                </div>
                <div class="modal-body" id="record-modal-content" style="max-height: 70vh; overflow-y: auto;">
                </div>
            </div>
        </div>
        
        <!-- ç»Ÿè®¡ä¿¡æ¯å¼¹çª— -->
        <div id="stats-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <h3 id="stats-modal-title">ğŸ“Š æ•°æ®ç»Ÿè®¡</h3>
                    <button class="modal-close" onclick="closeStatsModal()">Ã—</button>
                </div>
                <div class="modal-body" id="stats-modal-content" style="max-height: 70vh; overflow-y: auto;">
                </div>
            </div>
        </div>
        
        <!-- å®¡è®¡æ—¥å¿—å¼¹çª— -->
        <div id="audit-log-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 1000px;">
                <div class="modal-header">
                    <h3>ğŸ“‹ è’¸é¦å®¡è®¡æ—¥å¿—</h3>
                    <button class="modal-close" onclick="closeAuditLog()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div id="audit-config" style="margin-bottom: 20px;"></div>
                    <div id="audit-log-content"></div>
                </div>
            </div>
        </div>
        
        <!-- æ­¥éª¤è¯¦æƒ…å¼¹çª— -->
        <div id="step-detail-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 800px;">
                <div class="modal-header">
                    <h3 id="step-modal-title">æ­¥éª¤è¯¦æƒ…</h3>
                    <button class="modal-close" onclick="closeStepModal()">Ã—</button>
                </div>
                <div class="modal-body" id="step-modal-content">
                </div>
            </div>
        </div>
        
        <!-- é€šç”¨è¿½è¸ªæ—¥å¿—å¼¹çª— -->
        <div id="trace-modal" class="modal" style="display: none;">
            <div class="modal-content" style="max-width: 1100px;">
                <div class="modal-header">
                    <h3 id="trace-modal-title">ğŸ“‹ è¿‡ç¨‹è¿½è¸ª</h3>
                    <button class="modal-close" onclick="closeTraceModal()">Ã—</button>
                </div>
                <div class="modal-body" id="trace-modal-content" style="max-height: 70vh; overflow-y: auto;">
                </div>
            </div>
        </div>
    </main>

    <script>
        // API åŸºç¡€åœ°å€
        const API_BASE = '';
        
        // é¡µé¢åˆ‡æ¢
        function switchPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            document.getElementById(`page-${pageName}`).classList.add('active');
            document.querySelector(`[data-page="${pageName}"]`).classList.add('active');
        }
        
        // å¯¼èˆªæ ‡ç­¾ç‚¹å‡»
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => switchPage(tab.dataset.page));
        });
        
        // ============================================================
        // å®¢æˆ·é¢„æµ‹
        // ============================================================
        
        let currentCustomerData = null;
        let currentPredictionData = null;
        
        async function generateAndPredict() {
            const resultDiv = document.getElementById('prediction-result');
            resultDiv.innerHTML = '<div class="loading"><div class="spinner"></div></div>';
            document.getElementById('btn-customer-detail').style.display = 'none';
            
            const marketScenarios = {
                boom: { gdp_growth: 0.06, unemployment_rate: 0.04, base_rate: 0.035 },
                normal: { gdp_growth: 0.03, unemployment_rate: 0.05, base_rate: 0.04 },
                recession: { gdp_growth: 0.01, unemployment_rate: 0.07, base_rate: 0.045 },
                depression: { gdp_growth: -0.02, unemployment_rate: 0.10, base_rate: 0.03 }
            };
            
            const policyRates = {
                loose: 0.03,
                normal: 0.04,
                tight: 0.05
            };
            
            const scenario = document.getElementById('market-scenario').value;
            const policy = document.getElementById('market-policy').value;
            const market = marketScenarios[scenario];
            
            try {
                const response = await fetch(`${API_BASE}/api/predict`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        customer_type: document.getElementById('customer-type').value,
                        risk_profile: document.getElementById('risk-profile').value,
                        loan: {
                            amount: parseFloat(document.getElementById('loan-amount').value),
                            interest_rate: parseFloat(document.getElementById('loan-rate').value),
                            term_months: parseInt(document.getElementById('loan-term').value)
                        },
                        market: {
                            gdp_growth: market.gdp_growth,
                            unemployment_rate: market.unemployment_rate,
                            base_interest_rate: policyRates[policy],
                            inflation_rate: 0.02,
                            credit_spread: 0.02
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentCustomerData = data.customer;
                    currentPredictionData = data.prediction;
                    
                    const c = data.customer;
                    const p = data.prediction;
                    const l = data.loan;
                    
                    document.getElementById('btn-customer-detail').style.display = 'block';
                    
                    const riskClass = p.default_probability < 0.05 ? 'positive' : 
                                     p.default_probability < 0.15 ? 'warning' : 'negative';
                    const ltvClass = p.expected_ltv > 0 ? 'positive' : 'negative';
                    const riskPercent = Math.min(100, p.default_probability * 200);
                    const riskColor = riskPercent < 30 ? '#10b981' : riskPercent < 60 ? '#f59e0b' : '#ef4444';
                    
                    // è®¡ç®—å®¡æ‰¹å»ºè®®
                    let decision = 'é€šè¿‡';
                    let decisionClass = 'positive';
                    let decisionReasons = [];
                    
                    if (p.default_probability > 0.25) {
                        decision = 'æ‹’ç»';
                        decisionClass = 'negative';
                        decisionReasons.push('è¿çº¦é£é™©è¿‡é«˜');
                    } else if (p.default_probability > 0.15) {
                        decision = 'äººå·¥å®¡æ ¸';
                        decisionClass = 'warning';
                        decisionReasons.push('é£é™©å¤„äºè¾¹ç•Œ');
                    }
                    
                    if (c.debt_ratio > 0.6) {
                        if (decision === 'é€šè¿‡') { decision = 'äººå·¥å®¡æ ¸'; decisionClass = 'warning'; }
                        decisionReasons.push('è´Ÿå€ºç‡åé«˜');
                    }
                    
                    const monthlyPayment = l.monthly_payment || (l.amount * (l.interest_rate / 12) / (1 - Math.pow(1 + l.interest_rate/12, -l.term_months)));
                    const paymentRatio = monthlyPayment / c.monthly_income;
                    
                    if (paymentRatio > 0.5) {
                        if (decision === 'é€šè¿‡') { decision = 'äººå·¥å®¡æ ¸'; decisionClass = 'warning'; }
                        decisionReasons.push('æœˆä¾›å æ”¶å…¥æ¯”è¿‡é«˜');
                    }
                    
                    if (decisionReasons.length === 0) {
                        decisionReasons.push('å„é¡¹æŒ‡æ ‡æ­£å¸¸');
                    }
                    
                    resultDiv.innerHTML = `
                        <!-- å®¡æ‰¹å»ºè®® -->
                        <div class="stat-card" style="margin-bottom: 20px; border-left: 4px solid var(--accent-${decisionClass === 'positive' ? 'success' : decisionClass === 'warning' ? 'warning' : 'danger'});">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div class="stat-label">AI å®¡æ‰¹å»ºè®®</div>
                                    <div class="stat-value ${decisionClass}" style="font-size: 28px;">${decision}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 12px; color: var(--text-muted);">å†³ç­–ä¾æ®</div>
                                    <div style="font-size: 13px; color: var(--text-secondary);">${decisionReasons.join('ã€')}</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ ¸å¿ƒæŒ‡æ ‡ -->
                        <div class="grid grid-4" style="margin-bottom: 20px;">
                            <div class="stat-card">
                                <div class="stat-label">è¿çº¦æ¦‚ç‡</div>
                                <div class="stat-value ${riskClass}">${(p.default_probability * 100).toFixed(2)}%</div>
                                <div class="risk-meter">
                                    <div class="risk-meter-fill" style="width: ${riskPercent}%; background: ${riskColor};"></div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">é¢„æœŸLTV</div>
                                <div class="stat-value ${ltvClass}">Â¥${p.expected_ltv.toLocaleString()}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">æµå¤±æ¦‚ç‡</div>
                                <div class="stat-value ${p.churn_probability < 0.2 ? 'positive' : 'warning'}">${(p.churn_probability * 100).toFixed(1)}%</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">æ¨¡å‹ç½®ä¿¡åº¦</div>
                                <div class="stat-value">${(p.confidence * 100).toFixed(0)}%</div>
                            </div>
                        </div>
                        
                        <!-- å®¢æˆ·æ¦‚è¦ -->
                        <h4 style="margin: 16px 0 12px; color: var(--text-secondary); font-size: 14px;">${c.is_enterprise ? 'ğŸ¢ ä¼ä¸šæ¦‚è¦' : 'ğŸ‘¤ å®¢æˆ·æ¦‚è¦'}</h4>
                        <div class="customer-profile" style="margin-bottom: 16px;">
                            <div class="profile-item">
                                <span class="profile-label">å®¢æˆ·ID</span>
                                <span class="profile-value">${c.customer_id}</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">ç±»å‹</span>
                                <span class="profile-value">${c.customer_type}</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">è¡Œä¸š</span>
                                <span class="profile-value">${c.industry}</span>
                            </div>
                            ${c.is_enterprise ? `
                            <div class="profile-item">
                                <span class="profile-label">æˆç«‹å¹´é™</span>
                                <span class="profile-value">${c.years_in_business}å¹´</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">å‘˜å·¥æ•°</span>
                                <span class="profile-value">${c.employee_count ? c.employee_count.toLocaleString() : '--'}äºº</span>
                            </div>
                            ` : `
                            <div class="profile-item">
                                <span class="profile-label">å¹´é¾„</span>
                                <span class="profile-value">${c.age}å²</span>
                            </div>
                            `}
                        </div>
                        
                        <!-- è´¢åŠ¡çŠ¶å†µ -->
                        <h4 style="margin: 16px 0 12px; color: var(--text-secondary); font-size: 14px;">ğŸ’° ${c.is_enterprise ? 'ä¼ä¸šè´¢åŠ¡' : 'ä¸ªäººè´¢åŠ¡'}</h4>
                        <div class="customer-profile" style="margin-bottom: 16px;">
                            ${c.is_enterprise ? `
                            <div class="profile-item">
                                <span class="profile-label">å¹´è¥ä¸šæ”¶å…¥</span>
                                <span class="profile-value">Â¥${(c.annual_revenue / 1e6).toFixed(2)}ç™¾ä¸‡</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">å‡€åˆ©æ¶¦</span>
                                <span class="profile-value ${c.net_profit < 0 ? 'negative' : ''}">Â¥${(c.net_profit / 1e6).toFixed(2)}ç™¾ä¸‡</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">å‡€åˆ©æ¶¦ç‡</span>
                                <span class="profile-value ${c.profit_margin < 0.05 ? 'negative' : c.profit_margin < 0.1 ? 'warning' : ''}">${(c.profit_margin * 100).toFixed(2)}%</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">æµåŠ¨æ¯”ç‡</span>
                                <span class="profile-value ${c.current_ratio < 1.2 ? 'negative' : c.current_ratio < 1.5 ? 'warning' : ''}">${c.current_ratio.toFixed(2)}</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">èµ„äº§è´Ÿå€ºç‡</span>
                                <span class="profile-value ${c.debt_ratio > 0.65 ? 'negative' : c.debt_ratio > 0.5 ? 'warning' : ''}">${(c.debt_ratio * 100).toFixed(1)}%</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">ç»è¥ç°é‡‘æµ</span>
                                <span class="profile-value ${c.operating_cash_flow < 0 ? 'negative' : ''}">Â¥${(c.operating_cash_flow / 1e6).toFixed(2)}ç™¾ä¸‡</span>
                            </div>
                            ` : `
                            <div class="profile-item">
                                <span class="profile-label">æœˆæ”¶å…¥</span>
                                <span class="profile-value">Â¥${c.monthly_income ? c.monthly_income.toLocaleString() : '--'}</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">è´Ÿå€ºç‡</span>
                                <span class="profile-value ${c.debt_ratio > 0.6 ? 'negative' : c.debt_ratio > 0.4 ? 'warning' : ''}">${(c.debt_ratio * 100).toFixed(1)}%</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">æœˆä¾›/æ”¶å…¥</span>
                                <span class="profile-value ${paymentRatio > 0.5 ? 'negative' : paymentRatio > 0.3 ? 'warning' : ''}">${(paymentRatio * 100).toFixed(1)}%</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">æœˆä¾›é‡‘é¢</span>
                                <span class="profile-value">Â¥${monthlyPayment.toLocaleString()}</span>
                            </div>
                            `}
                        </div>
                        
                        ${c.is_enterprise ? `
                        <!-- ä¼ä¸šä¸“ç”¨ä¿¡æ¯ -->
                        <h4 style="margin: 16px 0 12px; color: var(--text-secondary); font-size: 14px;">ğŸ”¬ åˆ›æ–°èƒ½åŠ›</h4>
                        <div class="customer-profile" style="margin-bottom: 16px;">
                            <div class="profile-item">
                                <span class="profile-label">ç ”å‘è´¹ç”¨</span>
                                <span class="profile-value">Â¥${(c.rnd_expense / 1e6).toFixed(2)}ç™¾ä¸‡</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">ç ”å‘è´¹ç”¨ç‡</span>
                                <span class="profile-value">${(c.rnd_expense_ratio * 100).toFixed(2)}%</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">ä¸“åˆ©æ€»æ•°</span>
                                <span class="profile-value">${c.total_patents || 0}é¡¹</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">å‘æ˜ä¸“åˆ©</span>
                                <span class="profile-value">${c.invention_patents || 0}é¡¹</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">åˆ›æ–°èƒ½åŠ›è¯„åˆ†</span>
                                <span class="profile-value ${c.innovation_score > 0.6 ? 'positive' : c.innovation_score > 0.3 ? 'warning' : 'negative'}">${(c.innovation_score * 100).toFixed(0)}</span>
                            </div>
                        </div>
                        
                        <h4 style="margin: 16px 0 12px; color: var(--text-secondary); font-size: 14px;">ğŸ“Š å¸‚åœºä¿¡æ¯</h4>
                        <div class="customer-profile" style="margin-bottom: 16px;">
                            <div class="profile-item">
                                <span class="profile-label">æ˜¯å¦ä¸Šå¸‚</span>
                                <span class="profile-value">${c.is_listed ? 'æ˜¯' : 'å¦'}</span>
                            </div>
                            ${c.is_listed ? `
                            <div class="profile-item">
                                <span class="profile-label">å¸‚å€¼</span>
                                <span class="profile-value">Â¥${(c.market_cap / 1e8).toFixed(2)}äº¿</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">è‚¡ä»·</span>
                                <span class="profile-value">Â¥${c.stock_price.toFixed(2)}</span>
                            </div>
                            ` : ''}
                            <div class="profile-item">
                                <span class="profile-label">ä¿¡ç”¨è¯„çº§</span>
                                <span class="profile-value ${c.credit_rating && c.credit_rating.startsWith('AAA') ? 'positive' : c.credit_rating && ['AA', 'A'].some(r => c.credit_rating.startsWith(r)) ? 'warning' : 'negative'}">${c.credit_rating || '--'}</span>
                            </div>
                            ${c.industry_ranking > 0 ? `
                            <div class="profile-item">
                                <span class="profile-label">è¡Œä¸šæ’å</span>
                                <span class="profile-value">ç¬¬${c.industry_ranking}å</span>
                            </div>
                            ` : ''}
                            ${c.market_share > 0 ? `
                            <div class="profile-item">
                                <span class="profile-label">å¸‚åœºä»½é¢</span>
                                <span class="profile-value">${c.market_share.toFixed(2)}%</span>
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                        
                        <!-- ä¿¡ç”¨å†å² -->
                        <h4 style="margin: 16px 0 12px; color: var(--text-secondary); font-size: 14px;">ğŸ“Š ä¿¡ç”¨å†å²</h4>
                        <div class="customer-profile">
                            <div class="profile-item">
                                <span class="profile-label">é£é™©è¯„åˆ†</span>
                                <span class="profile-value">${c.risk_score.toFixed(2)}</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">å†å²é€¾æœŸ</span>
                                <span class="profile-value ${c.max_historical_dpd > 30 ? 'negative' : c.max_historical_dpd > 0 ? 'warning' : 'positive'}">${c.max_historical_dpd}å¤©</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">é¢„æœŸé€¾æœŸ</span>
                                <span class="profile-value">${p.expected_dpd.toFixed(0)}å¤©</span>
                            </div>
                            <div class="profile-item">
                                <span class="profile-label">å®¢æˆ·å¹´é™</span>
                                <span class="profile-value">${(c.months_as_customer / 12).toFixed(1)}å¹´</span>
                            </div>
                        </div>
                        
                        <!-- æ¨¡å‹è¯„ä¼°æŒ‡æ ‡è¯´æ˜ -->
                        <div class="card" style="margin-top: 20px; border: 1px solid var(--border-color);">
                            <div class="card-header" onclick="toggleMetricsExplanation()" style="cursor: pointer; padding: 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color);">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <span style="font-size: 20px;">ğŸ“Š</span>
                                    <h4 style="margin: 0; font-size: 16px;">æ¨¡å‹è¯„ä¼°æŒ‡æ ‡è¯´æ˜</h4>
                                </div>
                                <span id="metrics-toggle-icon" style="font-size: 18px; transition: transform 0.3s;">â–¼</span>
                            </div>
                            <div id="metrics-explanation" style="display: none; padding: 20px;">
                                <div style="margin-bottom: 20px;">
                                    <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 16px;">
                                        ä»¥ä¸‹æŒ‡æ ‡ç”¨äºè¯„ä¼°æ¨¡å‹é¢„æµ‹çš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚ç‚¹å‡» <a href="/model-terms" target="_blank" style="color: var(--accent-primary); text-decoration: underline;">æŸ¥çœ‹è¯¦ç»†æœ¯è¯­è§£é‡Š</a>
                                    </p>
                                </div>
                                
                                <div class="grid grid-2" style="gap: 16px; margin-bottom: 16px;">
                                    <!-- AUC -->
                                    <div class="metric-card" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1)); padding: 16px; border-radius: 8px; border-left: 4px solid #667eea;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                            <div>
                                                <div style="font-weight: bold; color: #667eea; font-size: 14px;">AUC (ROCæ›²çº¿ä¸‹é¢ç§¯)</div>
                                                <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">æ¨¡å‹åŒºåˆ†èƒ½åŠ›</div>
                                            </div>
                                            <span class="badge" style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;">0.85</span>
                                        </div>
                                        <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                                            <strong>å«ä¹‰ï¼š</strong>è¡¡é‡æ¨¡å‹åŒºåˆ†"å¥½å®¢æˆ·"å’Œ"åå®¢æˆ·"çš„æ•´ä½“èƒ½åŠ›<br>
                                            <strong>é€šä¿—è§£é‡Šï¼š</strong>ç»™ä½ ä¸€ä¸ªå¥½äººä¸€ä¸ªå°å·ï¼Œæ¨¡å‹æœ‰85%çš„æ¦‚ç‡èƒ½æ­£ç¡®åŒºåˆ†<br>
                                            <strong>è¯„åˆ¤æ ‡å‡†ï¼š</strong>
                                            <span style="color: #28a745;">> 0.9 ä¼˜ç§€</span> | 
                                            <span style="color: #17a2b8;">0.8-0.9 è‰¯å¥½</span> | 
                                            <span style="color: #ffc107;">0.7-0.8 å¯æ¥å—</span>
                                        </div>
                                    </div>
                                    
                                    <!-- ç²¾ç¡®ç‡ -->
                                    <div class="metric-card" style="background: linear-gradient(135deg, rgba(240, 147, 251, 0.1), rgba(245, 87, 108, 0.1)); padding: 16px; border-radius: 8px; border-left: 4px solid #f5576c;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                            <div>
                                                <div style="font-weight: bold; color: #f5576c; font-size: 14px;">ç²¾ç¡®ç‡ (Precision)</div>
                                                <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">é¿å…è¯¯æ‹’å¥½å®¢æˆ·</div>
                                            </div>
                                            <span class="badge" style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;">0.85</span>
                                        </div>
                                        <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                                            <strong>å«ä¹‰ï¼š</strong>é¢„æµ‹ä¸ºè¿çº¦çš„å®¢æˆ·ä¸­ï¼ŒçœŸæ­£è¿çº¦çš„æ¯”ä¾‹<br>
                                            <strong>é€šä¿—è§£é‡Šï¼š</strong>æ¨¡å‹é¢„æµ‹100ä¸ªä¼šè¿çº¦ï¼Œå…¶ä¸­85ä¸ªçœŸçš„è¿çº¦äº†<br>
                                            <strong>ä¸šåŠ¡å½±å“ï¼š</strong>ç²¾ç¡®ç‡é«˜ = è¯¯æ‹’ç‡ä½ï¼ˆé¿å…å¥½å®¢æˆ·è¢«æ‹’ç»ï¼‰<br>
                                            <strong>è¯„åˆ¤æ ‡å‡†ï¼š</strong>
                                            <span style="color: #28a745;">> 0.85 ä¼˜ç§€</span> | 
                                            <span style="color: #17a2b8;">0.75-0.85 è‰¯å¥½</span>
                                        </div>
                                    </div>
                                    
                                    <!-- å¬å›ç‡ -->
                                    <div class="metric-card" style="background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.1)); padding: 16px; border-radius: 8px; border-left: 4px solid #4facfe;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                            <div>
                                                <div style="font-weight: bold; color: #4facfe; font-size: 14px;">å¬å›ç‡ (Recall)</div>
                                                <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">é¿å…æ¼æ£€åå®¢æˆ·</div>
                                            </div>
                                            <span class="badge" style="background: #ffc107; color: #333; padding: 4px 8px; border-radius: 12px; font-size: 11px;">0.72</span>
                                        </div>
                                        <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                                            <strong>å«ä¹‰ï¼š</strong>çœŸæ­£è¿çº¦çš„å®¢æˆ·ä¸­ï¼Œè¢«æ­£ç¡®è¯†åˆ«çš„æ¯”ä¾‹<br>
                                            <strong>é€šä¿—è§£é‡Šï¼š</strong>å®é™…100ä¸ªè¿çº¦ï¼Œæ¨¡å‹è¯†åˆ«å‡ºäº†72ä¸ª<br>
                                            <strong>ä¸šåŠ¡å½±å“ï¼š</strong>å¬å›ç‡é«˜ = æ¼æ£€ç‡ä½ï¼ˆé¿å…åå®¢æˆ·è¢«æ‰¹å‡†ï¼‰<br>
                                            <strong>è¯„åˆ¤æ ‡å‡†ï¼š</strong>
                                            <span style="color: #28a745;">> 0.80 ä¼˜ç§€</span> | 
                                            <span style="color: #17a2b8;">0.70-0.80 è‰¯å¥½</span>
                                        </div>
                                    </div>
                                    
                                    <!-- F1åˆ†æ•° -->
                                    <div class="metric-card" style="background: linear-gradient(135deg, rgba(250, 112, 154, 0.1), rgba(254, 225, 64, 0.1)); padding: 16px; border-radius: 8px; border-left: 4px solid #fa709a;">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                                            <div>
                                                <div style="font-weight: bold; color: #fa709a; font-size: 14px;">F1åˆ†æ•° (F1-Score)</div>
                                                <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">ç²¾ç¡®ç‡å’Œå¬å›ç‡å¹³è¡¡</div>
                                            </div>
                                            <span class="badge" style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px;">0.78</span>
                                        </div>
                                        <div style="font-size: 12px; color: var(--text-secondary); line-height: 1.6;">
                                            <strong>å«ä¹‰ï¼š</strong>ç²¾ç¡®ç‡å’Œå¬å›ç‡çš„è°ƒå’Œå¹³å‡æ•°<br>
                                            <strong>é€šä¿—è§£é‡Šï¼š</strong>ç»¼åˆè€ƒè™‘"ä¸è¯¯æ‹’å¥½å®¢æˆ·"å’Œ"ä¸æ¼æ£€åå®¢æˆ·"<br>
                                            <strong>ç”¨é€”ï¼š</strong>å½“éœ€è¦å¹³è¡¡ç²¾ç¡®ç‡å’Œå¬å›ç‡æ—¶ä½¿ç”¨<br>
                                            <strong>è¯„åˆ¤æ ‡å‡†ï¼š</strong>
                                            <span style="color: #28a745;">> 0.82 ä¼˜ç§€</span> | 
                                            <span style="color: #17a2b8;">0.72-0.82 è‰¯å¥½</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- æ··æ·†çŸ©é˜µè¯´æ˜ -->
                                <div style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
                                    <h5 style="margin: 0 0 12px; font-size: 14px; color: var(--text-secondary);">ğŸ“‹ æ··æ·†çŸ©é˜µè¯´æ˜</h5>
                                    <div style="display: grid; grid-template-columns: auto 1fr 1fr; gap: 8px; font-size: 12px;">
                                        <div></div>
                                        <div style="font-weight: bold; text-align: center; padding: 8px; background: #667eea; color: white; border-radius: 4px;">é¢„æµ‹æ­£å¸¸</div>
                                        <div style="font-weight: bold; text-align: center; padding: 8px; background: #667eea; color: white; border-radius: 4px;">é¢„æµ‹è¿çº¦</div>
                                        
                                        <div style="font-weight: bold; padding: 8px; display: flex; align-items: center;">å®é™…æ­£å¸¸</div>
                                        <div style="padding: 8px; background: #17a2b8; color: white; text-align: center; border-radius: 4px;">
                                            <strong>TN</strong><br>
                                            <small>çœŸè´Ÿä¾‹<br>(æ­£ç¡®è¯†åˆ«çš„å¥½å®¢æˆ·)</small>
                                        </div>
                                        <div style="padding: 8px; background: #ffc107; color: #333; text-align: center; border-radius: 4px;">
                                            <strong>FP</strong><br>
                                            <small>å‡æ­£ä¾‹<br>(è¯¯æ‹’çš„å¥½å®¢æˆ·)</small>
                                        </div>
                                        
                                        <div style="font-weight: bold; padding: 8px; display: flex; align-items: center;">å®é™…è¿çº¦</div>
                                        <div style="padding: 8px; background: #dc3545; color: white; text-align: center; border-radius: 4px;">
                                            <strong>FN</strong><br>
                                            <small>å‡è´Ÿä¾‹<br>(æ¼æ£€çš„åå®¢æˆ·)</small>
                                        </div>
                                        <div style="padding: 8px; background: #28a745; color: white; text-align: center; border-radius: 4px;">
                                            <strong>TP</strong><br>
                                            <small>çœŸæ­£ä¾‹<br>(æ­£ç¡®è¯†åˆ«çš„åå®¢æˆ·)</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ä¸šåŠ¡æŒ‡æ ‡ -->
                                <div style="margin-top: 20px;">
                                    <h5 style="margin: 0 0 12px; font-size: 14px; color: var(--text-secondary);">ğŸ’¼ ä¸šåŠ¡æŒ‡æ ‡</h5>
                                    <div class="grid grid-3" style="gap: 12px;">
                                        <div style="padding: 12px; background: #f8f9fa; border-radius: 6px;">
                                            <div style="font-size: 11px; color: var(--text-muted);">è¯¯æ‹’ç‡</div>
                                            <div style="font-size: 16px; font-weight: bold; color: #28a745;">&lt; 5%</div>
                                            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">é¿å…å¥½å®¢æˆ·è¢«æ‹’ç»</div>
                                        </div>
                                        <div style="padding: 12px; background: #f8f9fa; border-radius: 6px;">
                                            <div style="font-size: 11px; color: var(--text-muted);">æ¼æ£€ç‡</div>
                                            <div style="font-size: 16px; font-weight: bold; color: #17a2b8;">&lt; 10%</div>
                                            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">é¿å…åå®¢æˆ·è¢«æ‰¹å‡†</div>
                                        </div>
                                        <div style="padding: 12px; background: #f8f9fa; border-radius: 6px;">
                                            <div style="font-size: 11px; color: var(--text-muted);">æ•´ä½“å‡†ç¡®ç‡</div>
                                            <div style="font-size: 16px; font-weight: bold; color: #667eea;">&gt; 85%</div>
                                            <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">æ¨¡å‹æ•´ä½“è¡¨ç°</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--border-color); text-align: center;">
                                    <a href="/model-terms" target="_blank" style="color: var(--accent-primary); text-decoration: none; font-size: 13px;">
                                        ğŸ“– æŸ¥çœ‹å®Œæ•´æœ¯è¯­è§£é‡Š â†’
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="loading"><p style="color: var(--accent-danger);">é”™è¯¯: ${error.message}</p></div>`;
            }
        }
        
        function showCustomerDetail() {
            if (!currentCustomerData || !currentPredictionData) return;
            
            const c = currentCustomerData;
            const p = currentPredictionData;
            
            const content = `
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ‘¤ åŸºæœ¬ä¿¡æ¯</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">å®¢æˆ·ID</div>
                            <div class="detail-value">${c.customer_id}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å®¢æˆ·ç±»å‹</div>
                            <div class="detail-value">${c.customer_type}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æ‰€å±è¡Œä¸š</div>
                            <div class="detail-value">${c.industry}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">åŸå¸‚ç­‰çº§</div>
                            <div class="detail-value">${c.city_tier || 'æœªçŸ¥'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å¹´é¾„</div>
                            <div class="detail-value">${c.age}å²</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ä»ä¸šå¹´é™</div>
                            <div class="detail-value">${c.years_in_business?.toFixed(1) || 0}å¹´</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å®¢æˆ·å…³ç³»</div>
                            <div class="detail-value">${(c.months_as_customer / 12).toFixed(1)}å¹´</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å†å²è´·æ¬¾</div>
                            <div class="detail-value">${c.previous_loans || 0}ç¬”</div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ’° è´¢åŠ¡çŠ¶å†µ</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">æœˆæ”¶å…¥</div>
                            <div class="detail-value">Â¥${c.monthly_income?.toLocaleString() || 0}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æ”¶å…¥æ³¢åŠ¨æ€§</div>
                            <div class="detail-value ${c.income_volatility > 0.3 ? 'warning' : ''}">${((c.income_volatility || 0) * 100).toFixed(1)}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">è´Ÿå€ºç‡</div>
                            <div class="detail-value ${c.debt_ratio > 0.6 ? 'negative' : c.debt_ratio > 0.4 ? 'warning' : ''}">${((c.debt_ratio || 0) * 100).toFixed(1)}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å€ºåŠ¡æ”¶å…¥æ¯”</div>
                            <div class="detail-value">${(c.debt_to_income || 0).toFixed(2)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å­˜æ¬¾ä½™é¢</div>
                            <div class="detail-value">Â¥${(c.deposit_balance || 0).toLocaleString()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å­˜æ¬¾ç¨³å®šæ€§</div>
                            <div class="detail-value">${((c.deposit_stability || 0) * 100).toFixed(0)}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">é£é™©è¯„åˆ†</div>
                            <div class="detail-value">${(c.risk_score || 0).toFixed(3)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">å†å²æœ€å¤§é€¾æœŸ</div>
                            <div class="detail-value ${c.max_historical_dpd > 30 ? 'negative' : c.max_historical_dpd > 0 ? 'warning' : 'positive'}">${c.max_historical_dpd || 0}å¤©</div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ¯ AI é¢„æµ‹ç»“æœ</div>
                    <div class="detail-grid">
                        <div class="detail-item">
                            <div class="detail-label">è¿çº¦æ¦‚ç‡</div>
                            <div class="detail-value ${p.default_probability < 0.05 ? 'positive' : p.default_probability < 0.15 ? 'warning' : 'negative'}">${(p.default_probability * 100).toFixed(2)}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label" style="display: flex; align-items: center; gap: 6px;">
                                é¢„æœŸLTV
                                <span style="cursor: pointer; color: var(--accent-primary); font-size: 14px;" 
                                      onclick="showLTVExplanation()" 
                                      title="ç‚¹å‡»æŸ¥çœ‹LTVè¯¦ç»†è¯´æ˜">â“</span>
                            </div>
                            <div class="detail-value ${p.expected_ltv > 0 ? 'positive' : 'negative'}">Â¥${p.expected_ltv.toLocaleString()}</div>
                            <div style="font-size: 11px; color: var(--text-muted); margin-top: 4px;">
                                ${p.expected_ltv > 0 ? 'âœ… èƒ½ä¸ºé“¶è¡Œå¸¦æ¥åˆ©æ¶¦' : p.expected_ltv < -5000 ? 'âŒ å¯èƒ½é€ æˆè¾ƒå¤§äºæŸ' : 'âš ï¸ åˆ©æ¶¦å¾®è–„æˆ–å¯èƒ½äºæŸ'}
                            </div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æµå¤±æ¦‚ç‡</div>
                            <div class="detail-value">${(p.churn_probability * 100).toFixed(1)}%</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">é¢„æœŸé€¾æœŸå¤©æ•°</div>
                            <div class="detail-value">${p.expected_dpd.toFixed(0)}å¤©</div>
                        </div>
                    </div>
                </div>
                
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ“Š é£é™©å› å­åˆ†æ</div>
                    <div class="analysis-card">
                        <div class="factor-bar">
                            <span class="factor-name">å®¢æˆ·ç±»å‹</span>
                            <div class="factor-bar-bg">
                                <div class="factor-bar-fill" style="width: ${c.customer_type === 'å·¥è–ªé˜¶å±‚' ? 20 : c.customer_type === 'å†œæˆ·' ? 40 : 60}%; background: ${c.customer_type === 'å·¥è–ªé˜¶å±‚' ? '#10b981' : c.customer_type === 'å†œæˆ·' ? '#f59e0b' : '#ef4444'};"></div>
                            </div>
                            <span class="factor-value" style="color: ${c.customer_type === 'å·¥è–ªé˜¶å±‚' ? '#10b981' : c.customer_type === 'å†œæˆ·' ? '#f59e0b' : '#ef4444'};">${c.customer_type === 'å·¥è–ªé˜¶å±‚' ? 'ä½' : c.customer_type === 'å†œæˆ·' ? 'ä¸­' : 'é«˜'}</span>
                        </div>
                        <div class="factor-bar">
                            <span class="factor-name">è´Ÿå€ºç‡</span>
                            <div class="factor-bar-bg">
                                <div class="factor-bar-fill" style="width: ${c.debt_ratio * 100}%; background: ${c.debt_ratio < 0.4 ? '#10b981' : c.debt_ratio < 0.6 ? '#f59e0b' : '#ef4444'};"></div>
                            </div>
                            <span class="factor-value">${(c.debt_ratio * 100).toFixed(0)}%</span>
                        </div>
                        <div class="factor-bar">
                            <span class="factor-name">æ”¶å…¥æ³¢åŠ¨</span>
                            <div class="factor-bar-bg">
                                <div class="factor-bar-fill" style="width: ${(c.income_volatility || 0) * 200}%; background: ${c.income_volatility < 0.2 ? '#10b981' : c.income_volatility < 0.4 ? '#f59e0b' : '#ef4444'};"></div>
                            </div>
                            <span class="factor-value">${((c.income_volatility || 0) * 100).toFixed(0)}%</span>
                        </div>
                        <div class="factor-bar">
                            <span class="factor-name">å­˜æ¬¾ç¨³å®š</span>
                            <div class="factor-bar-bg">
                                <div class="factor-bar-fill" style="width: ${(c.deposit_stability || 0) * 100}%; background: ${c.deposit_stability > 0.7 ? '#10b981' : c.deposit_stability > 0.5 ? '#f59e0b' : '#ef4444'};"></div>
                            </div>
                            <span class="factor-value">${((c.deposit_stability || 0) * 100).toFixed(0)}%</span>
                        </div>
                        <div class="factor-bar">
                            <span class="factor-name">å†å²é€¾æœŸ</span>
                            <div class="factor-bar-bg">
                                <div class="factor-bar-fill" style="width: ${Math.min(100, (c.max_historical_dpd || 0) / 90 * 100)}%; background: ${c.max_historical_dpd === 0 ? '#10b981' : c.max_historical_dpd < 30 ? '#f59e0b' : '#ef4444'};"></div>
                            </div>
                            <span class="factor-value">${c.max_historical_dpd || 0}å¤©</span>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('customer-detail-content').innerHTML = content;
            document.getElementById('customer-detail-modal').style.display = 'flex';
        }
        
        function closeCustomerDetail() {
            document.getElementById('customer-detail-modal').style.display = 'none';
        }
        
        function showLTVExplanation() {
            document.getElementById('ltv-explanation-modal').style.display = 'flex';
        }
        
        function closeLTVExplanation() {
            document.getElementById('ltv-explanation-modal').style.display = 'none';
        }
        
        function toggleMetricsExplanation() {
            const explanation = document.getElementById('metrics-explanation');
            const icon = document.getElementById('metrics-toggle-icon');
            if (explanation.style.display === 'none') {
                explanation.style.display = 'block';
                icon.style.transform = 'rotate(180deg)';
            } else {
                explanation.style.display = 'none';
                icon.style.transform = 'rotate(0deg)';
            }
        }
        
        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        document.getElementById('customer-detail-modal')?.addEventListener('click', function(e) {
            if (e.target === this) closeCustomerDetail();
        });
        
        document.getElementById('ltv-explanation-modal')?.addEventListener('click', function(e) {
            if (e.target === this) closeLTVExplanation();
        });
        
        // ============================================================
        // ç»æµå‘¨æœŸåˆ†æ
        // ============================================================
        
        let cycleChart = null;
        let typeChart = null;
        let industryChart = null;
        let riskDistributionChart = null;
        
        async function runCycleAnalysis() {
            const count = parseInt(document.getElementById('analysis-count').value);
            document.getElementById('analysis-result').style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/api/analysis/economic-cycle`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ count })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('analysis-result').style.display = 'block';
                    document.getElementById('btn-cycle-trace').style.display = 'block';
                    document.getElementById('cycle-run-id').textContent = `è¿è¡ŒID: ${data.run_id || '--'}`;
                    
                    // æ˜¾ç¤ºç»Ÿè®¡å¡ç‰‡ - æ‰©å±•ç‰ˆ
                    const statsDiv = document.getElementById('cycle-stats');
                    statsDiv.innerHTML = Object.entries(data.scenarios).map(([name, s]) => {
                        const indicators = s.economic_indicators || {};
                        return `
                        <div class="stat-card">
                            <div class="stat-label">${name}</div>
                            <div class="stat-value ${s.avg_default_rate > 0.15 ? 'negative' : s.avg_default_rate > 0.08 ? 'warning' : 'positive'}">
                                ${(s.avg_default_rate * 100).toFixed(2)}%
                            </div>
                            <div class="stat-change">
                                é«˜é£é™©: ${s.high_risk_count}äºº (${(s.high_risk_ratio * 100).toFixed(0)}%)<br>
                                å¥åº·åº¦: ${indicators.economic_health_score ? indicators.economic_health_score.toFixed(1) : '--'}
                            </div>
                        </div>
                    `;
                    }).join('');
                    
                    // æ˜¾ç¤ºé¢„è­¦ä¿¡å·
                    if (data.warnings && data.warnings.length > 0) {
                        document.getElementById('warnings-card').style.display = 'block';
                        const warningsContent = document.getElementById('warnings-content');
                        warningsContent.innerHTML = data.warnings.map(w => `
                            <div class="alert ${w.level === 'critical' ? 'alert-danger' : w.level === 'high' ? 'alert-warning' : 'alert-info'}" style="margin-bottom: 12px;">
                                <strong>${w.scenario}</strong>: ${w.message}
                            </div>
                        `).join('');
                    }
                    
                    // æ˜¾ç¤ºç»æµæŒ‡æ ‡è¯¦æƒ…
                    const indicatorsGrid = document.getElementById('economic-indicators-grid');
                    indicatorsGrid.innerHTML = Object.entries(data.scenarios).map(([name, s]) => {
                        const ind = s.economic_indicators || {};
                        return `
                            <div class="card" style="padding: 16px;">
                                <h4 style="margin-bottom: 12px; color: var(--accent);">${name}</h4>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 13px;">
                                    <div><strong>GDPå¢é•¿ç‡:</strong> ${(ind.gdp_growth * 100).toFixed(2)}%</div>
                                    <div><strong>å¤±ä¸šç‡:</strong> ${(ind.unemployment_rate * 100).toFixed(2)}%</div>
                                    <div><strong>é€šèƒ€ç‡:</strong> ${(ind.inflation_rate * 100).toFixed(2)}%</div>
                                    <div><strong>åŸºå‡†åˆ©ç‡:</strong> ${(ind.base_interest_rate * 100).toFixed(2)}%</div>
                                    <div><strong>æ¶ˆè´¹è€…ä¿¡å¿ƒ:</strong> ${(ind.consumer_confidence * 100).toFixed(0)}</div>
                                    <div><strong>åˆ¶é€ ä¸šPMI:</strong> ${ind.manufacturing_pmi ? ind.manufacturing_pmi.toFixed(1) : '--'}</div>
                                    <div><strong>æˆ¿ä»·æŒ‡æ•°:</strong> ${ind.housing_price_index ? ind.housing_price_index.toFixed(1) : '--'}</div>
                                    <div><strong>è‚¡å¸‚æŒ‡æ•°:</strong> ${ind.stock_index ? ind.stock_index.toFixed(0) : '--'}</div>
                                    <div><strong>M2å¢é•¿ç‡:</strong> ${(ind.m2_growth * 100).toFixed(2)}%</div>
                                    <div><strong>æ±‡ç‡:</strong> ${ind.exchange_rate ? ind.exchange_rate.toFixed(2) : '--'}</div>
                                    <div><strong>è´¸æ˜“ä½™é¢:</strong> ${ind.trade_balance ? ind.trade_balance.toFixed(0) : '--'}äº¿ç¾å…ƒ</div>
                                    <div><strong>é£é™©åå¥½:</strong> ${(ind.risk_appetite * 100).toFixed(0)}</div>
                                    <div><strong>æµåŠ¨æ€§:</strong> ${(ind.liquidity_index * 100).toFixed(0)}</div>
                                    <div><strong>å¸‚åœºæ³¢åŠ¨:</strong> ${(ind.market_volatility * 100).toFixed(2)}%</div>
                                    <div><strong>æ”¿ç­–åˆºæ¿€:</strong> ${(ind.policy_stimulus_level * 100).toFixed(0)}</div>
                                    <div><strong>ç»æµå‹åŠ›:</strong> ${(ind.economic_stress * 100).toFixed(1)}</div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    // ç»˜åˆ¶å‘¨æœŸå›¾è¡¨
                    const cycleCtx = document.getElementById('cycle-chart').getContext('2d');
                    if (cycleChart) cycleChart.destroy();
                    
                    cycleChart = new Chart(cycleCtx, {
                        type: 'bar',
                        data: {
                            labels: Object.keys(data.scenarios),
                            datasets: [{
                                label: 'å¹³å‡è¿çº¦ç‡',
                                data: Object.values(data.scenarios).map(s => (s.avg_default_rate * 100).toFixed(2)),
                                backgroundColor: [
                                    'rgba(0, 212, 170, 0.7)',
                                    'rgba(59, 130, 246, 0.7)',
                                    'rgba(245, 158, 11, 0.7)',
                                    'rgba(239, 68, 68, 0.7)'
                                ],
                                borderRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { display: false }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: { color: 'rgba(255,255,255,0.1)' },
                                    ticks: { color: '#94a3b8' }
                                },
                                x: {
                                    grid: { display: false },
                                    ticks: { color: '#94a3b8' }
                                }
                            }
                        }
                    });
                    
                    // ç»˜åˆ¶å®¢æˆ·ç±»å‹å›¾è¡¨
                    const typeCtx = document.getElementById('type-chart').getContext('2d');
                    if (typeChart) typeChart.destroy();
                    
                    const sortedTypes = Object.entries(data.by_customer_type).sort((a, b) => b[1] - a[1]);
                    
                    typeChart = new Chart(typeCtx, {
                        type: 'doughnut',
                        data: {
                            labels: sortedTypes.map(([k]) => k),
                            datasets: [{
                                data: sortedTypes.map(([, v]) => (v * 100).toFixed(2)),
                                backgroundColor: [
                                    'rgba(239, 68, 68, 0.8)',
                                    'rgba(245, 158, 11, 0.8)',
                                    'rgba(59, 130, 246, 0.8)',
                                    'rgba(0, 212, 170, 0.8)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'right',
                                    labels: { color: '#f1f5f9' }
                                }
                            }
                        }
                    });
                    
                    // è¡Œä¸šé£é™©åˆ†æ
                    const firstScenario = Object.values(data.scenarios)[0];
                    if (firstScenario.by_industry && Object.keys(firstScenario.by_industry).length > 0) {
                        document.getElementById('industry-analysis-card').style.display = 'block';
                        const industryCtx = document.getElementById('industry-chart').getContext('2d');
                        if (industryChart) industryChart.destroy();
                        
                        // æ”¶é›†æ‰€æœ‰åœºæ™¯çš„è¡Œä¸šæ•°æ®
                        const industryData = {};
                        Object.entries(data.scenarios).forEach(([scenarioName, scenario]) => {
                            Object.entries(scenario.by_industry || {}).forEach(([industry, data]) => {
                                if (!industryData[industry]) {
                                    industryData[industry] = [];
                                }
                                industryData[industry].push({
                                    scenario: scenarioName,
                                    default_rate: data.avg_default_rate,
                                    count: data.count
                                });
                            });
                        });
                        
                        const industries = Object.keys(industryData);
                        const scenarios = Object.keys(data.scenarios);
                        
                        industryChart = new Chart(industryCtx, {
                            type: 'bar',
                            data: {
                                labels: industries,
                                datasets: scenarios.map((scenarioName, idx) => ({
                                    label: scenarioName,
                                    data: industries.map(industry => {
                                        const item = industryData[industry].find(d => d.scenario === scenarioName);
                                        return item ? (item.default_rate * 100) : 0;
                                    }),
                                    backgroundColor: [
                                        'rgba(0, 212, 170, 0.7)',
                                        'rgba(59, 130, 246, 0.7)',
                                        'rgba(245, 158, 11, 0.7)',
                                        'rgba(239, 68, 68, 0.7)'
                                    ][idx]
                                }))
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { labels: { color: '#f1f5f9' } }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        grid: { color: 'rgba(255,255,255,0.1)' },
                                        ticks: { color: '#94a3b8' }
                                    },
                                    x: {
                                        grid: { display: false },
                                        ticks: { color: '#94a3b8' }
                                    }
                                }
                            }
                        });
                    }
                    
                    // é£é™©åˆ†å¸ƒåˆ†æ
                    if (firstScenario.risk_distribution) {
                        document.getElementById('risk-distribution-card').style.display = 'block';
                        const riskDistCtx = document.getElementById('risk-distribution-chart').getContext('2d');
                        if (riskDistributionChart) riskDistributionChart.destroy();
                        
                        riskDistributionChart = new Chart(riskDistCtx, {
                            type: 'bar',
                            data: {
                                labels: Object.keys(data.scenarios),
                                datasets: [
                                    {
                                        label: 'ä½é£é™© (<5%)',
                                        data: Object.values(data.scenarios).map(s => (s.risk_distribution?.low_risk || 0) * 100),
                                        backgroundColor: 'rgba(0, 212, 170, 0.7)'
                                    },
                                    {
                                        label: 'ä¸­é£é™© (5-15%)',
                                        data: Object.values(data.scenarios).map(s => (s.risk_distribution?.medium_risk || 0) * 100),
                                        backgroundColor: 'rgba(245, 158, 11, 0.7)'
                                    },
                                    {
                                        label: 'é«˜é£é™© (15-25%)',
                                        data: Object.values(data.scenarios).map(s => (s.risk_distribution?.high_risk || 0) * 100),
                                        backgroundColor: 'rgba(239, 68, 68, 0.7)'
                                    },
                                    {
                                        label: 'æé«˜é£é™© (>25%)',
                                        data: Object.values(data.scenarios).map(s => (s.risk_distribution?.very_high_risk || 0) * 100),
                                        backgroundColor: 'rgba(139, 92, 246, 0.7)'
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    legend: { labels: { color: '#f1f5f9' } }
                                },
                                scales: {
                                    x: { stacked: true, grid: { display: false }, ticks: { color: '#94a3b8' } },
                                    y: { 
                                        stacked: true, 
                                        beginAtZero: true,
                                        max: 100,
                                        grid: { color: 'rgba(255,255,255,0.1)' },
                                        ticks: { color: '#94a3b8', callback: function(value) { return value + '%'; } }
                                    }
                                }
                            }
                        });
                        
                        // é£é™©åˆ†å¸ƒç»Ÿè®¡
                        const riskStatsDiv = document.getElementById('risk-distribution-stats');
                        riskStatsDiv.innerHTML = Object.entries(data.scenarios).map(([name, s]) => {
                            const dist = s.risk_distribution || {};
                            return `
                                <div style="margin-bottom: 16px;">
                                    <h4 style="color: var(--accent); margin-bottom: 8px;">${name}</h4>
                                    <div style="font-size: 13px; line-height: 1.8;">
                                        <div>ä½é£é™©: <strong>${((dist.low_risk || 0) * 100).toFixed(1)}%</strong></div>
                                        <div>ä¸­é£é™©: <strong>${((dist.medium_risk || 0) * 100).toFixed(1)}%</strong></div>
                                        <div>é«˜é£é™©: <strong>${((dist.high_risk || 0) * 100).toFixed(1)}%</strong></div>
                                        <div>æé«˜é£é™©: <strong>${((dist.very_high_risk || 0) * 100).toFixed(1)}%</strong></div>
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                    
                    // æŒ‡æ ‡ç›¸å…³æ€§åˆ†æ
                    if (data.correlations) {
                        document.getElementById('correlation-card').style.display = 'block';
                        const corrContent = document.getElementById('correlation-content');
                        corrContent.innerHTML = `
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px;">
                                ${Object.entries(data.correlations).map(([scenario, corr]) => `
                                    <div class="card" style="padding: 16px;">
                                        <h4 style="margin-bottom: 12px; color: var(--accent);">${scenario}</h4>
                                        <div style="font-size: 13px; line-height: 1.8;">
                                            <div>GDP vs è¿çº¦ç‡: <strong>${corr.gdp_vs_default ? corr.gdp_vs_default.toFixed(2) : '--'}</strong></div>
                                            <div>å¤±ä¸šç‡ vs è¿çº¦ç‡: <strong>${corr.unemployment_vs_default ? corr.unemployment_vs_default.toFixed(2) : '--'}</strong></div>
                                            <div>ä¿¡å¿ƒæŒ‡æ•° vs è¿çº¦ç‡: <strong>${corr.confidence_vs_default ? corr.confidence_vs_default.toFixed(2) : '--'}</strong></div>
                                            <div>PMI vs è¿çº¦ç‡: <strong>${corr.pmi_vs_default ? corr.pmi_vs_default.toFixed(2) : '--'}</strong></div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }
                    
                    // æ˜¾ç¤ºæ‘˜è¦ä¿¡æ¯
                    if (data.summary) {
                        console.log('åˆ†ææ‘˜è¦:', data.summary);
                    }
                }
            } catch (error) {
                alert('åˆ†æå¤±è´¥: ' + error.message);
                console.error(error);
            }
        }
        
        // ============================================================
        // é“¶è¡Œæ¨¡æ‹Ÿ
        // ============================================================
        
        let simChart = null;
        
        async function runSimulation() {
            const strategy = document.getElementById('sim-strategy').value;
            document.getElementById('sim-result').style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/api/simulation/auto-run`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ strategy, seed: 42 })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('sim-result').style.display = 'block';
                    document.getElementById('btn-sim-trace').style.display = 'block';
                    document.getElementById('sim-run-id').textContent = `è¿è¡ŒID: ${data.run_id || '--'}`;
                    
                    const s = data.summary;
                    document.getElementById('sim-stats').innerHTML = `
                        <div class="stat-card">
                            <div class="stat-label">æ€»å¥–åŠ±</div>
                            <div class="stat-value ${s.total_reward > 0 ? 'positive' : 'negative'}">
                                ${s.total_reward.toFixed(1)}
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æœ€ç»ˆåˆ©æ¶¦</div>
                            <div class="stat-value ${s.final_profit > 0 ? 'positive' : 'negative'}">
                                Â¥${s.final_profit.toFixed(0)}äº¿
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æœ€ç»ˆèµ„æœ¬</div>
                            <div class="stat-value">Â¥${s.final_capital.toFixed(0)}äº¿</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">æœ€ç»ˆNPL</div>
                            <div class="stat-value ${s.final_npl > 0.1 ? 'negative' : s.final_npl > 0.05 ? 'warning' : 'positive'}">
                                ${(s.final_npl * 100).toFixed(2)}%
                            </div>
                        </div>
                    `;
                    
                    // ç»˜åˆ¶å›¾è¡¨
                    const simCtx = document.getElementById('sim-chart').getContext('2d');
                    if (simChart) simChart.destroy();
                    
                    simChart = new Chart(simCtx, {
                        type: 'line',
                        data: {
                            labels: data.history.map(h => `${Math.floor(h.month/12)+1}å¹´${h.month%12+1}æœˆ`),
                            datasets: [
                                {
                                    label: 'ç´¯è®¡åˆ©æ¶¦ (äº¿)',
                                    data: data.history.map(h => h.cumulative_profit),
                                    borderColor: '#00d4aa',
                                    backgroundColor: 'rgba(0, 212, 170, 0.1)',
                                    fill: true,
                                    tension: 0.4,
                                    yAxisID: 'y'
                                },
                                {
                                    label: 'NPLç‡ (%)',
                                    data: data.history.map(h => h.npl_ratio * 100),
                                    borderColor: '#ef4444',
                                    tension: 0.4,
                                    yAxisID: 'y1'
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            interaction: {
                                mode: 'index',
                                intersect: false
                            },
                            plugins: {
                                legend: {
                                    labels: { color: '#f1f5f9' }
                                }
                            },
                            scales: {
                                x: {
                                    grid: { color: 'rgba(255,255,255,0.05)' },
                                    ticks: { 
                                        color: '#64748b',
                                        maxTicksLimit: 12
                                    }
                                },
                                y: {
                                    type: 'linear',
                                    position: 'left',
                                    grid: { color: 'rgba(255,255,255,0.05)' },
                                    ticks: { color: '#00d4aa' },
                                    title: {
                                        display: true,
                                        text: 'ç´¯è®¡åˆ©æ¶¦ (äº¿)',
                                        color: '#00d4aa'
                                    }
                                },
                                y1: {
                                    type: 'linear',
                                    position: 'right',
                                    grid: { display: false },
                                    ticks: { color: '#ef4444' },
                                    title: {
                                        display: true,
                                        text: 'NPLç‡ (%)',
                                        color: '#ef4444'
                                    }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                alert('æ¨¡æ‹Ÿå¤±è´¥: ' + error.message);
            }
        }
        
        // ============================================================
        // ç­–ç•¥å¯¹æ¯”
        // ============================================================
        
        let comparisonChart = null;
        
        async function runComparison() {
            const episodes = parseInt(document.getElementById('comparison-episodes').value);
            document.getElementById('comparison-result').style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/api/comparison/strategies`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ episodes })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('comparison-result').style.display = 'block';
                    document.getElementById('btn-comparison-trace').style.display = 'block';
                    document.getElementById('comparison-run-id').textContent = `è¿è¡ŒID: ${data.run_id || '--'}`;
                    
                    // å¡«å……è¡¨æ ¼
                    const tbody = document.querySelector('#comparison-table tbody');
                    tbody.innerHTML = data.results.map((r, i) => `
                        <tr>
                            <td><span class="badge ${i === 0 ? 'badge-success' : ''}">#${i + 1}</span></td>
                            <td><strong>${r.name}</strong></td>
                            <td class="${r.avg_reward > 0 ? 'positive' : 'negative'}" style="font-family: 'JetBrains Mono'">
                                ${r.avg_reward.toFixed(2)}
                            </td>
                            <td style="font-family: 'JetBrains Mono'">Â¥${r.avg_profit.toFixed(0)}äº¿</td>
                            <td><span class="badge ${r.avg_npl > 0.1 ? 'badge-danger' : r.avg_npl > 0.05 ? 'badge-warning' : 'badge-success'}">
                                ${(r.avg_npl * 100).toFixed(2)}%
                            </span></td>
                            <td><span class="badge ${r.bankruptcy_rate > 0 ? 'badge-danger' : 'badge-success'}">
                                ${(r.bankruptcy_rate * 100).toFixed(0)}%
                            </span></td>
                        </tr>
                    `).join('');
                    
                    // ç»˜åˆ¶å›¾è¡¨
                    const ctx = document.getElementById('comparison-chart').getContext('2d');
                    if (comparisonChart) comparisonChart.destroy();
                    
                    comparisonChart = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: ['å¹³å‡å¥–åŠ±', 'ç´¯è®¡åˆ©æ¶¦', 'NPLæ§åˆ¶', 'ç¨³å®šæ€§'],
                            datasets: data.results.map((r, i) => ({
                                label: r.name,
                                data: [
                                    Math.max(0, (r.avg_reward + 100) / 2),
                                    r.avg_profit / 10,
                                    (1 - r.avg_npl) * 100,
                                    (1 - r.bankruptcy_rate) * 100
                                ],
                                borderColor: ['#00d4aa', '#3b82f6', '#f59e0b', '#ef4444'][i],
                                backgroundColor: ['rgba(0,212,170,0.1)', 'rgba(59,130,246,0.1)', 'rgba(245,158,11,0.1)', 'rgba(239,68,68,0.1)'][i]
                            }))
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: { color: '#f1f5f9' }
                                }
                            },
                            scales: {
                                r: {
                                    grid: { color: 'rgba(255,255,255,0.1)' },
                                    angleLines: { color: 'rgba(255,255,255,0.1)' },
                                    pointLabels: { color: '#94a3b8' },
                                    ticks: { display: false }
                                }
                            }
                        }
                    });
                }
            } catch (error) {
                alert('å¯¹æ¯”å¤±è´¥: ' + error.message);
            }
        }
        
        // ============================================================
        // æ•°æ®è’¸é¦
        // ============================================================
        
        let distillInterval = null;
        
        function updateDistillOptions() {
            const source = document.getElementById('distill-source').value;
            const syntheticOptions = document.getElementById('synthetic-options');
            const realDataOptions = document.getElementById('real-data-options');
            
            if (source === 'synthetic') {
                syntheticOptions.style.display = 'block';
                realDataOptions.style.display = 'none';
            } else {
                syntheticOptions.style.display = 'none';
                realDataOptions.style.display = 'block';
                
                // æ£€æŸ¥æ•°æ®æºå¯ç”¨æ€§
                checkDataSource(source);
            }
        }
        
        async function checkDataSource(source) {
            const infoDiv = document.getElementById('data-source-info');
            infoDiv.innerHTML = '<div style="font-size: 12px; color: var(--text-muted);">æ­£åœ¨æ£€æŸ¥æ•°æ®æº...</div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/distillation/sources`);
                const data = await response.json();
                
                const sourceMap = {
                    'test_data': 'data/test_data',
                    'historical': 'data/historical'
                };
                const path = sourceMap[source];
                const sourceInfo = data.sources.find(s => s.path === path);
                
                if (sourceInfo) {
                    infoDiv.innerHTML = `
                        <div style="font-size: 13px; color: var(--accent-primary);">âœ… æ•°æ®æºå¯ç”¨</div>
                        <div style="font-size: 12px; margin-top: 4px;">
                            ğŸ“ ${sourceInfo.name}<br>
                            ğŸ‘¥ ${sourceInfo.customers.toLocaleString()} å®¢æˆ·<br>
                            ğŸ’° ${sourceInfo.loans.toLocaleString()} è´·æ¬¾è®°å½•<br>
                            ğŸ’¾ ${sourceInfo.size_gb.toFixed(2)} GB
                        </div>
                    `;
                } else {
                    infoDiv.innerHTML = `
                        <div style="font-size: 13px; color: var(--accent-warning);">âš ï¸ æ•°æ®æºæœªå°±ç»ª</div>
                        <div style="font-size: 12px; margin-top: 4px; color: var(--text-muted);">
                            è¯·å…ˆè¿è¡Œæ•°æ®ç”Ÿæˆè„šæœ¬:<br>
                            <code style="font-size: 11px;">python scripts/generate_dataset.py</code>
                        </div>
                    `;
                }
            } catch (e) {
                infoDiv.innerHTML = `<div style="color: var(--accent-danger); font-size: 12px;">âŒ æ£€æŸ¥å¤±è´¥: ${e.message}</div>`;
            }
        }
        
        async function runDistillation() {
            const source = document.getElementById('distill-source').value;
            const size = parseInt(document.getElementById('distill-size').value);
            const sampleSize = parseInt(document.getElementById('distill-sample').value) || null;
            
            document.getElementById('btn-distill').disabled = true;
            document.getElementById('distill-progress').style.display = 'block';
            document.getElementById('distill-logs').innerHTML = '';
            
            // é‡ç½®æ­¥éª¤çŠ¶æ€
            document.querySelectorAll('#distill-steps .timeline-item').forEach(item => {
                item.classList.remove('active');
                item.classList.add('pending');
            });
            
            // æ„å»ºè¯·æ±‚å‚æ•°
            const params = { data_size: size };
            if (source !== 'synthetic') {
                params.use_real_data = true;
                params.data_path = source === 'test_data' ? 'data/test_data' : 'data/historical';
                if (sampleSize) params.sample_size = sampleSize;
            }
            
            try {
                await fetch(`${API_BASE}/api/distillation/run`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(params)
                });
                
                // è½®è¯¢çŠ¶æ€
                distillInterval = setInterval(async () => {
                    const response = await fetch(`${API_BASE}/api/distillation/status`);
                    const status = await response.json();
                    
                    // æ›´æ–°è¿›åº¦
                    document.getElementById('distill-progress-bar').style.width = `${status.progress}%`;
                    document.getElementById('distill-percent').textContent = `${status.progress}%`;
                    
                    // æ›´æ–°æ—¥å¿—
                    if (status.logs.length > 0) {
                        document.getElementById('distill-logs').innerHTML = status.logs.map(log => 
                            `<div class="log-entry">${log}</div>`
                        ).join('');
                    }
                    
                    // æ›´æ–°æ­¥éª¤çŠ¶æ€
                    const steps = document.querySelectorAll('#distill-steps .timeline-item');
                    const activeStep = Math.floor(status.progress / 20);
                    steps.forEach((step, i) => {
                        step.classList.remove('active', 'pending');
                        if (i < activeStep) {
                            // å®Œæˆ
                        } else if (i === activeStep) {
                            step.classList.add('active');
                        } else {
                            step.classList.add('pending');
                        }
                    });
                    
                    // å®Œæˆ
                    if (!status.running) {
                        clearInterval(distillInterval);
                        document.getElementById('btn-distill').disabled = false;
                        document.getElementById('btn-audit-log').style.display = 'block';
                        
                        if (status.run_id) {
                            document.getElementById('distill-run-id').textContent = `è¿è¡ŒID: ${status.run_id}`;
                        }
                        
                        if (status.result) {
                            const r = status.result;
                            document.getElementById('distill-logs').innerHTML += `
                                <div class="log-entry" style="color: var(--accent-primary); margin-top: 16px;">
                                    â”â”â”â”â”â” éªŒè¯ç»“æœ â”â”â”â”â”â”
                                </div>
                                <div class="log-entry">é¢„æµ‹è¿çº¦ç‡: ${(r.predicted_default_rate * 100).toFixed(2)}%</div>
                                <div class="log-entry">å®é™…è¿çº¦ç‡: ${(r.actual_default_rate * 100).toFixed(2)}%</div>
                                <div class="log-entry">åå·®: ${(r.deviation * 100).toFixed(2)}%</div>
                                <div class="log-entry" style="color: ${r.passed ? 'var(--accent-primary)' : 'var(--accent-danger)'}">
                                    éªŒè¯${r.passed ? 'âœ… é€šè¿‡' : 'âŒ æœªé€šè¿‡'}
                                </div>
                            `;
                            
                            // åŠ è½½è¯¦ç»†è¿½è¸ªä¿¡æ¯
                            loadDistillationTrace();
                        }
                    }
                }, 500);
                
            } catch (error) {
                clearInterval(distillInterval);
                document.getElementById('btn-distill').disabled = false;
                alert('è’¸é¦å¤±è´¥: ' + error.message);
            }
        }
        
        let distillationTraceData = null;
        
        async function loadDistillationTrace() {
            try {
                const response = await fetch(`${API_BASE}/api/distillation/trace`);
                const data = await response.json();
                if (data.success) {
                    distillationTraceData = data.trace;
                    updateStepDetails();
                }
            } catch (e) {
                console.error('åŠ è½½è¿½è¸ªä¿¡æ¯å¤±è´¥:', e);
            }
        }
        
        function updateStepDetails() {
            if (!distillationTraceData || !distillationTraceData.steps) return;
            
            distillationTraceData.steps.forEach(step => {
                const detailDiv = document.getElementById(`step-detail-${step.step_id}`);
                if (!detailDiv) return;
                
                let html = `<div class="action-time">è€—æ—¶: ${step.duration_ms}ms</div>`;
                
                if (step.actions && step.actions.length > 0) {
                    html += '<div style="margin-top: 8px;">';
                    step.actions.forEach(action => {
                        html += `
                            <div class="action-item">
                                <div class="action-icon">ğŸ“Œ</div>
                                <div class="action-content">
                                    <div class="action-name">${action.action}</div>
                                    <div class="action-desc">${JSON.stringify(action).replace(/"action":"[^"]+",?/g, '').slice(1, -1) || 'æ— é™„åŠ ä¿¡æ¯'}</div>
                                </div>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                // æ·»åŠ æ•°æ®ç»Ÿè®¡
                if (step.data_stats) {
                    html += `
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                            <strong>æ•°æ®ç»Ÿè®¡:</strong>
                            <div style="margin-top: 8px;">
                                æ€»è®°å½•: ${step.data_stats.total_records} | 
                                è¿çº¦æ•°: ${step.data_stats.default_count} | 
                                è¿çº¦ç‡: ${step.data_stats.default_rate}%
                            </div>
                        </div>
                    `;
                }
                
                // æ·»åŠ ç‰¹å¾çŸ©é˜µå½¢çŠ¶
                if (step.feature_matrix_shape) {
                    html += `
                        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-color);">
                            <strong>ç‰¹å¾çŸ©é˜µ:</strong> ${step.feature_matrix_shape[0]} æ ·æœ¬ Ã— ${step.feature_matrix_shape[1]} ç‰¹å¾
                        </div>
                    `;
                }
                
                detailDiv.innerHTML = html;
            });
        }
        
        function showStepDetail(stepId) {
            if (!distillationTraceData) {
                alert('è¯·å…ˆè¿è¡Œè’¸é¦ä»»åŠ¡');
                return;
            }
            
            const step = distillationTraceData.steps?.find(s => s.step_id === stepId);
            if (!step) return;
            
            const stepNames = ['', 'æ•°æ®å‡†å¤‡', 'ç‰¹å¾å·¥ç¨‹', 'è§„å¾‹å»ºæ¨¡', 'å‡½æ•°å°è£…', 'éªŒè¯æ ¡å‡†'];
            document.getElementById('step-modal-title').textContent = `ğŸ“‹ ${stepNames[stepId]} - è¯¦ç»†è¿‡ç¨‹`;
            
            let html = `
                <div class="detail-section">
                    <div class="detail-section-title">â±ï¸ æ‰§è¡Œä¿¡æ¯</div>
                    <div class="detail-grid" style="grid-template-columns: repeat(3, 1fr);">
                        <div class="detail-item">
                            <div class="detail-label">å¼€å§‹æ—¶é—´</div>
                            <div class="detail-value">${step.start_time?.split('T')[1]?.split('.')[0] || '--'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">ç»“æŸæ—¶é—´</div>
                            <div class="detail-value">${step.end_time?.split('T')[1]?.split('.')[0] || '--'}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">æ‰§è¡Œè€—æ—¶</div>
                            <div class="detail-value">${step.duration_ms} ms</div>
                        </div>
                    </div>
                </div>
            `;
            
            // æ“ä½œåˆ—è¡¨
            if (step.actions && step.actions.length > 0) {
                html += `
                    <div class="detail-section">
                        <div class="detail-section-title">ğŸ“ æ‰§è¡Œæ“ä½œ (${step.actions.length}é¡¹)</div>
                `;
                step.actions.forEach((action, i) => {
                    html += `
                        <div class="action-item">
                            <div class="action-icon">${i + 1}</div>
                            <div class="action-content">
                                <div class="action-name">${action.action}</div>
                                <div class="action-desc" style="font-family: 'JetBrains Mono', monospace; font-size: 11px; background: var(--bg-secondary); padding: 8px; border-radius: 4px; margin-top: 4px;">
                                    ${JSON.stringify(action, null, 2).replace(/[{}"]/g, '').trim()}
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // æ­¥éª¤ç‰¹å®šå†…å®¹
            if (stepId === 1 && distillationTraceData.data_samples?.length > 0) {
                html += `
                    <div class="detail-section">
                        <div class="detail-section-title">ğŸ“Š æ•°æ®æ ·æœ¬é¢„è§ˆ (å‰5æ¡)</div>
                        <table class="data-sample-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>å¹´ä»½</th>
                                    <th>å®¢æˆ·ç±»å‹</th>
                                    <th>è´·æ¬¾é‡‘é¢</th>
                                    <th>æ˜¯å¦è¿çº¦</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${distillationTraceData.data_samples.map(s => `
                                    <tr>
                                        <td>${s.index + 1}</td>
                                        <td>${s.year}</td>
                                        <td>${s.customer_type}</td>
                                        <td>Â¥${(s.loan_amount || 0).toLocaleString()}</td>
                                        <td style="color: ${s.defaulted ? 'var(--accent-danger)' : 'var(--accent-success)'}">
                                            ${s.defaulted ? 'æ˜¯' : 'å¦'}
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
            
            if (stepId === 2 && distillationTraceData.feature_stats) {
                const fs = distillationTraceData.feature_stats;
                html += `
                    <div class="detail-section">
                        <div class="detail-section-title">ğŸ”¢ ç‰¹å¾ç»Ÿè®¡</div>
                        <div class="detail-grid" style="grid-template-columns: repeat(3, 1fr);">
                            <div class="detail-item">
                                <div class="detail-label">ç‰¹å¾æ•°é‡</div>
                                <div class="detail-value">${fs.total_features}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æ ·æœ¬æ•°é‡</div>
                                <div class="detail-value">${fs.total_samples}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">æ­£è´Ÿæ ·æœ¬æ¯”</div>
                                <div class="detail-value">${fs.label_distribution?.positive} : ${fs.label_distribution?.negative}</div>
                            </div>
                        </div>
                        <div style="margin-top: 12px;">
                            <strong>ç‰¹å¾åˆ—è¡¨:</strong><br>
                            ${fs.feature_names?.map(f => `<span class="feature-chip">${f}</span>`).join('') || ''}
                        </div>
                    </div>
                `;
            }
            
            if (stepId === 3 && distillationTraceData.model_params?.rules_learned) {
                html += `
                    <div class="detail-section">
                        <div class="detail-section-title">ğŸ“š å­¦ä¹ åˆ°çš„ä¸šåŠ¡è§„åˆ™</div>
                        ${distillationTraceData.model_params.rules_learned.map(rule => `
                            <div class="rule-card">
                                <div class="rule-name">${rule.rule}</div>
                                <div class="rule-params">
                                    ${Object.entries(rule).filter(([k]) => k !== 'rule').map(([k, v]) => `
                                        <div class="rule-param"><span>${k}:</span> ${v}</div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            if (stepId === 5 && distillationTraceData.validation_details) {
                const vd = distillationTraceData.validation_details;
                html += `
                    <div class="detail-section">
                        <div class="detail-section-title">âœ… éªŒè¯è¯¦æƒ…</div>
                        <div class="detail-grid" style="grid-template-columns: repeat(4, 1fr);">
                            <div class="detail-item">
                                <div class="detail-label">æµ‹è¯•è®°å½•</div>
                                <div class="detail-value">${vd.test_records}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">é¢„æµ‹è¿çº¦ç‡</div>
                                <div class="detail-value">${(vd.predicted_default_rate * 100).toFixed(2)}%</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">å®é™…è¿çº¦ç‡</div>
                                <div class="detail-value">${(vd.actual_default_rate * 100).toFixed(2)}%</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">åå·®/é˜ˆå€¼</div>
                                <div class="detail-value ${vd.passed ? 'positive' : 'negative'}">
                                    ${(vd.deviation * 100).toFixed(2)}% / ${(vd.threshold * 100)}%
                                </div>
                            </div>
                        </div>
                        ${vd.by_customer_type ? `
                            <div style="margin-top: 16px;">
                                <strong>æŒ‰å®¢æˆ·ç±»å‹åˆ†å±‚éªŒè¯:</strong>
                                <table class="data-sample-table" style="margin-top: 8px;">
                                    <thead>
                                        <tr><th>å®¢æˆ·ç±»å‹</th><th>é¢„æµ‹è¿çº¦ç‡</th><th>å®é™…è¿çº¦ç‡</th></tr>
                                    </thead>
                                    <tbody>
                                        ${Object.entries(vd.by_customer_type).map(([type, data]) => `
                                            <tr>
                                                <td>${type}</td>
                                                <td>${(data.predicted * 100).toFixed(2)}%</td>
                                                <td>${(data.actual * 100).toFixed(2)}%</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            document.getElementById('step-modal-content').innerHTML = html;
            document.getElementById('step-detail-modal').style.display = 'flex';
        }
        
        function closeStepModal() {
            document.getElementById('step-detail-modal').style.display = 'none';
        }
        
        async function showAuditLog() {
            try {
                const response = await fetch(`${API_BASE}/api/distillation/audit-log`);
                const data = await response.json();
                
                if (data.success) {
                    // é…ç½®ä¿¡æ¯
                    let configHtml = '';
                    if (data.config) {
                        configHtml = `
                            <div class="stat-card" style="margin-bottom: 16px;">
                                <div class="grid grid-4">
                                    <div>
                                        <div class="stat-label">è¿è¡ŒID</div>
                                        <div style="font-family: 'JetBrains Mono'">${data.run_id || '--'}</div>
                                    </div>
                                    <div>
                                        <div class="stat-label">æ•°æ®æ¨¡å¼</div>
                                        <div>${data.config.data_mode === 'real' ? 'çœŸå®æ•°æ®' : 'åˆæˆæ•°æ®'}</div>
                                    </div>
                                    <div>
                                        <div class="stat-label">æ•°æ®æ¥æº</div>
                                        <div>${data.config.data_path || 'åˆæˆç”Ÿæˆ'}</div>
                                    </div>
                                    <div>
                                        <div class="stat-label">æ ·æœ¬æ•°é‡</div>
                                        <div>${data.config.sample_size}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    document.getElementById('audit-config').innerHTML = configHtml;
                    
                    // å®¡è®¡æ—¥å¿—
                    let logHtml = '<div style="max-height: 400px; overflow-y: auto;">';
                    if (data.audit_log && data.audit_log.length > 0) {
                        data.audit_log.forEach(entry => {
                            const time = entry.timestamp?.split('T')[1]?.split('.')[0] || '--';
                            logHtml += `
                                <div class="audit-entry">
                                    <div class="audit-time">${time}</div>
                                    <div class="audit-action">${entry.action}</div>
                                    <div class="audit-detail">${entry.details}</div>
                                </div>
                            `;
                        });
                    } else {
                        logHtml += '<div style="text-align: center; color: var(--text-muted); padding: 40px;">æš‚æ— å®¡è®¡æ—¥å¿—</div>';
                    }
                    logHtml += '</div>';
                    document.getElementById('audit-log-content').innerHTML = logHtml;
                    
                    document.getElementById('audit-log-modal').style.display = 'flex';
                }
            } catch (e) {
                alert('åŠ è½½å®¡è®¡æ—¥å¿—å¤±è´¥: ' + e.message);
            }
        }
        
        function closeAuditLog() {
            document.getElementById('audit-log-modal').style.display = 'none';
        }
        
        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        ['audit-log-modal', 'step-detail-modal', 'trace-modal'].forEach(id => {
            document.getElementById(id)?.addEventListener('click', function(e) {
                if (e.target === this) this.style.display = 'none';
            });
        });
        
        function closeTraceModal() {
            document.getElementById('trace-modal').style.display = 'none';
        }
        
        // ========== ç»æµå‘¨æœŸåˆ†æè¿½è¸ª ==========
        async function showCycleTrace() {
            try {
                const response = await fetch(`${API_BASE}/api/analysis/trace`);
                const data = await response.json();
                
                if (data.success && data.trace) {
                    const trace = data.trace;
                    document.getElementById('trace-modal-title').textContent = 'ğŸ“ˆ ç»æµå‘¨æœŸåˆ†æ - è¿‡ç¨‹è¿½è¸ª';
                    
                    let html = `
                        <div class="stat-card" style="margin-bottom: 16px;">
                            <div class="grid grid-4">
                                <div>
                                    <div class="stat-label">è¿è¡ŒID</div>
                                    <div style="font-family: 'JetBrains Mono'">${trace.run_id || '--'}</div>
                                </div>
                                <div>
                                    <div class="stat-label">å¼€å§‹æ—¶é—´</div>
                                    <div>${trace.start_time?.split('T')[1]?.split('.')[0] || '--'}</div>
                                </div>
                                <div>
                                    <div class="stat-label">æ ·æœ¬æ•°é‡</div>
                                    <div>${trace.config?.customer_count || '--'}</div>
                                </div>
                                <div>
                                    <div class="stat-label">åˆ†æåœºæ™¯</div>
                                    <div>4ä¸ªç»æµå‘¨æœŸ</div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // æ­¥éª¤è¯¦æƒ…
                    if (trace.steps?.length > 0) {
                        html += '<div class="detail-section"><div class="detail-section-title">ğŸ“‹ æ‰§è¡Œæ­¥éª¤</div>';
                        trace.steps.forEach(step => {
                            html += `
                                <div class="action-item">
                                    <div class="action-icon">${step.step_id}</div>
                                    <div class="action-content">
                                        <div class="action-name">${step.name}</div>
                                        <div class="action-desc" style="font-size: 12px; color: var(--text-muted);">
                                            ${step.duration_ms ? `è€—æ—¶: ${step.duration_ms}ms | ` : ''}
                                            ${JSON.stringify(step.details || {}).slice(0, 200)}...
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';
                    }
                    
                    // å®¢æˆ·æ ·æœ¬
                    if (trace.customer_samples?.length > 0) {
                        html += `
                            <div class="detail-section">
                                <div class="detail-section-title">ğŸ‘¥ å®¢æˆ·æ ·æœ¬ (å‰10ä¸ª)</div>
                                <table class="data-sample-table">
                                    <thead><tr><th>ID</th><th>ç±»å‹</th><th>æœˆæ”¶å…¥</th><th>è´Ÿå€ºç‡</th></tr></thead>
                                    <tbody>
                                        ${trace.customer_samples.map(c => `
                                            <tr>
                                                <td>${c.id?.slice(-8) || '--'}</td>
                                                <td>${c.type}</td>
                                                <td>Â¥${(c.income || 0).toLocaleString()}</td>
                                                <td>${(c.debt_ratio * 100).toFixed(1)}%</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                    
                    // å®¡è®¡æ—¥å¿—
                    html += buildAuditLogHtml(trace.audit_log);
                    
                    document.getElementById('trace-modal-content').innerHTML = html;
                    document.getElementById('trace-modal').style.display = 'flex';
                }
            } catch (e) {
                alert('åŠ è½½è¿½è¸ªä¿¡æ¯å¤±è´¥: ' + e.message);
            }
        }
        
        // ========== é“¶è¡Œæ¨¡æ‹Ÿè¿½è¸ª ==========
        async function showSimulationTrace() {
            try {
                const response = await fetch(`${API_BASE}/api/simulation/trace`);
                const data = await response.json();
                
                if (data.success && data.trace) {
                    const trace = data.trace;
                    document.getElementById('trace-modal-title').textContent = 'ğŸ¦ é“¶è¡Œæ¨¡æ‹Ÿ - è¿‡ç¨‹è¿½è¸ª';
                    
                    let html = `
                        <div class="stat-card" style="margin-bottom: 16px;">
                            <div class="grid grid-4">
                                <div>
                                    <div class="stat-label">è¿è¡ŒID</div>
                                    <div style="font-family: 'JetBrains Mono'">${trace.run_id || '--'}</div>
                                </div>
                                <div>
                                    <div class="stat-label">ä½¿ç”¨ç­–ç•¥</div>
                                    <div>${trace.config?.strategy_name || '--'}</div>
                                </div>
                                <div>
                                    <div class="stat-label">æ¨¡æ‹Ÿæœˆæ•°</div>
                                    <div>${trace.summary?.total_months || '--'}</div>
                                </div>
                                <div>
                                    <div class="stat-label">æœ€ç»ˆç»“æœ</div>
                                    <div style="color: ${trace.summary?.is_bankrupt ? 'var(--accent-danger)' : 'var(--accent-success)'}">
                                        ${trace.summary?.is_bankrupt ? 'ç ´äº§' : 'å­˜æ´»'}
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // å…³é”®äº‹ä»¶
                    if (trace.key_events?.length > 0) {
                        html += '<div class="detail-section"><div class="detail-section-title">âš ï¸ å…³é”®äº‹ä»¶</div>';
                        trace.key_events.forEach(e => {
                            html += `
                                <div class="action-item">
                                    <div class="action-icon" style="background: rgba(239, 68, 68, 0.2); color: var(--accent-danger);">!</div>
                                    <div class="action-content">
                                        <div class="action-name">ç¬¬${e.month}æœˆ: ${e.event}</div>
                                        <div class="action-desc">${e.details}</div>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';
                    }
                    
                    // æœˆåº¦å†³ç­–æ ·æœ¬
                    if (trace.monthly_decisions?.length > 0) {
                        html += `
                            <div class="detail-section">
                                <div class="detail-section-title">ğŸ“Š æœˆåº¦å†³ç­–è®°å½• (å…³é”®æœˆä»½)</div>
                                <table class="data-sample-table">
                                    <thead><tr><th>æœˆä»½</th><th>ç»æµå‘¨æœŸ</th><th>å†³ç­–</th><th>èµ„æœ¬å˜åŒ–</th><th>NPLå˜åŒ–</th><th>å¥–åŠ±</th></tr></thead>
                                    <tbody>
                                        ${trace.monthly_decisions.slice(0, 15).map(d => `
                                            <tr>
                                                <td>${d.month}</td>
                                                <td>${d.eco_phase}</td>
                                                <td style="color: ${d.action_name === 'æ‰¹å‡†' ? 'var(--accent-success)' : 'var(--accent-danger)'}">
                                                    ${d.action_name}
                                                </td>
                                                <td style="color: ${d.capital_change >= 0 ? 'var(--accent-success)' : 'var(--accent-danger)'}">
                                                    ${d.capital_change >= 0 ? '+' : ''}Â¥${(d.capital_change/1e8).toFixed(2)}äº¿
                                                </td>
                                                <td style="color: ${d.npl_change <= 0 ? 'var(--accent-success)' : 'var(--accent-danger)'}">
                                                    ${d.npl_change >= 0 ? '+' : ''}${(d.npl_change*100).toFixed(2)}%
                                                </td>
                                                <td>${d.reward.toFixed(2)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                    
                    // å®¡è®¡æ—¥å¿—
                    html += buildAuditLogHtml(trace.audit_log);
                    
                    document.getElementById('trace-modal-content').innerHTML = html;
                    document.getElementById('trace-modal').style.display = 'flex';
                }
            } catch (e) {
                alert('åŠ è½½è¿½è¸ªä¿¡æ¯å¤±è´¥: ' + e.message);
            }
        }
        
        // ========== ç­–ç•¥å¯¹æ¯”è¿½è¸ª ==========
        async function showComparisonTrace() {
            try {
                const response = await fetch(`${API_BASE}/api/comparison/trace`);
                const data = await response.json();
                
                if (data.success && data.trace) {
                    const trace = data.trace;
                    document.getElementById('trace-modal-title').textContent = 'âš”ï¸ ç­–ç•¥å¯¹æ¯” - è¿‡ç¨‹è¿½è¸ª';
                    
                    let html = `
                        <div class="stat-card" style="margin-bottom: 16px;">
                            <div class="grid grid-4">
                                <div>
                                    <div class="stat-label">è¿è¡ŒID</div>
                                    <div style="font-family: 'JetBrains Mono'">${trace.run_id || '--'}</div>
                                </div>
                                <div>
                                    <div class="stat-label">ç­–ç•¥æ•°é‡</div>
                                    <div>${trace.strategies?.length || 4}</div>
                                </div>
                                <div>
                                    <div class="stat-label">æ¯ç­–ç•¥å›åˆ</div>
                                    <div>${trace.config?.episodes_per_strategy || '--'}</div>
                                </div>
                                <div>
                                    <div class="stat-label">èƒœå‡ºç­–ç•¥</div>
                                    <div style="color: var(--accent-primary)">${trace.winner || '--'}</div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    // å„ç­–ç•¥è¯¦ç»†ç»“æœ
                    if (trace.episode_details) {
                        html += '<div class="detail-section"><div class="detail-section-title">ğŸ“Š å„ç­–ç•¥å›åˆè¯¦æƒ…</div>';
                        for (const [strategy, episodes] of Object.entries(trace.episode_details)) {
                            const result = trace.results?.find(r => r.name === strategy);
                            html += `
                                <div class="rule-card">
                                    <div class="rule-name">${strategy} ${result ? `(å¹³å‡å¥–åŠ±: ${result.avg_reward.toFixed(2)})` : ''}</div>
                                    <table class="data-sample-table" style="margin-top: 8px;">
                                        <thead><tr><th>å›åˆ</th><th>æœˆæ•°</th><th>å¥–åŠ±</th><th>åˆ©æ¶¦</th><th>NPL</th><th>ç»“æœ</th></tr></thead>
                                        <tbody>
                                            ${episodes.map(ep => `
                                                <tr>
                                                    <td>${ep.episode}</td>
                                                    <td>${ep.months}</td>
                                                    <td>${ep.reward.toFixed(2)}</td>
                                                    <td>Â¥${(ep.profit/1e8).toFixed(1)}äº¿</td>
                                                    <td>${(ep.npl*100).toFixed(1)}%</td>
                                                    <td style="color: ${ep.bankrupt ? 'var(--accent-danger)' : 'var(--accent-success)'}">
                                                        ${ep.bankrupt ? 'ç ´äº§' : 'å­˜æ´»'}
                                                    </td>
                                                </tr>
                                            `).join('')}
                                        </tbody>
                                    </table>
                                </div>
                            `;
                        }
                        html += '</div>';
                    }
                    
                    // å®¡è®¡æ—¥å¿—
                    html += buildAuditLogHtml(trace.audit_log);
                    
                    document.getElementById('trace-modal-content').innerHTML = html;
                    document.getElementById('trace-modal').style.display = 'flex';
                }
            } catch (e) {
                alert('åŠ è½½è¿½è¸ªä¿¡æ¯å¤±è´¥: ' + e.message);
            }
        }
        
        // æ„å»ºå®¡è®¡æ—¥å¿—HTML
        function buildAuditLogHtml(auditLog) {
            if (!auditLog || auditLog.length === 0) return '';
            
            return `
                <div class="detail-section">
                    <div class="detail-section-title">ğŸ“‹ å®¡è®¡æ—¥å¿— (${auditLog.length}æ¡)</div>
                    <div style="max-height: 250px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 8px;">
                        ${auditLog.map(entry => `
                            <div class="audit-entry">
                                <div class="audit-time">${entry.timestamp?.split('T')[1]?.split('.')[0] || '--'}</div>
                                <div class="audit-action">${entry.action}</div>
                                <div class="audit-detail">${entry.details}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        // ========== æ•°æ®æµè§ˆå™¨ ==========
        let currentDataSource = 'test_data';
        let currentTable = 'customers';
        let currentPage = 1;
        let totalPages = 1;
        
        async function refreshDataSources() {
            try {
                const response = await fetch(`${API_BASE}/api/data/sources`);
                const data = await response.json();
                
                if (data.success) {
                    let html = '';
                    data.sources.forEach(source => {
                        const isActive = source.name === currentDataSource;
                        html += `
                            <div class="data-source-item ${isActive ? 'active' : ''}" onclick="selectDataSource('${source.name}')">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <strong>ğŸ“ ${source.name}</strong>
                                    <span style="font-size: 11px; color: var(--text-muted);">
                                        ${source.summary?.total_customers?.toLocaleString() || '?'} å®¢æˆ·
                                    </span>
                                </div>
                                <div style="margin-top: 8px;">
                                    ${source.files.map(f => `
                                        <div class="data-file-item ${f.name.replace('.parquet','') === currentTable && isActive ? 'active' : ''}" 
                                             onclick="event.stopPropagation(); selectTable('${source.name}', '${f.name.replace('.parquet','')}')">
                                            <span>ğŸ“„ ${f.name}</span>
                                            <span>${f.size_mb} MB</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    });
                    document.getElementById('data-sources-list').innerHTML = html;
                }
            } catch (e) {
                document.getElementById('data-sources-list').innerHTML = `
                    <div style="color: var(--accent-danger); padding: 20px;">åŠ è½½å¤±è´¥: ${e.message}</div>
                `;
            }
        }
        
        function selectDataSource(source) {
            currentDataSource = source;
            refreshDataSources();
        }
        
        async function selectTable(source, table) {
            currentDataSource = source;
            currentTable = table;
            currentPage = 1;
            
            refreshDataSources();
            await loadTableSchema();
            await loadTableData();
        }
        
        async function loadTableSchema() {
            try {
                const response = await fetch(`${API_BASE}/api/data/schema`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ source: currentDataSource, table: currentTable })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('btn-stats').style.display = 'block';
                    
                    let html = `
                        <div style="margin-bottom: 12px; font-size: 13px; color: var(--text-muted);">
                            ${data.total_records.toLocaleString()} æ¡è®°å½• Â· ${data.total_columns} ä¸ªå­—æ®µ
                        </div>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <table class="schema-table">
                                <thead>
                                    <tr><th>å­—æ®µå</th><th>ç±»å‹</th><th>ç©ºå€¼</th><th>å”¯ä¸€å€¼</th></tr>
                                </thead>
                                <tbody>
                    `;
                    
                    data.schema.forEach(col => {
                        const dtypeClass = col.dtype.includes('int') ? 'dtype-int' : 
                                          col.dtype.includes('float') ? 'dtype-float' :
                                          col.dtype.includes('bool') ? 'dtype-bool' :
                                          col.dtype.includes('datetime') ? 'dtype-datetime' : 'dtype-object';
                        html += `
                            <tr>
                                <td><strong>${col.name}</strong></td>
                                <td><span class="dtype-badge ${dtypeClass}">${col.dtype}</span></td>
                                <td>${col.null_count}</td>
                                <td>${col.unique_count}</td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table></div>';
                    document.getElementById('table-schema').innerHTML = html;
                }
            } catch (e) {
                document.getElementById('table-schema').innerHTML = `
                    <div style="color: var(--accent-danger);">åŠ è½½å¤±è´¥: ${e.message}</div>
                `;
            }
        }
        
        async function loadTableData() {
            const search = document.getElementById('data-search')?.value || '';
            
            try {
                const response = await fetch(`${API_BASE}/api/data/browse`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        source: currentDataSource,
                        table: currentTable,
                        page: currentPage,
                        page_size: 20,
                        search: search
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    totalPages = data.total_pages;
                    
                    if (data.records.length === 0) {
                        document.getElementById('data-table-container').innerHTML = `
                            <div style="text-align: center; color: var(--text-muted); padding: 40px;">æ²¡æœ‰æ‰¾åˆ°è®°å½•</div>
                        `;
                        document.getElementById('data-pagination').style.display = 'none';
                        return;
                    }
                    
                    // æ„å»ºè¡¨æ ¼
                    let html = '<div class="data-grid"><table><thead><tr>';
                    
                    // åªæ˜¾ç¤ºå‰8åˆ—
                    const displayCols = data.columns.slice(0, 8);
                    displayCols.forEach(col => {
                        html += `<th>${col}</th>`;
                    });
                    if (data.columns.length > 8) {
                        html += `<th style="color: var(--text-muted);">+${data.columns.length - 8} æ›´å¤š</th>`;
                    }
                    html += '</tr></thead><tbody>';
                    
                    data.records.forEach(record => {
                        const recordId = record[data.columns[0]];
                        html += `<tr onclick="showRecordDetail('${currentDataSource}', '${currentTable}', '${recordId}')">`;
                        displayCols.forEach(col => {
                            let val = record[col];
                            if (val === null) val = '<span style="color:var(--text-muted)">NULL</span>';
                            else if (typeof val === 'boolean') val = val ? 'âœ“' : 'âœ—';
                            else if (typeof val === 'number') val = val.toLocaleString();
                            html += `<td>${val}</td>`;
                        });
                        if (data.columns.length > 8) {
                            html += '<td>...</td>';
                        }
                        html += '</tr>';
                    });
                    
                    html += '</tbody></table></div>';
                    document.getElementById('data-table-container').innerHTML = html;
                    
                    // åˆ†é¡µ
                    document.getElementById('data-pagination').style.display = 'flex';
                    document.getElementById('pagination-info').textContent = 
                        `ç¬¬ ${currentPage} / ${totalPages} é¡µ Â· å…± ${data.total_records.toLocaleString()} æ¡è®°å½•`;
                    document.getElementById('btn-prev').disabled = currentPage <= 1;
                    document.getElementById('btn-next').disabled = currentPage >= totalPages;
                }
            } catch (e) {
                document.getElementById('data-table-container').innerHTML = `
                    <div style="color: var(--accent-danger); padding: 20px;">åŠ è½½å¤±è´¥: ${e.message}</div>
                `;
            }
        }
        
        function searchData() {
            currentPage = 1;
            loadTableData();
        }
        
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                loadTableData();
            }
        }
        
        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                loadTableData();
            }
        }
        
        async function showRecordDetail(source, table, recordId) {
            try {
                const response = await fetch(`${API_BASE}/api/data/record/${source}/${table}/${recordId}`);
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('record-modal-title').textContent = `ğŸ“‹ è®°å½•è¯¦æƒ… - ${recordId}`;
                    
                    let html = `
                        <div style="margin-bottom: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;">
                            <div class="grid grid-3">
                                <div><span style="color:var(--text-muted)">æ•°æ®æº:</span> ${source}</div>
                                <div><span style="color:var(--text-muted)">æ•°æ®è¡¨:</span> ${table}</div>
                                <div><span style="color:var(--text-muted)">å­—æ®µæ•°:</span> ${data.field_details.length}</div>
                            </div>
                        </div>
                    `;
                    
                    data.field_details.forEach(field => {
                        const dtypeClass = field.dtype.includes('int') ? 'dtype-int' : 
                                          field.dtype.includes('float') ? 'dtype-float' :
                                          field.dtype.includes('bool') ? 'dtype-bool' : 'dtype-object';
                        
                        let displayVal = field.value;
                        if (field.is_null) {
                            displayVal = '<span style="color:var(--text-muted);font-style:italic">NULL</span>';
                        } else if (typeof field.value === 'boolean') {
                            displayVal = field.value ? '<span style="color:var(--accent-success)">âœ“ æ˜¯</span>' : '<span style="color:var(--accent-danger)">âœ— å¦</span>';
                        } else if (typeof field.value === 'number') {
                            displayVal = field.value.toLocaleString();
                        }
                        
                        html += `
                            <div class="record-field">
                                <div class="field-name">${field.name}</div>
                                <div class="field-value">${displayVal}</div>
                                <div class="field-meta">
                                    <span class="dtype-badge ${dtypeClass}">${field.dtype}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    document.getElementById('record-modal-content').innerHTML = html;
                    document.getElementById('record-detail-modal').style.display = 'flex';
                }
            } catch (e) {
                alert('åŠ è½½è®°å½•å¤±è´¥: ' + e.message);
            }
        }
        
        function closeRecordModal() {
            document.getElementById('record-detail-modal').style.display = 'none';
        }
        
        async function showTableStats() {
            try {
                const response = await fetch(`${API_BASE}/api/data/stats`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ source: currentDataSource, table: currentTable })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    document.getElementById('stats-modal-title').textContent = `ğŸ“Š ${currentTable} ç»Ÿè®¡ä¿¡æ¯`;
                    
                    let html = `
                        <div class="stat-card" style="margin-bottom: 16px;">
                            <div class="grid grid-4">
                                <div>
                                    <div class="stat-label">æ€»è®°å½•æ•°</div>
                                    <div class="stat-value">${stats.total_records.toLocaleString()}</div>
                                </div>
                                <div>
                                    <div class="stat-label">å­—æ®µæ•°</div>
                                    <div class="stat-value">${stats.total_columns}</div>
                                </div>
                                <div>
                                    <div class="stat-label">å†…å­˜å ç”¨</div>
                                    <div class="stat-value">${stats.memory_usage_mb} MB</div>
                                </div>
                                <div>
                                    <div class="stat-label">æ•°æ®æº</div>
                                    <div class="stat-value">${currentDataSource}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="detail-section">
                            <div class="detail-section-title">ğŸ“‹ å­—æ®µç»Ÿè®¡</div>
                            <div style="max-height: 400px; overflow-y: auto;">
                    `;
                    
                    for (const [colName, colStats] of Object.entries(stats.column_stats)) {
                        const dtypeClass = colStats.dtype.includes('int') ? 'dtype-int' : 
                                          colStats.dtype.includes('float') ? 'dtype-float' :
                                          colStats.dtype.includes('bool') ? 'dtype-bool' : 'dtype-object';
                        
                        html += `
                            <div class="rule-card">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                    <div class="rule-name">${colName}</div>
                                    <span class="dtype-badge ${dtypeClass}">${colStats.dtype}</span>
                                </div>
                                <div class="grid grid-4" style="font-size: 12px;">
                                    <div>
                                        <span style="color:var(--text-muted)">ç©ºå€¼:</span> 
                                        ${colStats.null_count} (${colStats.null_percent}%)
                                    </div>
                                    <div>
                                        <span style="color:var(--text-muted)">å”¯ä¸€å€¼:</span> 
                                        ${colStats.unique_count}
                                    </div>
                        `;
                        
                        if (colStats.min !== undefined) {
                            html += `
                                    <div>
                                        <span style="color:var(--text-muted)">èŒƒå›´:</span> 
                                        ${colStats.min?.toLocaleString()} ~ ${colStats.max?.toLocaleString()}
                                    </div>
                                    <div>
                                        <span style="color:var(--text-muted)">å‡å€¼:</span> 
                                        ${colStats.mean?.toFixed(2)}
                                    </div>
                            `;
                        }
                        
                        html += '</div>';
                        
                        // åˆ†å¸ƒæ¡å½¢å›¾
                        if (colStats.top_values) {
                            const maxCount = Math.max(...Object.values(colStats.top_values));
                            html += '<div style="margin-top: 8px;">';
                            for (const [val, count] of Object.entries(colStats.top_values).slice(0, 5)) {
                                const pct = (count / maxCount * 100).toFixed(0);
                                html += `
                                    <div style="display: flex; align-items: center; margin: 4px 0; font-size: 11px;">
                                        <div style="width: 100px; overflow: hidden; text-overflow: ellipsis;">${val}</div>
                                        <div style="flex: 1; margin: 0 8px;">
                                            <div class="stat-bar">
                                                <div class="stat-bar-fill" style="width: ${pct}%"></div>
                                            </div>
                                        </div>
                                        <div style="width: 50px; text-align: right;">${count}</div>
                                    </div>
                                `;
                            }
                            html += '</div>';
                        }
                        
                        html += '</div>';
                    }
                    
                    html += '</div></div>';
                    
                    document.getElementById('stats-modal-content').innerHTML = html;
                    document.getElementById('stats-modal').style.display = 'flex';
                }
            } catch (e) {
                alert('åŠ è½½ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: ' + e.message);
            }
        }
        
        function closeStatsModal() {
            document.getElementById('stats-modal').style.display = 'none';
        }
        
        // ç‚¹å‡»å¼¹çª—å¤–éƒ¨å…³é—­
        ['record-detail-modal', 'stats-modal'].forEach(id => {
            document.getElementById(id)?.addEventListener('click', function(e) {
                if (e.target === this) this.style.display = 'none';
            });
        });
        
        // é¡µé¢åˆ‡æ¢æ—¶åŠ è½½æ•°æ®
        const origSwitchPage = window.switchPage || function(){};
        window.switchPage = function(pageName) {
            origSwitchPage(pageName);
            if (pageName === 'databrowser') {
                refreshDataSources();
            }
        };
        
        // åˆå§‹åŒ–
        console.log('ğŸ® Gamium Finance AI å·²åŠ è½½');
    </script>
</body>
</html>

